var Ao=Object.defineProperty;var Po=(t,e,n)=>e in t?Ao(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var pn=(t,e,n)=>(Po(t,typeof e!="symbol"?e+"":e,n),n);var Jt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)};function Bo(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function Ee(){}function Ci(t){return t()}function Ar(){return Object.create(null)}function Me(t){t.forEach(Ci)}function xt(t){return typeof t=="function"}function dt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Lo(t){return Object.keys(t).length===0}function Pr(t){return t??""}function Bn(t){return t&&xt(t.destroy)?t.destroy:Ee}function I(t,e){t.appendChild(e)}function z(t,e,n){t.insertBefore(e,n||null)}function j(t){t.parentNode&&t.parentNode.removeChild(t)}function P(t){return document.createElement(t)}function xe(t){return document.createTextNode(t)}function Z(){return xe(" ")}function ct(){return xe("")}function de(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function F(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function No(t){return Array.from(t.childNodes)}function Le(t,e){e=""+e,t.data!==e&&(t.data=e)}function Br(t,e){t.value=e??""}function Qn(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}let Kt;function Zt(t){Kt=t}function Mo(){if(!Kt)throw new Error("Function called outside component initialization");return Kt}function $o(t){Mo().$$.on_mount.push(t)}const Nt=[],le=[];let Mt=[];const Xn=[],Fo=Promise.resolve();let er=!1;function Uo(){er||(er=!0,Fo.then(Ei))}function tr(t){Mt.push(t)}function ge(t){Xn.push(t)}const qn=new Set;let Pt=0;function Ei(){if(Pt!==0)return;const t=Kt;do{try{for(;Pt<Nt.length;){const e=Nt[Pt];Pt++,Zt(e),jo(e.$$)}}catch(e){throw Nt.length=0,Pt=0,e}for(Zt(null),Nt.length=0,Pt=0;le.length;)le.pop()();for(let e=0;e<Mt.length;e+=1){const n=Mt[e];qn.has(n)||(qn.add(n),n())}Mt.length=0}while(Nt.length);for(;Xn.length;)Xn.pop()();er=!1,qn.clear(),Zt(t)}function jo(t){if(t.fragment!==null){t.update(),Me(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(tr)}}function zo(t){const e=[],n=[];Mt.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Mt=e}const mn=new Set;let vt;function Tt(){vt={r:0,c:[],p:vt}}function St(){vt.r||Me(vt.c),vt=vt.p}function W(t,e){t&&t.i&&(mn.delete(t),t.i(e))}function Y(t,e,n,r){if(t&&t.o){if(mn.has(t))return;mn.add(t),vt.c.push(()=>{mn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function lt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Ln(t,e){Y(t,1,1,()=>{e.delete(t.key)})}function Nn(t,e,n,r,i,o,a,l,u,d,f,h){let g=t.length,_=o.length,b=g;const E={};for(;b--;)E[t[b].key]=b;const T=[],S=new Map,x=new Map,w=[];for(b=_;b--;){const L=h(i,o,b),N=n(L);let A=a.get(N);A?r&&w.push(()=>A.p(L,e)):(A=d(N,L),A.c()),S.set(N,T[b]=A),N in E&&x.set(N,Math.abs(b-E[N]))}const R=new Set,V=new Set;function $(L){W(L,1),L.m(l,f),a.set(L.key,L),f=L.first,_--}for(;g&&_;){const L=T[_-1],N=t[g-1],A=L.key,D=N.key;L===N?(f=L.first,g--,_--):S.has(D)?!a.has(A)||R.has(A)?$(L):V.has(D)?g--:x.get(A)>x.get(D)?(V.add(A),$(L)):(R.add(D),g--):(u(N,a),g--)}for(;g--;){const L=t[g];S.has(L.key)||u(L,a)}for(;_;)$(T[_-1]);return Me(w),T}function _e(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function ie(t){t&&t.c()}function te(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),tr(()=>{const o=t.$$.on_mount.map(Ci).filter(xt);t.$$.on_destroy?t.$$.on_destroy.push(...o):Me(o),t.$$.on_mount=[]}),i.forEach(tr)}function ne(t,e){const n=t.$$;n.fragment!==null&&(zo(n.after_update),Me(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Vo(t,e){t.$$.dirty[0]===-1&&(Nt.push(t),Uo(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function pt(t,e,n,r,i,o,a,l=[-1]){const u=Kt;Zt(t);const d=t.$$={fragment:null,ctx:[],props:o,update:Ee,not_equal:i,bound:Ar(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ar(),dirty:l,skip_bound:!1,root:e.target||u.$$.root};a&&a(d.root);let f=!1;if(d.ctx=n?n(t,e.props||{},(h,g,..._)=>{const b=_.length?_[0]:g;return d.ctx&&i(d.ctx[h],d.ctx[h]=b)&&(!d.skip_bound&&d.bound[h]&&d.bound[h](b),f&&Vo(t,h)),g}):[],d.update(),f=!0,Me(d.before_update),d.fragment=r?r(d.ctx):!1,e.target){if(e.hydrate){const h=No(e.target);d.fragment&&d.fragment.l(h),h.forEach(j)}else d.fragment&&d.fragment.c();e.intro&&W(t.$$.fragment),te(t,e.target,e.anchor),Ei()}Zt(u)}class ht{constructor(){pn(this,"$$");pn(this,"$$set")}$destroy(){ne(this,1),this.$destroy=Ee}$on(e,n){if(!xt(n))return Ee;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Lo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Go="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Go);var vi={},Mn={};Mn.byteLength=Ho;Mn.toByteArray=Wo;Mn.fromByteArray=Qo;var Ze=[],ze=[],Jo=typeof Uint8Array<"u"?Uint8Array:Array,Hn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Bt=0,qo=Hn.length;Bt<qo;++Bt)Ze[Bt]=Hn[Bt],ze[Hn.charCodeAt(Bt)]=Bt;ze["-".charCodeAt(0)]=62;ze["_".charCodeAt(0)]=63;function ki(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function Ho(t){var e=ki(t),n=e[0],r=e[1];return(n+r)*3/4-r}function Zo(t,e,n){return(e+n)*3/4-n}function Wo(t){var e,n=ki(t),r=n[0],i=n[1],o=new Jo(Zo(t,r,i)),a=0,l=i>0?r-4:r,u;for(u=0;u<l;u+=4)e=ze[t.charCodeAt(u)]<<18|ze[t.charCodeAt(u+1)]<<12|ze[t.charCodeAt(u+2)]<<6|ze[t.charCodeAt(u+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=e&255;return i===2&&(e=ze[t.charCodeAt(u)]<<2|ze[t.charCodeAt(u+1)]>>4,o[a++]=e&255),i===1&&(e=ze[t.charCodeAt(u)]<<10|ze[t.charCodeAt(u+1)]<<4|ze[t.charCodeAt(u+2)]>>2,o[a++]=e>>8&255,o[a++]=e&255),o}function Yo(t){return Ze[t>>18&63]+Ze[t>>12&63]+Ze[t>>6&63]+Ze[t&63]}function Ko(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(t[o+2]&255),i.push(Yo(r));return i.join("")}function Qo(t){for(var e,n=t.length,r=n%3,i=[],o=16383,a=0,l=n-r;a<l;a+=o)i.push(Ko(t,a,a+o>l?l:a+o));return r===1?(e=t[n-1],i.push(Ze[e>>2]+Ze[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(Ze[e>>10]+Ze[e>>4&63]+Ze[e<<2&63]+"=")),i.join("")}var Er={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Er.read=function(t,e,n,r,i){var o,a,l=i*8-r-1,u=(1<<l)-1,d=u>>1,f=-7,h=n?i-1:0,g=n?-1:1,_=t[e+h];for(h+=g,o=_&(1<<-f)-1,_>>=-f,f+=l;f>0;o=o*256+t[e+h],h+=g,f-=8);for(a=o&(1<<-f)-1,o>>=-f,f+=r;f>0;a=a*256+t[e+h],h+=g,f-=8);if(o===0)o=1-d;else{if(o===u)return a?NaN:(_?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-d}return(_?-1:1)*a*Math.pow(2,o-r)};Er.write=function(t,e,n,r,i,o){var a,l,u,d=o*8-i-1,f=(1<<d)-1,h=f>>1,g=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=r?0:o-1,b=r?1:-1,E=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+h>=1?e+=g/u:e+=g*Math.pow(2,1-h),e*u>=2&&(a++,u/=2),a+h>=f?(l=0,a=f):a+h>=1?(l=(e*u-1)*Math.pow(2,i),a=a+h):(l=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+_]=l&255,_+=b,l/=256,i-=8);for(a=a<<i|l,d+=i;d>0;t[n+_]=a&255,_+=b,a/=256,d-=8);t[n+_-b]|=E*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=Mn,n=Er,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=f,t.SlowBuffer=V,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:o,ArrayBuffer:a,SharedArrayBuffer:l}=globalThis;f.TYPED_ARRAY_SUPPORT=u(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{const p=new o(1),s={foo:function(){return 42}};return Object.setPrototypeOf(s,o.prototype),Object.setPrototypeOf(p,s),p.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function d(p){if(p>i)throw new RangeError('The value "'+p+'" is invalid for option "size"');const s=new o(p);return Object.setPrototypeOf(s,f.prototype),s}function f(p,s,c){if(typeof p=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(p)}return h(p,s,c)}f.poolSize=8192;function h(p,s,c){if(typeof p=="string")return E(p,s);if(a.isView(p))return S(p);if(p==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p);if(Fe(p,a)||p&&Fe(p.buffer,a)||typeof l<"u"&&(Fe(p,l)||p&&Fe(p.buffer,l)))return x(p,s,c);if(typeof p=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const m=p.valueOf&&p.valueOf();if(m!=null&&m!==p)return f.from(m,s,c);const y=w(p);if(y)return y;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof p[Symbol.toPrimitive]=="function")return f.from(p[Symbol.toPrimitive]("string"),s,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p)}f.from=function(p,s,c){return h(p,s,c)},Object.setPrototypeOf(f.prototype,o.prototype),Object.setPrototypeOf(f,o);function g(p){if(typeof p!="number")throw new TypeError('"size" argument must be of type number');if(p<0)throw new RangeError('The value "'+p+'" is invalid for option "size"')}function _(p,s,c){return g(p),p<=0?d(p):s!==void 0?typeof c=="string"?d(p).fill(s,c):d(p).fill(s):d(p)}f.alloc=function(p,s,c){return _(p,s,c)};function b(p){return g(p),d(p<0?0:R(p)|0)}f.allocUnsafe=function(p){return b(p)},f.allocUnsafeSlow=function(p){return b(p)};function E(p,s){if((typeof s!="string"||s==="")&&(s="utf8"),!f.isEncoding(s))throw new TypeError("Unknown encoding: "+s);const c=$(p,s)|0;let m=d(c);const y=m.write(p,s);return y!==c&&(m=m.slice(0,y)),m}function T(p){const s=p.length<0?0:R(p.length)|0,c=d(s);for(let m=0;m<s;m+=1)c[m]=p[m]&255;return c}function S(p){if(Fe(p,o)){const s=new o(p);return x(s.buffer,s.byteOffset,s.byteLength)}return T(p)}function x(p,s,c){if(s<0||p.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(p.byteLength<s+(c||0))throw new RangeError('"length" is outside of buffer bounds');let m;return s===void 0&&c===void 0?m=new o(p):c===void 0?m=new o(p,s):m=new o(p,s,c),Object.setPrototypeOf(m,f.prototype),m}function w(p){if(f.isBuffer(p)){const s=R(p.length)|0,c=d(s);return c.length===0||p.copy(c,0,0,s),c}if(p.length!==void 0)return typeof p.length!="number"||Jn(p.length)?d(0):T(p);if(p.type==="Buffer"&&Array.isArray(p.data))return T(p.data)}function R(p){if(p>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return p|0}function V(p){return+p!=p&&(p=0),f.alloc(+p)}f.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==f.prototype},f.compare=function(s,c){if(Fe(s,o)&&(s=f.from(s,s.offset,s.byteLength)),Fe(c,o)&&(c=f.from(c,c.offset,c.byteLength)),!f.isBuffer(s)||!f.isBuffer(c))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===c)return 0;let m=s.length,y=c.length;for(let C=0,v=Math.min(m,y);C<v;++C)if(s[C]!==c[C]){m=s[C],y=c[C];break}return m<y?-1:y<m?1:0},f.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(s,c){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return f.alloc(0);let m;if(c===void 0)for(c=0,m=0;m<s.length;++m)c+=s[m].length;const y=f.allocUnsafe(c);let C=0;for(m=0;m<s.length;++m){let v=s[m];if(Fe(v,o))C+v.length>y.length?(f.isBuffer(v)||(v=f.from(v)),v.copy(y,C)):o.prototype.set.call(y,v,C);else if(f.isBuffer(v))v.copy(y,C);else throw new TypeError('"list" argument must be an Array of Buffers');C+=v.length}return y};function $(p,s){if(f.isBuffer(p))return p.length;if(a.isView(p)||Fe(p,a))return p.byteLength;if(typeof p!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof p);const c=p.length,m=arguments.length>2&&arguments[2]===!0;if(!m&&c===0)return 0;let y=!1;for(;;)switch(s){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return At(p).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c*2;case"hex":return c>>>1;case"base64":return Gt(p).length;default:if(y)return m?-1:At(p).length;s=(""+s).toLowerCase(),y=!0}}f.byteLength=$;function L(p,s,c){let m=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((c===void 0||c>this.length)&&(c=this.length),c<=0)||(c>>>=0,s>>>=0,c<=s))return"";for(p||(p="utf8");;)switch(p){case"hex":return Xe(this,s,c);case"utf8":case"utf-8":return K(this,s,c);case"ascii":return Oe(this,s,c);case"latin1":case"binary":return Ge(this,s,c);case"base64":return $e(this,s,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return wt(this,s,c);default:if(m)throw new TypeError("Unknown encoding: "+p);p=(p+"").toLowerCase(),m=!0}}f.prototype._isBuffer=!0;function N(p,s,c){const m=p[s];p[s]=p[c],p[c]=m}f.prototype.swap16=function(){const s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let c=0;c<s;c+=2)N(this,c,c+1);return this},f.prototype.swap32=function(){const s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let c=0;c<s;c+=4)N(this,c,c+3),N(this,c+1,c+2);return this},f.prototype.swap64=function(){const s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let c=0;c<s;c+=8)N(this,c,c+7),N(this,c+1,c+6),N(this,c+2,c+5),N(this,c+3,c+4);return this},f.prototype.toString=function(){const s=this.length;return s===0?"":arguments.length===0?K(this,0,s):L.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(s){if(!f.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:f.compare(this,s)===0},f.prototype.inspect=function(){let s="";const c=t.INSPECT_MAX_BYTES;return s=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(s+=" ... "),"<Buffer "+s+">"},r&&(f.prototype[r]=f.prototype.inspect),f.prototype.compare=function(s,c,m,y,C){if(Fe(s,o)&&(s=f.from(s,s.offset,s.byteLength)),!f.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(c===void 0&&(c=0),m===void 0&&(m=s?s.length:0),y===void 0&&(y=0),C===void 0&&(C=this.length),c<0||m>s.length||y<0||C>this.length)throw new RangeError("out of range index");if(y>=C&&c>=m)return 0;if(y>=C)return-1;if(c>=m)return 1;if(c>>>=0,m>>>=0,y>>>=0,C>>>=0,this===s)return 0;let v=C-y,H=m-c;const se=Math.min(v,H),ee=this.slice(y,C),ae=s.slice(c,m);for(let X=0;X<se;++X)if(ee[X]!==ae[X]){v=ee[X],H=ae[X];break}return v<H?-1:H<v?1:0};function A(p,s,c,m,y){if(p.length===0)return-1;if(typeof c=="string"?(m=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,Jn(c)&&(c=y?0:p.length-1),c<0&&(c=p.length+c),c>=p.length){if(y)return-1;c=p.length-1}else if(c<0)if(y)c=0;else return-1;if(typeof s=="string"&&(s=f.from(s,m)),f.isBuffer(s))return s.length===0?-1:D(p,s,c,m,y);if(typeof s=="number")return s=s&255,typeof o.prototype.indexOf=="function"?y?o.prototype.indexOf.call(p,s,c):o.prototype.lastIndexOf.call(p,s,c):D(p,[s],c,m,y);throw new TypeError("val must be string, number or Buffer")}function D(p,s,c,m,y){let C=1,v=p.length,H=s.length;if(m!==void 0&&(m=String(m).toLowerCase(),m==="ucs2"||m==="ucs-2"||m==="utf16le"||m==="utf-16le")){if(p.length<2||s.length<2)return-1;C=2,v/=2,H/=2,c/=2}function se(ae,X){return C===1?ae[X]:ae.readUInt16BE(X*C)}let ee;if(y){let ae=-1;for(ee=c;ee<v;ee++)if(se(p,ee)===se(s,ae===-1?0:ee-ae)){if(ae===-1&&(ae=ee),ee-ae+1===H)return ae*C}else ae!==-1&&(ee-=ee-ae),ae=-1}else for(c+H>v&&(c=v-H),ee=c;ee>=0;ee--){let ae=!0;for(let X=0;X<H;X++)if(se(p,ee+X)!==se(s,X)){ae=!1;break}if(ae)return ee}return-1}f.prototype.includes=function(s,c,m){return this.indexOf(s,c,m)!==-1},f.prototype.indexOf=function(s,c,m){return A(this,s,c,m,!0)},f.prototype.lastIndexOf=function(s,c,m){return A(this,s,c,m,!1)};function O(p,s,c,m){c=Number(c)||0;const y=p.length-c;m?(m=Number(m),m>y&&(m=y)):m=y;const C=s.length;m>C/2&&(m=C/2);let v;for(v=0;v<m;++v){const H=parseInt(s.substr(v*2,2),16);if(Jn(H))return v;p[c+v]=H}return v}function U(p,s,c,m){return yt(At(s,p.length-c),p,c,m)}function k(p,s,c,m){return yt(un(s),p,c,m)}function q(p,s,c,m){return yt(Gt(s),p,c,m)}function pe(p,s,c,m){return yt(dn(s,p.length-c),p,c,m)}f.prototype.write=function(s,c,m,y){if(c===void 0)y="utf8",m=this.length,c=0;else if(m===void 0&&typeof c=="string")y=c,m=this.length,c=0;else if(isFinite(c))c=c>>>0,isFinite(m)?(m=m>>>0,y===void 0&&(y="utf8")):(y=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const C=this.length-c;if((m===void 0||m>C)&&(m=C),s.length>0&&(m<0||c<0)||c>this.length)throw new RangeError("Attempt to write outside buffer bounds");y||(y="utf8");let v=!1;for(;;)switch(y){case"hex":return O(this,s,c,m);case"utf8":case"utf-8":return U(this,s,c,m);case"ascii":case"latin1":case"binary":return k(this,s,c,m);case"base64":return q(this,s,c,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return pe(this,s,c,m);default:if(v)throw new TypeError("Unknown encoding: "+y);y=(""+y).toLowerCase(),v=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function $e(p,s,c){return s===0&&c===p.length?e.fromByteArray(p):e.fromByteArray(p.slice(s,c))}function K(p,s,c){c=Math.min(p.length,c);const m=[];let y=s;for(;y<c;){const C=p[y];let v=null,H=C>239?4:C>223?3:C>191?2:1;if(y+H<=c){let se,ee,ae,X;switch(H){case 1:C<128&&(v=C);break;case 2:se=p[y+1],(se&192)===128&&(X=(C&31)<<6|se&63,X>127&&(v=X));break;case 3:se=p[y+1],ee=p[y+2],(se&192)===128&&(ee&192)===128&&(X=(C&15)<<12|(se&63)<<6|ee&63,X>2047&&(X<55296||X>57343)&&(v=X));break;case 4:se=p[y+1],ee=p[y+2],ae=p[y+3],(se&192)===128&&(ee&192)===128&&(ae&192)===128&&(X=(C&15)<<18|(se&63)<<12|(ee&63)<<6|ae&63,X>65535&&X<1114112&&(v=X))}}v===null?(v=65533,H=1):v>65535&&(v-=65536,m.push(v>>>10&1023|55296),v=56320|v&1023),m.push(v),y+=H}return ye(m)}const ve=4096;function ye(p){const s=p.length;if(s<=ve)return String.fromCharCode.apply(String,p);let c="",m=0;for(;m<s;)c+=String.fromCharCode.apply(String,p.slice(m,m+=ve));return c}function Oe(p,s,c){let m="";c=Math.min(p.length,c);for(let y=s;y<c;++y)m+=String.fromCharCode(p[y]&127);return m}function Ge(p,s,c){let m="";c=Math.min(p.length,c);for(let y=s;y<c;++y)m+=String.fromCharCode(p[y]);return m}function Xe(p,s,c){const m=p.length;(!s||s<0)&&(s=0),(!c||c<0||c>m)&&(c=m);let y="";for(let C=s;C<c;++C)y+=wo[p[C]];return y}function wt(p,s,c){const m=p.slice(s,c);let y="";for(let C=0;C<m.length-1;C+=2)y+=String.fromCharCode(m[C]+m[C+1]*256);return y}f.prototype.slice=function(s,c){const m=this.length;s=~~s,c=c===void 0?m:~~c,s<0?(s+=m,s<0&&(s=0)):s>m&&(s=m),c<0?(c+=m,c<0&&(c=0)):c>m&&(c=m),c<s&&(c=s);const y=this.subarray(s,c);return Object.setPrototypeOf(y,f.prototype),y};function re(p,s,c){if(p%1!==0||p<0)throw new RangeError("offset is not uint");if(p+s>c)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(s,c,m){s=s>>>0,c=c>>>0,m||re(s,c,this.length);let y=this[s],C=1,v=0;for(;++v<c&&(C*=256);)y+=this[s+v]*C;return y},f.prototype.readUintBE=f.prototype.readUIntBE=function(s,c,m){s=s>>>0,c=c>>>0,m||re(s,c,this.length);let y=this[s+--c],C=1;for(;c>0&&(C*=256);)y+=this[s+--c]*C;return y},f.prototype.readUint8=f.prototype.readUInt8=function(s,c){return s=s>>>0,c||re(s,1,this.length),this[s]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(s,c){return s=s>>>0,c||re(s,2,this.length),this[s]|this[s+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(s,c){return s=s>>>0,c||re(s,2,this.length),this[s]<<8|this[s+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(s,c){return s=s>>>0,c||re(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(s,c){return s=s>>>0,c||re(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},f.prototype.readBigUInt64LE=rt(function(s){s=s>>>0,M(s,"offset");const c=this[s],m=this[s+7];(c===void 0||m===void 0)&&me(s,this.length-8);const y=c+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24,C=this[++s]+this[++s]*2**8+this[++s]*2**16+m*2**24;return BigInt(y)+(BigInt(C)<<BigInt(32))}),f.prototype.readBigUInt64BE=rt(function(s){s=s>>>0,M(s,"offset");const c=this[s],m=this[s+7];(c===void 0||m===void 0)&&me(s,this.length-8);const y=c*2**24+this[++s]*2**16+this[++s]*2**8+this[++s],C=this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+m;return(BigInt(y)<<BigInt(32))+BigInt(C)}),f.prototype.readIntLE=function(s,c,m){s=s>>>0,c=c>>>0,m||re(s,c,this.length);let y=this[s],C=1,v=0;for(;++v<c&&(C*=256);)y+=this[s+v]*C;return C*=128,y>=C&&(y-=Math.pow(2,8*c)),y},f.prototype.readIntBE=function(s,c,m){s=s>>>0,c=c>>>0,m||re(s,c,this.length);let y=c,C=1,v=this[s+--y];for(;y>0&&(C*=256);)v+=this[s+--y]*C;return C*=128,v>=C&&(v-=Math.pow(2,8*c)),v},f.prototype.readInt8=function(s,c){return s=s>>>0,c||re(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},f.prototype.readInt16LE=function(s,c){s=s>>>0,c||re(s,2,this.length);const m=this[s]|this[s+1]<<8;return m&32768?m|4294901760:m},f.prototype.readInt16BE=function(s,c){s=s>>>0,c||re(s,2,this.length);const m=this[s+1]|this[s]<<8;return m&32768?m|4294901760:m},f.prototype.readInt32LE=function(s,c){return s=s>>>0,c||re(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},f.prototype.readInt32BE=function(s,c){return s=s>>>0,c||re(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},f.prototype.readBigInt64LE=rt(function(s){s=s>>>0,M(s,"offset");const c=this[s],m=this[s+7];(c===void 0||m===void 0)&&me(s,this.length-8);const y=this[s+4]+this[s+5]*2**8+this[s+6]*2**16+(m<<24);return(BigInt(y)<<BigInt(32))+BigInt(c+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24)}),f.prototype.readBigInt64BE=rt(function(s){s=s>>>0,M(s,"offset");const c=this[s],m=this[s+7];(c===void 0||m===void 0)&&me(s,this.length-8);const y=(c<<24)+this[++s]*2**16+this[++s]*2**8+this[++s];return(BigInt(y)<<BigInt(32))+BigInt(this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+m)}),f.prototype.readFloatLE=function(s,c){return s=s>>>0,c||re(s,4,this.length),n.read(this,s,!0,23,4)},f.prototype.readFloatBE=function(s,c){return s=s>>>0,c||re(s,4,this.length),n.read(this,s,!1,23,4)},f.prototype.readDoubleLE=function(s,c){return s=s>>>0,c||re(s,8,this.length),n.read(this,s,!0,52,8)},f.prototype.readDoubleBE=function(s,c){return s=s>>>0,c||re(s,8,this.length),n.read(this,s,!1,52,8)};function he(p,s,c,m,y,C){if(!f.isBuffer(p))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>y||s<C)throw new RangeError('"value" argument is out of bounds');if(c+m>p.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(s,c,m,y){if(s=+s,c=c>>>0,m=m>>>0,!y){const H=Math.pow(2,8*m)-1;he(this,s,c,m,H,0)}let C=1,v=0;for(this[c]=s&255;++v<m&&(C*=256);)this[c+v]=s/C&255;return c+m},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(s,c,m,y){if(s=+s,c=c>>>0,m=m>>>0,!y){const H=Math.pow(2,8*m)-1;he(this,s,c,m,H,0)}let C=m-1,v=1;for(this[c+C]=s&255;--C>=0&&(v*=256);)this[c+C]=s/v&255;return c+m},f.prototype.writeUint8=f.prototype.writeUInt8=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,1,255,0),this[c]=s&255,c+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,2,65535,0),this[c]=s&255,this[c+1]=s>>>8,c+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,2,65535,0),this[c]=s>>>8,this[c+1]=s&255,c+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,4,4294967295,0),this[c+3]=s>>>24,this[c+2]=s>>>16,this[c+1]=s>>>8,this[c]=s&255,c+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,4,4294967295,0),this[c]=s>>>24,this[c+1]=s>>>16,this[c+2]=s>>>8,this[c+3]=s&255,c+4};function mt(p,s,c,m,y){nt(s,m,y,p,c,7);let C=Number(s&BigInt(4294967295));p[c++]=C,C=C>>8,p[c++]=C,C=C>>8,p[c++]=C,C=C>>8,p[c++]=C;let v=Number(s>>BigInt(32)&BigInt(4294967295));return p[c++]=v,v=v>>8,p[c++]=v,v=v>>8,p[c++]=v,v=v>>8,p[c++]=v,c}function gt(p,s,c,m,y){nt(s,m,y,p,c,7);let C=Number(s&BigInt(4294967295));p[c+7]=C,C=C>>8,p[c+6]=C,C=C>>8,p[c+5]=C,C=C>>8,p[c+4]=C;let v=Number(s>>BigInt(32)&BigInt(4294967295));return p[c+3]=v,v=v>>8,p[c+2]=v,v=v>>8,p[c+1]=v,v=v>>8,p[c]=v,c+8}f.prototype.writeBigUInt64LE=rt(function(s,c=0){return mt(this,s,c,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=rt(function(s,c=0){return gt(this,s,c,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(s,c,m,y){if(s=+s,c=c>>>0,!y){const se=Math.pow(2,8*m-1);he(this,s,c,m,se-1,-se)}let C=0,v=1,H=0;for(this[c]=s&255;++C<m&&(v*=256);)s<0&&H===0&&this[c+C-1]!==0&&(H=1),this[c+C]=(s/v>>0)-H&255;return c+m},f.prototype.writeIntBE=function(s,c,m,y){if(s=+s,c=c>>>0,!y){const se=Math.pow(2,8*m-1);he(this,s,c,m,se-1,-se)}let C=m-1,v=1,H=0;for(this[c+C]=s&255;--C>=0&&(v*=256);)s<0&&H===0&&this[c+C+1]!==0&&(H=1),this[c+C]=(s/v>>0)-H&255;return c+m},f.prototype.writeInt8=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,1,127,-128),s<0&&(s=255+s+1),this[c]=s&255,c+1},f.prototype.writeInt16LE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,2,32767,-32768),this[c]=s&255,this[c+1]=s>>>8,c+2},f.prototype.writeInt16BE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,2,32767,-32768),this[c]=s>>>8,this[c+1]=s&255,c+2},f.prototype.writeInt32LE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,4,2147483647,-2147483648),this[c]=s&255,this[c+1]=s>>>8,this[c+2]=s>>>16,this[c+3]=s>>>24,c+4},f.prototype.writeInt32BE=function(s,c,m){return s=+s,c=c>>>0,m||he(this,s,c,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[c]=s>>>24,this[c+1]=s>>>16,this[c+2]=s>>>8,this[c+3]=s&255,c+4},f.prototype.writeBigInt64LE=rt(function(s,c=0){return mt(this,s,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=rt(function(s,c=0){return gt(this,s,c,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function _t(p,s,c,m,y,C){if(c+m>p.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function G(p,s,c,m,y){return s=+s,c=c>>>0,y||_t(p,s,c,4),n.write(p,s,c,m,23,4),c+4}f.prototype.writeFloatLE=function(s,c,m){return G(this,s,c,!0,m)},f.prototype.writeFloatBE=function(s,c,m){return G(this,s,c,!1,m)};function Ae(p,s,c,m,y){return s=+s,c=c>>>0,y||_t(p,s,c,8),n.write(p,s,c,m,52,8),c+8}f.prototype.writeDoubleLE=function(s,c,m){return Ae(this,s,c,!0,m)},f.prototype.writeDoubleBE=function(s,c,m){return Ae(this,s,c,!1,m)},f.prototype.copy=function(s,c,m,y){if(!f.isBuffer(s))throw new TypeError("argument should be a Buffer");if(m||(m=0),!y&&y!==0&&(y=this.length),c>=s.length&&(c=s.length),c||(c=0),y>0&&y<m&&(y=m),y===m||s.length===0||this.length===0)return 0;if(c<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(y<0)throw new RangeError("sourceEnd out of bounds");y>this.length&&(y=this.length),s.length-c<y-m&&(y=s.length-c+m);const C=y-m;return this===s&&typeof o.prototype.copyWithin=="function"?this.copyWithin(c,m,y):o.prototype.set.call(s,this.subarray(m,y),c),C},f.prototype.fill=function(s,c,m,y){if(typeof s=="string"){if(typeof c=="string"?(y=c,c=0,m=this.length):typeof m=="string"&&(y=m,m=this.length),y!==void 0&&typeof y!="string")throw new TypeError("encoding must be a string");if(typeof y=="string"&&!f.isEncoding(y))throw new TypeError("Unknown encoding: "+y);if(s.length===1){const v=s.charCodeAt(0);(y==="utf8"&&v<128||y==="latin1")&&(s=v)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(c<0||this.length<c||this.length<m)throw new RangeError("Out of range index");if(m<=c)return this;c=c>>>0,m=m===void 0?this.length:m>>>0,s||(s=0);let C;if(typeof s=="number")for(C=c;C<m;++C)this[C]=s;else{const v=f.isBuffer(s)?s:f.from(s,y),H=v.length;if(H===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(C=0;C<m-c;++C)this[C+c]=v[C%H]}return this};const je={};function et(p,s,c){je[p]=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:s.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${p}]`,this.stack,delete this.name}get code(){return p}set code(y){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:y,writable:!0})}toString(){return`${this.name} [${p}]: ${this.message}`}}}et("ERR_BUFFER_OUT_OF_BOUNDS",function(p){return p?`${p} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),et("ERR_INVALID_ARG_TYPE",function(p,s){return`The "${p}" argument must be of type number. Received type ${typeof s}`},TypeError),et("ERR_OUT_OF_RANGE",function(p,s,c){let m=`The value of "${p}" is out of range.`,y=c;return Number.isInteger(c)&&Math.abs(c)>2**32?y=tt(String(c)):typeof c=="bigint"&&(y=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(y=tt(y)),y+="n"),m+=` It must be ${s}. Received ${y}`,m},RangeError);function tt(p){let s="",c=p.length;const m=p[0]==="-"?1:0;for(;c>=m+4;c-=3)s=`_${p.slice(c-3,c)}${s}`;return`${p.slice(0,c)}${s}`}function Ot(p,s,c){M(s,"offset"),(p[s]===void 0||p[s+c]===void 0)&&me(s,p.length-(c+1))}function nt(p,s,c,m,y,C){if(p>c||p<s){const v=typeof s=="bigint"?"n":"";let H;throw C>3?s===0||s===BigInt(0)?H=`>= 0${v} and < 2${v} ** ${(C+1)*8}${v}`:H=`>= -(2${v} ** ${(C+1)*8-1}${v}) and < 2 ** ${(C+1)*8-1}${v}`:H=`>= ${s}${v} and <= ${c}${v}`,new je.ERR_OUT_OF_RANGE("value",H,p)}Ot(m,y,C)}function M(p,s){if(typeof p!="number")throw new je.ERR_INVALID_ARG_TYPE(s,"number",p)}function me(p,s,c){throw Math.floor(p)!==p?(M(p,c),new je.ERR_OUT_OF_RANGE(c||"offset","an integer",p)):s<0?new je.ERR_BUFFER_OUT_OF_BOUNDS:new je.ERR_OUT_OF_RANGE(c||"offset",`>= ${c?1:0} and <= ${s}`,p)}const ln=/[^+/0-9A-Za-z-_]/g;function fn(p){if(p=p.split("=")[0],p=p.trim().replace(ln,""),p.length<2)return"";for(;p.length%4!==0;)p=p+"=";return p}function At(p,s){s=s||1/0;let c;const m=p.length;let y=null;const C=[];for(let v=0;v<m;++v){if(c=p.charCodeAt(v),c>55295&&c<57344){if(!y){if(c>56319){(s-=3)>-1&&C.push(239,191,189);continue}else if(v+1===m){(s-=3)>-1&&C.push(239,191,189);continue}y=c;continue}if(c<56320){(s-=3)>-1&&C.push(239,191,189),y=c;continue}c=(y-55296<<10|c-56320)+65536}else y&&(s-=3)>-1&&C.push(239,191,189);if(y=null,c<128){if((s-=1)<0)break;C.push(c)}else if(c<2048){if((s-=2)<0)break;C.push(c>>6|192,c&63|128)}else if(c<65536){if((s-=3)<0)break;C.push(c>>12|224,c>>6&63|128,c&63|128)}else if(c<1114112){if((s-=4)<0)break;C.push(c>>18|240,c>>12&63|128,c>>6&63|128,c&63|128)}else throw new Error("Invalid code point")}return C}function un(p){const s=[];for(let c=0;c<p.length;++c)s.push(p.charCodeAt(c)&255);return s}function dn(p,s){let c,m,y;const C=[];for(let v=0;v<p.length&&!((s-=2)<0);++v)c=p.charCodeAt(v),m=c>>8,y=c%256,C.push(y),C.push(m);return C}function Gt(p){return e.toByteArray(fn(p))}function yt(p,s,c,m){let y;for(y=0;y<m&&!(y+c>=s.length||y>=p.length);++y)s[y+c]=p[y];return y}function Fe(p,s){return p instanceof s||p!=null&&p.constructor!=null&&p.constructor.name!=null&&p.constructor.name===s.name}function Jn(p){return p!==p}const wo=function(){const p="0123456789abcdef",s=new Array(256);for(let c=0;c<16;++c){const m=c*16;for(let y=0;y<16;++y)s[m+y]=p[c]+p[y]}return s}();function rt(p){return typeof BigInt>"u"?Oo:p}function Oo(){throw new Error("BigInt not supported")}})(vi);const J=vi.Buffer;class Q extends Error{constructor(e,n,r,...i){Array.isArray(n)&&(n=n.join(" ").trim()),super(n),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,Q),this.code=e;for(const o of i)for(const a in o){const l=o[a];this[a]=J.isBuffer(l)?l.toString(r.encoding):l==null?l:JSON.parse(JSON.stringify(l))}}}const Xo=function(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)},Ti=function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const i=t[n];if(i==null||i===!1)e[n]={disabled:!0};else if(typeof i=="string")e[n]={name:i};else if(Xo(i)){if(typeof i.name!="string")throw new Q("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${n}`,"when column is an object literal"]);e[n]=i}else throw new Q("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(i)} at position ${n}`])}return e};class Lr{constructor(e=100){this.size=e,this.length=0,this.buf=J.allocUnsafe(e)}prepend(e){if(J.isBuffer(e)){const n=this.length+e.length;if(n>=this.size&&(this.resize(),n>=this.size))throw Error("INVALID_BUFFER_STATE");const r=this.buf;this.buf=J.allocUnsafe(this.size),e.copy(this.buf,0),r.copy(this.buf,e.length),this.length+=e.length}else{const n=this.length++;n===this.size&&this.resize();const r=this.clone();this.buf[0]=e,r.copy(this.buf,1,0,n)}}append(e){const n=this.length++;n===this.size&&this.resize(),this.buf[n]=e}clone(){return J.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const n=J.allocUnsafe(this.size);this.buf.copy(n,0,0,e),this.buf=n}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const es=12,ts=13,ns=10,rs=32,is=9,os=function(t){return{bomSkipped:!1,bufBytesStart:0,castField:t.cast_function,commenting:!1,error:void 0,enabled:t.from_line===1,escaping:!1,escapeIsQuote:J.isBuffer(t.escape)&&J.isBuffer(t.quote)&&J.compare(t.escape,t.quote)===0,expectedRecordLength:Array.isArray(t.columns)?t.columns.length:void 0,field:new Lr(20),firstLineToHeaders:t.cast_first_line_to_header,needMoreDataSize:Math.max(t.comment!==null?t.comment.length:0,...t.delimiter.map(e=>e.length),t.quote!==null?t.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new Lr(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:t.record_delimiter.length===0?0:Math.max(...t.record_delimiter.map(e=>e.length)),trimChars:[J.from(" ",t.encoding)[0],J.from("	",t.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[J.from(J.from([ts],"utf8").toString(),t.encoding),J.from(J.from([ns],"utf8").toString(),t.encoding),J.from(J.from([es],"utf8").toString(),t.encoding),J.from(J.from([rs],"utf8").toString(),t.encoding),J.from(J.from([is],"utf8").toString(),t.encoding)]}},ss=function(t){return t.replace(/([A-Z])/g,function(e,n){return"_"+n.toLowerCase()})},Nr=function(t){const e={};for(const r in t)e[ss(r)]=t[r];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new Q("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new Q("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new Q("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(r){const i=Date.parse(r);return isNaN(i)?r:new Date(i)};else if(typeof e.cast_date!="function")throw new Q("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=Ti(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new Q("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new Q("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new Q("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=J.from(e.comment,e.encoding)),!J.isBuffer(e.comment))throw new Q("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(e.comment_no_infix===void 0||e.comment_no_infix===null||e.comment_no_infix===!1)e.comment_no_infix=!1;else if(e.comment_no_infix!==!0)throw new Q("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const n=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new Q("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${n}`],e);if(e.delimiter=e.delimiter.map(function(r){if(r==null||r===!1)return J.from(",",e.encoding);if(typeof r=="string"&&(r=J.from(r,e.encoding)),!J.isBuffer(r)||r.length===0)throw new Q("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${n}`],e);return r}),e.escape===void 0||e.escape===!0?e.escape=J.from('"',e.encoding):typeof e.escape=="string"?e.escape=J.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!J.isBuffer(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(t.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(t.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(t.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new Q("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new Q("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(J.isBuffer(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new Q("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.on_skip!==void 0&&e.on_skip!==null&&typeof e.on_skip!="function")throw new Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(e.on_skip)}`);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=J.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=J.from(e.quote,e.encoding)),!J.isBuffer(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||J.isBuffer(e.record_delimiter)){if(e.record_delimiter.length===0)throw new Q("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new Q("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(r,i){if(typeof r!="string"&&!J.isBuffer(r))throw new Q("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${i},`,`got ${JSON.stringify(r)}`],e);if(r.length===0)throw new Q("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${i},`,`got ${JSON.stringify(r)}`],e);return typeof r=="string"&&(r=J.from(r,e.encoding)),r}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&t.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&t.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(t.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(t.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(t.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(t.to_line)}`);return e},Mr=function(t){return t.every(e=>e==null||e.toString&&e.toString().trim()==="")},as=13,cs=10,Lt={utf8:J.from([239,187,191]),utf16le:J.from([255,254])},ls=function(t={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},n=Nr(t);return{info:e,original_options:t,options:n,state:os(n),__needMoreData:function(r,i,o){if(o)return!1;const{encoding:a,escape:l,quote:u}=this.options,{quoting:d,needMoreDataSize:f,recordDelimiterMaxLength:h}=this.state,g=i-r-1,_=Math.max(f,h===0?J.from(`\r
`,a).length:h,d?(l===null?0:l.length)+u.length:0,d?u.length+h:0);return g<_},parse:function(r,i,o,a){const{bom:l,comment_no_infix:u,encoding:d,from_line:f,ltrim:h,max_record_size:g,raw:_,relax_quotes:b,rtrim:E,skip_empty_lines:T,to:S,to_line:x}=this.options;let{comment:w,escape:R,quote:V,record_delimiter:$}=this.options;const{bomSkipped:L,previousBuf:N,rawBuffer:A,escapeIsQuote:D}=this.state;let O;if(N===void 0)if(r===void 0){a();return}else O=r;else N!==void 0&&r===void 0?O=N:O=J.concat([N,r]);if(L===!1)if(l===!1)this.state.bomSkipped=!0;else if(O.length<3){if(i===!1){this.state.previousBuf=O;return}}else{for(const q in Lt)if(Lt[q].compare(O,0,Lt[q].length)===0){const pe=Lt[q].length;this.state.bufBytesStart+=pe,O=O.slice(pe),this.options=Nr({...this.original_options,encoding:q}),{comment:w,escape:R,quote:V}=this.options;break}this.state.bomSkipped=!0}const U=O.length;let k;for(k=0;k<U&&!this.__needMoreData(k,U,i);k++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),x!==-1&&this.info.lines>x){this.state.stop=!0,a();return}this.state.quoting===!1&&$.length===0&&this.__autoDiscoverRecordDelimiter(O,k)&&($=this.options.record_delimiter);const q=O[k];if(_===!0&&A.append(q),(q===as||q===cs)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if(R!==null&&this.state.quoting===!0&&this.__isEscape(O,k,q)&&k+R.length<U)if(D){if(this.__isQuote(O,k+R.length)){this.state.escaping=!0,k+=R.length-1;continue}}else{this.state.escaping=!0,k+=R.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(O,k))if(this.state.quoting===!0){const K=O[k+V.length],ve=E&&this.__isCharTrimable(O,k+V.length),ye=w!==null&&this.__compareBytes(w,O,k+V.length,K),Oe=this.__isDelimiter(O,k+V.length,K),Ge=$.length===0?this.__autoDiscoverRecordDelimiter(O,k+V.length):this.__isRecordDelimiter(K,O,k+V.length);if(R!==null&&this.__isEscape(O,k,q)&&this.__isQuote(O,k+R.length))k+=R.length-1;else if(!K||Oe||Ge||ye||ve){this.state.quoting=!1,this.state.wasQuoting=!0,k+=V.length-1;continue}else if(b===!1){const Xe=this.__error(new Q("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(K)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(Xe!==void 0)return Xe}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(V),k+=V.length-1}else if(this.state.field.length!==0){if(b===!1){const K=this.__infoField(),ve=Object.keys(Lt).map(Oe=>Lt[Oe].equals(this.state.field.toString())?Oe:!1).filter(Boolean)[0],ye=this.__error(new Q("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(K.column)} at line ${K.lines}, value is ${JSON.stringify(this.state.field.toString(d))}`,ve?`(${ve} bom)`:void 0],this.options,K,{field:this.state.field}));if(ye!==void 0)return ye}}else{this.state.quoting=!0,k+=V.length-1;continue}if(this.state.quoting===!1){const K=this.__isRecordDelimiter(q,O,k);if(K!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=f){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),k+=K-1;continue}if(T===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,k+=K-1;continue}this.info.bytes=this.state.bufBytesStart+k;const Oe=this.__onField();if(Oe!==void 0)return Oe;this.info.bytes=this.state.bufBytesStart+k+K;const Ge=this.__onRecord(o);if(Ge!==void 0)return Ge;if(S!==-1&&this.info.records>=S){this.state.stop=!0,a();return}}this.state.commenting=!1,k+=K-1;continue}if(this.state.commenting)continue;if(w!==null&&(u===!1||this.state.record.length===0&&this.state.field.length===0)&&this.__compareBytes(w,O,k,q)!==0){this.state.commenting=!0;continue}const ve=this.__isDelimiter(O,k,q);if(ve!==0){this.info.bytes=this.state.bufBytesStart+k;const ye=this.__onField();if(ye!==void 0)return ye;k+=ve-1;continue}}}if(this.state.commenting===!1&&g!==0&&this.state.record_length+this.state.field.length>g)return this.__error(new Q("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${g}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const pe=h===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(O,k),$e=E===!1||this.state.wasQuoting===!1;if(pe===!0&&$e===!0)this.state.field.append(q);else{if(E===!0&&!this.__isCharTrimable(O,k))return this.__error(new Q("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));pe===!1&&(k+=this.__isCharTrimable(O,k)-1);continue}}if(i===!0)if(this.state.quoting===!0){const q=this.__error(new Q("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(q!==void 0)return q}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+k;const q=this.__onField();if(q!==void 0)return q;const pe=this.__onRecord(o);if(pe!==void 0)return pe}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=k,this.state.previousBuf=O.slice(k);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(r){const{columns:i,group_columns_by_name:o,encoding:a,info:l,from:u,relax_column_count:d,relax_column_count_less:f,relax_column_count_more:h,raw:g,skip_records_with_empty_values:_}=this.options,{enabled:b,record:E}=this.state;if(b===!1)return this.__resetRecord();const T=E.length;if(i===!0){if(_===!0&&Mr(E)){this.__resetRecord();return}return this.__firstLineToColumns(E)}if(i===!1&&this.info.records===0&&(this.state.expectedRecordLength=T),T!==this.state.expectedRecordLength){const S=i===!1?new Q("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${T} on line ${this.info.lines}`],this.options,this.__infoField(),{record:E}):new Q("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${i.length},`,`got ${T} on line ${this.info.lines}`],this.options,this.__infoField(),{record:E});if(d===!0||f===!0&&T<this.state.expectedRecordLength||h===!0&&T>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=S;else{const x=this.__error(S);if(x)return x}}if(_===!0&&Mr(E)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,u===1||this.info.records>=u){const{objname:S}=this.options;if(i!==!1){const x={};for(let w=0,R=E.length;w<R;w++)i[w]===void 0||i[w].disabled||(o===!0&&x[i[w].name]!==void 0?Array.isArray(x[i[w].name])?x[i[w].name]=x[i[w].name].concat(E[w]):x[i[w].name]=[x[i[w].name],E[w]]:x[i[w].name]=E[w]);if(g===!0||l===!0){const w=Object.assign({record:x},g===!0?{raw:this.state.rawBuffer.toString(a)}:{},l===!0?{info:this.__infoRecord()}:{}),R=this.__push(S===void 0?w:[x[S],w],r);if(R)return R}else{const w=this.__push(S===void 0?x:[x[S],x],r);if(w)return w}}else if(g===!0||l===!0){const x=Object.assign({record:E},g===!0?{raw:this.state.rawBuffer.toString(a)}:{},l===!0?{info:this.__infoRecord()}:{}),w=this.__push(S===void 0?x:[E[S],x],r);if(w)return w}else{const x=this.__push(S===void 0?E:[E[S],E],r);if(x)return x}}this.__resetRecord()},__firstLineToColumns:function(r){const{firstLineToHeaders:i}=this.state;try{const o=i===void 0?r:i.call(null,r);if(!Array.isArray(o))return this.__error(new Q("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(o)}`],this.options,this.__infoField(),{headers:o}));const a=Ti(o);this.state.expectedRecordLength=a.length,this.options.columns=a,this.__resetRecord();return}catch(o){return o}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:r,encoding:i,rtrim:o,max_record_size:a}=this.options,{enabled:l,wasQuoting:u}=this.state;if(l===!1)return this.__resetField();let d=this.state.field.toString(i);if(o===!0&&u===!1&&(d=d.trimRight()),r===!0){const[f,h]=this.__cast(d);if(f!==void 0)return f;d=h}this.state.record.push(d),a!==0&&typeof d=="string"&&(this.state.record_length+=d.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(r,i){const{on_record:o}=this.options;if(o!==void 0){const a=this.__infoRecord();try{r=o.call(null,r,a)}catch(l){return l}if(r==null)return}i(r)},__cast:function(r){const{columns:i,relax_column_count:o}=this.options;if(Array.isArray(i)===!0&&o&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const l=this.__infoField();return[void 0,this.state.castField.call(null,r,l)]}catch(l){return[l]}if(this.__isFloat(r))return[void 0,parseFloat(r)];if(this.options.cast_date!==!1){const l=this.__infoField();return[void 0,this.options.cast_date.call(null,r,l)]}return[void 0,r]},__isCharTrimable:function(r,i){return((a,l)=>{const{timchars:u}=this.state;e:for(let d=0;d<u.length;d++){const f=u[d];for(let h=0;h<f.length;h++)if(f[h]!==a[l+h])continue e;return f.length}return 0})(r,i)},__isFloat:function(r){return r-parseFloat(r)+1>=0},__compareBytes:function(r,i,o,a){if(r[0]!==a)return 0;const l=r.length;for(let u=1;u<l;u++)if(r[u]!==i[o+u])return 0;return l},__isDelimiter:function(r,i,o){const{delimiter:a,ignore_last_delimiters:l}=this.options;if(l===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(l!==!1&&typeof l=="number"&&this.state.record.length===l-1)return 0;e:for(let u=0;u<a.length;u++){const d=a[u];if(d[0]===o){for(let f=1;f<d.length;f++)if(d[f]!==r[i+f])continue e;return d.length}}return 0},__isRecordDelimiter:function(r,i,o){const{record_delimiter:a}=this.options,l=a.length;e:for(let u=0;u<l;u++){const d=a[u],f=d.length;if(d[0]===r){for(let h=1;h<f;h++)if(d[h]!==i[o+h])continue e;return d.length}}return 0},__isEscape:function(r,i,o){const{escape:a}=this.options;if(a===null)return!1;const l=a.length;if(a[0]===o){for(let u=0;u<l;u++)if(a[u]!==r[i+u])return!1;return!0}return!1},__isQuote:function(r,i){const{quote:o}=this.options;if(o===null)return!1;const a=o.length;for(let l=0;l<a;l++)if(o[l]!==r[i+l])return!1;return!0},__autoDiscoverRecordDelimiter:function(r,i){const{encoding:o}=this.options,a=[J.from(`\r
`,o),J.from(`
`,o),J.from("\r",o)];e:for(let l=0;l<a.length;l++){const u=a[l].length;for(let d=0;d<u;d++)if(a[l][d]!==r[i+d])continue e;return this.options.record_delimiter.push(a[l]),this.state.recordDelimiterMaxLength=a[l].length,a[l].length}return 0},__error:function(r){const{encoding:i,raw:o,skip_records_with_error:a}=this.options,l=typeof r=="string"?new Error(r):r;if(a){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(l,o?this.state.rawBuffer.toString(i):void 0);return}else return l},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:r,raw:i,encoding:o}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:r===!0,index:this.state.record.length,raw:i?this.state.rawBuffer.toString(o):void 0}},__infoField:function(){const{columns:r}=this.options,i=Array.isArray(r);return{...this.__infoRecord(),column:i===!0?r.length>this.state.record.length?r[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},fs=function(t,e={}){typeof t=="string"&&(t=J.from(t));const n=e&&e.objname?{}:[],r=ls(e),i=u=>{r.options.objname===void 0?n.push(u):n[u[0]]=u[1]},o=()=>{},a=r.parse(t,!1,i,o);if(a!==void 0)throw a;const l=r.parse(void 0,!0,i,o);if(l!==void 0)throw l;return n},us="/project-delta-mvp/dist/assets/atnia_set1-6ec0853c.csv",ds=2,ps=6,hs=ds*ps;class ms{constructor(){pn(this,"id",Math.random())}}class gs extends ms{constructor(e,n,r,i,o,a,l,u,d,f,h="Faceup"){super(),this.name=e,this.cost=n,this.source=r,this.type=i,this.subtype=o,this.speed=a,this.offense=l,this.defense=u,this.rulesText=d,this.flavorText=f,this.state=h}}const Zn=["Name","Energy Cost","Source","Type","Subtype","Speed","Offense","Defense","RulesText","FlavorText","image","CommentsTags","Comments","RelatedCards","TagsReal","Formats","Set"];async function _s(){const t=await(await fetch(us)).text();let e=fs(t);e=e.filter(function(n){return n.length>0&&n[0].length>0&&n[0]!="BEGIN_CARDS"&&!n[0].startsWith("-")});for(let n=0;n<Math.min(e[0].length,Zn.length);++n)if(e[0][n]!==Zn[n])throw`cards header did not match! expected ${Zn} but got ${e[0]}`;return e.slice(1).map(function(n){return new gs(n[0],parseInt(n[1]),n[2],n[3],n[4],parseInt(n[5]),parseInt(n[6]),parseInt(n[7]),n[8],n[9])})}const ys="finalize",bs="consider";function jt(t,e,n){t.dispatchEvent(new CustomEvent(ys,{detail:{items:e,info:n}}))}function ft(t,e,n){t.dispatchEvent(new CustomEvent(bs,{detail:{items:e,info:n}}))}const $n="draggedEntered",on="draggedLeft",Fn="draggedOverIndex",vr="draggedLeftDocument",Sn={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function Cs(t,e,n){t.dispatchEvent(new CustomEvent($n,{detail:{indexObj:e,draggedEl:n}}))}function Es(t,e,n){t.dispatchEvent(new CustomEvent(on,{detail:{draggedEl:e,type:Sn.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function vs(t,e){t.dispatchEvent(new CustomEvent(on,{detail:{draggedEl:e,type:Sn.OUTSIDE_OF_ANY}}))}function ks(t,e,n){t.dispatchEvent(new CustomEvent(Fn,{detail:{indexObj:e,draggedEl:n}}))}function Ts(t){window.dispatchEvent(new CustomEvent(vr,{detail:{draggedEl:t}}))}const De={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:$n,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:Fn,DRAGGED_LEFT:on,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},Ne={POINTER:"pointer",KEYBOARD:"keyboard"},sn="isDndShadowItem",kr="data-is-dnd-shadow-item-internal",Ss="data-is-dnd-shadow-item-hint",xs="id:dnd-shadow-placeholder-0000",Is="dnd-action-dragged-el";let Ce="id",nr=0;function Si(){nr++}function xi(){if(nr===0)throw new Error("Bug! trying to decrement when there are no dropzones");nr--}const Tr=typeof window>"u";function rr(t){let e;const n=t.getBoundingClientRect(),r=getComputedStyle(t),i=r.transform;if(i){let o,a,l,u;if(i.startsWith("matrix3d("))e=i.slice(9,-1).split(/, /),o=+e[0],a=+e[5],l=+e[12],u=+e[13];else if(i.startsWith("matrix("))e=i.slice(7,-1).split(/, /),o=+e[0],a=+e[3],l=+e[4],u=+e[5];else return n;const d=r.transformOrigin,f=n.x-l-(1-o)*parseFloat(d),h=n.y-u-(1-a)*parseFloat(d.slice(d.indexOf(" ")+1)),g=o?n.width/o:t.offsetWidth,_=a?n.height/a:t.offsetHeight;return{x:f,y:h,width:g,height:_,top:h,right:f+g,bottom:h+_,left:f}}else return n}function Ii(t){const e=rr(t);return{top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}}function Ri(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}}function Di(t){return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function Rs(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Un(t,e){return t.y<=e.bottom&&t.y>=e.top&&t.x>=e.left&&t.x<=e.right}function Qt(t){return Di(Ri(t))}function $r(t,e){const n=Qt(t),r=Ii(e);return Un(n,r)}function Ds(t,e){const n=Qt(t),r=Qt(e);return Rs(n,r)}function ws(t){const e=Ri(t);return e.right<0||e.left>document.documentElement.scrollWidth||e.bottom<0||e.top>document.documentElement.scrollHeight}let $t;function Sr(){$t=new Map}Sr();function Os(t){const e=Array.from(t.children).findIndex(n=>n.getAttribute(kr));if(e>=0)return $t.has(t)||$t.set(t,new Map),$t.get(t).set(e,Ii(t.children[e])),e}function As(t,e){if(!$r(t,e))return null;const n=e.children;if(n.length===0)return{index:0,isProximityBased:!0};const r=Os(e);for(let a=0;a<n.length;a++)if($r(t,n[a])){const l=$t.has(e)&&$t.get(e).get(a);return l&&!Un(Qt(t),l)?{index:r,isProximityBased:!1}:{index:a,isProximityBased:!1}}let i=Number.MAX_VALUE,o;for(let a=0;a<n.length;a++){const l=Ds(t,n[a]);l<i&&(i=l,o=a)}return{index:o,isProximityBased:!0}}function hn(t){return JSON.stringify(t,null,2)}function xn(t){if(!t)throw new Error("cannot get depth of a falsy node");return wi(t,0)}function wi(t,e=0){return t.parentElement?wi(t.parentElement,e+1):e-1}function Ps(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!{}.hasOwnProperty.call(e,n)||e[n]!==t[n])return!1;return!0}function Bs(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const Ls=200,Fr=10;let ir;function Ns(t,e,n=Ls,r){let i,o,a=!1,l;const u=Array.from(e).sort((f,h)=>xn(h)-xn(f));function d(){const f=Qt(t),h=r.multiScrollIfNeeded();if(!h&&l&&Math.abs(l.x-f.x)<Fr&&Math.abs(l.y-f.y)<Fr){ir=window.setTimeout(d,n);return}if(ws(t)){Ts(t);return}l=f;let g=!1;for(const _ of u){h&&Sr();const b=As(t,_);if(b===null)continue;const{index:E}=b;g=!0,_!==i?(i&&Es(i,t,_),Cs(_,b,t),i=_):E!==o&&(ks(_,b,t),o=E);break}!g&&a&&i?(vs(i,t),i=void 0,o=void 0,a=!1):a=!0,ir=window.setTimeout(d,n)}d()}function Ms(){clearTimeout(ir),Sr()}const qt=30;function $s(){let t;function e(){t={directionObj:void 0,stepPx:0}}e();function n(o){const{directionObj:a,stepPx:l}=t;a&&(o.scrollBy(a.x*l,a.y*l),window.requestAnimationFrame(()=>n(o)))}function r(o){return qt-o}function i(o,a){if(!a)return!1;const l=Fs(o,a),u=!!t.directionObj;if(l===null)return u&&e(),!1;let[d,f]=[!1,!1];return a.scrollHeight>a.clientHeight&&(l.bottom<qt?(d=!0,t.directionObj={x:0,y:1},t.stepPx=r(l.bottom)):l.top<qt&&(d=!0,t.directionObj={x:0,y:-1},t.stepPx=r(l.top)),!u&&d)||a.scrollWidth>a.clientWidth&&(l.right<qt?(f=!0,t.directionObj={x:1,y:0},t.stepPx=r(l.right)):l.left<qt&&(f=!0,t.directionObj={x:-1,y:0},t.stepPx=r(l.left)),!u&&f)?(n(a),!0):(e(),!1)}return{scrollIfNeeded:i,resetScrolling:e}}function Fs(t,e){const n=e===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:e.getBoundingClientRect();return Un(t,n)?{top:t.y-n.top,bottom:n.bottom-t.y,left:t.x-n.left,right:n.right-t.x}:null}function Us(t=[],e){const n=zs(t),r=Array.from(n).sort((l,u)=>xn(u)-xn(l)),{scrollIfNeeded:i,resetScrolling:o}=$s();function a(){const l=e();if(!l||!r)return!1;const u=r.filter(d=>Un(l,d.getBoundingClientRect())||d===document.scrollingElement);for(let d=0;d<u.length;d++)if(i(l,u[d]))return!0;return!1}return{multiScrollIfNeeded:n.size>0?a:()=>!1,destroy:()=>o()}}function js(t){if(!t)return[];const e=[];let n=t;for(;n;){const{overflow:r}=window.getComputedStyle(n);r.split(" ").some(i=>i.includes("auto")||i.includes("scroll"))&&e.push(n),n=n.parentElement}return e}function zs(t){const e=new Set;for(let n of t)js(n).forEach(r=>e.add(r));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&e.add(document.scrollingElement),e}function Vs(t){const e=t.cloneNode(!0),n=[],r=t.tagName==="SELECT",i=r?[t]:[...t.querySelectorAll("select")];for(const l of i)n.push(l.value);if(i.length>0){const l=r?[e]:[...e.querySelectorAll("select")];for(let u=0;u<l.length;u++){const d=l[u],f=n[u],h=d.querySelector(`option[value="${f}"`);h&&h.setAttribute("selected",!0)}}const o=t.tagName==="CANVAS",a=o?[t]:[...t.querySelectorAll("canvas")];if(a.length>0){const l=o?[e]:[...e.querySelectorAll("canvas")];for(let u=0;u<l.length;u++){const d=a[u],f=l[u];f.width=d.width,f.height=d.height,d.width>0&&d.height>0&&f.getContext("2d").drawImage(d,0,0)}}return e}const Xt=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),Gs={[Xt.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function Oi(t){if(!Xt[t])throw new Error(`Can't get non existing feature flag ${t}! Supported flags: ${Object.keys(Xt)}`);return Gs[t]}const Js=.2;function bt(t){return`${t} ${Js}s ease`}function qs(t,e){const n=t.getBoundingClientRect(),r=Vs(t);Ai(t,r),r.id=Is,r.style.position="fixed";let i=n.top,o=n.left;if(r.style.top=`${i}px`,r.style.left=`${o}px`,e){const a=Di(n);i-=a.y-e.y,o-=a.x-e.x,window.setTimeout(()=>{r.style.top=`${i}px`,r.style.left=`${o}px`},0)}return r.style.margin="0",r.style.boxSizing="border-box",r.style.height=`${n.height}px`,r.style.width=`${n.width}px`,r.style.transition=`${bt("top")}, ${bt("left")}, ${bt("background-color")}, ${bt("opacity")}, ${bt("color")} `,window.setTimeout(()=>r.style.transition+=`, ${bt("width")}, ${bt("height")}`,0),r.style.zIndex="9999",r.style.cursor="grabbing",r}function Hs(t){t.style.cursor="grab"}function Zs(t,e,n,r){Ai(e,t);const i=e.getBoundingClientRect(),o=t.getBoundingClientRect(),a=i.width-o.width,l=i.height-o.height;if(a||l){const u={left:(n-o.left)/o.width,top:(r-o.top)/o.height};Oi(Xt.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(t.style.height=`${i.height}px`,t.style.width=`${i.width}px`),t.style.left=`${parseFloat(t.style.left)-u.left*a}px`,t.style.top=`${parseFloat(t.style.top)-u.top*l}px`}}function Ai(t,e){const n=window.getComputedStyle(t);Array.from(n).filter(r=>r.startsWith("background")||r.startsWith("padding")||r.startsWith("font")||r.startsWith("text")||r.startsWith("align")||r.startsWith("justify")||r.startsWith("display")||r.startsWith("flex")||r.startsWith("border")||r==="opacity"||r==="color"||r==="list-style-type"||Oi(Xt.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&(r==="width"||r==="height")).forEach(r=>e.style.setProperty(r,n.getPropertyValue(r),n.getPropertyPriority(r)))}function Ws(t,e){t.draggable=!1,t.ondragstart=()=>!1,e?(t.style.userSelect="",t.style.WebkitUserSelect="",t.style.cursor=""):(t.style.userSelect="none",t.style.WebkitUserSelect="none",t.style.cursor="grab")}function Pi(t){t.style.display="none",t.style.position="fixed",t.style.zIndex="-5"}function Ys(t){t.style.visibility="hidden",t.setAttribute(kr,"true")}function Ks(t){t.style.visibility="",t.removeAttribute(kr)}function gn(t,e=()=>{},n=()=>[]){t.forEach(r=>{const i=e(r);Object.keys(i).forEach(o=>{r.style[o]=i[o]}),n(r).forEach(o=>r.classList.add(o))})}function In(t,e=()=>{},n=()=>[]){t.forEach(r=>{const i=e(r);Object.keys(i).forEach(o=>{r.style[o]=""}),n(r).forEach(o=>r.classList.contains(o)&&r.classList.remove(o))})}function Qs(t){const e=t.style.minHeight;t.style.minHeight=window.getComputedStyle(t).getPropertyValue("height");const n=t.style.minWidth;return t.style.minWidth=window.getComputedStyle(t).getPropertyValue("width"),function(){t.style.minHeight=e,t.style.minWidth=n}}const Xs="--any--",ea=100,ta=20,Ur=3,jr={outline:"rgba(255, 255, 102, 0.7) solid 2px"},zr="data-is-dnd-original-dragged-item";let He,Se,Be,jn,oe,zn,at,Te,ot,Ue,it=!1,xr=!1,Ir,an=!1,_n=[],Rn;const qe=new Map,fe=new Map,Wn=new WeakMap;function na(t,e){qe.has(e)||qe.set(e,new Set),qe.get(e).has(t)||(qe.get(e).add(t),Si())}function Vr(t,e){qe.get(e).delete(t),xi(),qe.get(e).size===0&&qe.delete(e)}function ra(){const t=qe.get(jn);for(const r of t)r.addEventListener($n,Bi),r.addEventListener(on,Li),r.addEventListener(Fn,Ni);window.addEventListener(vr,zt);const e=Math.max(...Array.from(t.keys()).map(r=>fe.get(r).dropAnimationDurationMs)),n=e===0?ta:Math.max(e,ea);Rn=Us(t,()=>Ue),Ns(Se,t,n*1.07,Rn)}function ia(){const t=qe.get(jn);for(const e of t)e.removeEventListener($n,Bi),e.removeEventListener(on,Li),e.removeEventListener(Fn,Ni);window.removeEventListener(vr,zt),Rn.destroy(),Rn=void 0,Ms()}function Vn(t){return t.findIndex(e=>!!e[sn])}function oa(t){return{...t,[sn]:!0,[Ce]:xs}}function Bi(t){let{items:e,dropFromOthersDisabled:n}=fe.get(t.currentTarget);if(n&&t.currentTarget!==oe)return;if(an=!1,e=e.filter(a=>a[Ce]!==at[Ce]),oe!==t.currentTarget){const l=fe.get(oe).items.filter(u=>!u[sn]);ft(oe,l,{trigger:De.DRAGGED_ENTERED_ANOTHER,id:Be[Ce],source:Ne.POINTER})}const{index:r,isProximityBased:i}=t.detail.indexObj,o=i&&r===t.currentTarget.children.length-1?r+1:r;Te=t.currentTarget,e.splice(o,0,at),ft(t.currentTarget,e,{trigger:De.DRAGGED_ENTERED,id:Be[Ce],source:Ne.POINTER})}function Li(t){if(!it)return;const{items:e,dropFromOthersDisabled:n}=fe.get(t.currentTarget);if(n&&t.currentTarget!==oe&&t.currentTarget!==Te)return;const r=[...e],i=Vn(r);i!==-1&&r.splice(i,1);const o=Te;Te=void 0;const{type:a,theOtherDz:l}=t.detail;if(a===Sn.OUTSIDE_OF_ANY||a===Sn.LEFT_FOR_ANOTHER&&l!==oe&&fe.get(l).dropFromOthersDisabled){an=!0,Te=oe;const u=o===oe?r:[...fe.get(oe).items];u.splice(zn,0,at),ft(oe,u,{trigger:De.DRAGGED_LEFT_ALL,id:Be[Ce],source:Ne.POINTER})}ft(t.currentTarget,r,{trigger:De.DRAGGED_LEFT,id:Be[Ce],source:Ne.POINTER})}function Ni(t){const{items:e,dropFromOthersDisabled:n}=fe.get(t.currentTarget);if(n&&t.currentTarget!==oe)return;const r=[...e];an=!1;const{index:i}=t.detail.indexObj,o=Vn(r);o!==-1&&r.splice(o,1),r.splice(i,0,at),ft(t.currentTarget,r,{trigger:De.DRAGGED_OVER_INDEX,id:Be[Ce],source:Ne.POINTER})}function Dn(t){t.preventDefault();const e=t.touches?t.touches[0]:t;Ue={x:e.clientX,y:e.clientY},Se.style.transform=`translate3d(${Ue.x-ot.x}px, ${Ue.y-ot.y}px, 0)`}function zt(){xr=!0,window.removeEventListener("mousemove",Dn),window.removeEventListener("touchmove",Dn),window.removeEventListener("mouseup",zt),window.removeEventListener("touchend",zt),ia(),Hs(Se),Te||(Te=oe);let{items:t,type:e}=fe.get(Te);In(qe.get(e),i=>fe.get(i).dropTargetStyle,i=>fe.get(i).dropTargetClasses);let n=Vn(t);n===-1&&Te===oe&&(n=zn),t=t.map(i=>i[sn]?Be:i);function r(){Ir(),jt(Te,t,{trigger:an?De.DROPPED_OUTSIDE_OF_ANY:De.DROPPED_INTO_ZONE,id:Be[Ce],source:Ne.POINTER}),Te!==oe&&jt(oe,fe.get(oe).items,{trigger:De.DROPPED_INTO_ANOTHER,id:Be[Ce],source:Ne.POINTER}),n!==-1&&Ks(Te.children[n]),ca()}fe.get(Te).dropAnimationDisabled?r():sa(n,r)}function sa(t,e){const n=t>-1?rr(Te.children[t]):rr(Te),r={x:n.left-parseFloat(Se.style.left),y:n.top-parseFloat(Se.style.top)},{dropAnimationDurationMs:i}=fe.get(Te),o=`transform ${i}ms ease`;Se.style.transition=Se.style.transition?Se.style.transition+","+o:o,Se.style.transform=`translate3d(${r.x}px, ${r.y}px, 0)`,window.setTimeout(e,i)}function aa(t,e){_n.push({dz:t,destroy:e}),window.requestAnimationFrame(()=>{Pi(t),document.body.appendChild(t)})}function ca(){Se.remove(),He.remove(),_n.length&&(_n.forEach(({dz:t,destroy:e})=>{e(),t.remove()}),_n=[]),Se=void 0,He=void 0,Be=void 0,jn=void 0,oe=void 0,zn=void 0,at=void 0,Te=void 0,ot=void 0,Ue=void 0,it=!1,xr=!1,Ir=void 0,an=!1}function la(t,e){let n=!1;const r={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:jr,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,dropAnimationDisabled:!1};let i=new Map;function o(){window.addEventListener("mousemove",u,{passive:!1}),window.addEventListener("touchmove",u,{passive:!1,capture:!1}),window.addEventListener("mouseup",l,{passive:!1}),window.addEventListener("touchend",l,{passive:!1})}function a(){window.removeEventListener("mousemove",u),window.removeEventListener("touchmove",u),window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l)}function l(g){a(),He=void 0,ot=void 0,Ue=void 0,g.type==="touchend"&&g.target.click()}function u(g){g.preventDefault();const _=g.touches?g.touches[0]:g;Ue={x:_.clientX,y:_.clientY},(Math.abs(Ue.x-ot.x)>=Ur||Math.abs(Ue.y-ot.y)>=Ur)&&(a(),f())}function d(g){if(g.target!==g.currentTarget&&(g.target.value!==void 0||g.target.isContentEditable)||g.button||it)return;g.preventDefault(),g.stopPropagation();const _=g.touches?g.touches[0]:g;ot={x:_.clientX,y:_.clientY},Ue={...ot},He=g.currentTarget,o()}function f(){it=!0;const g=i.get(He);zn=g,oe=He.parentElement;const _=oe.closest("dialog")||oe.getRootNode(),b=_.body||_,{items:E,type:T,centreDraggedOnCursor:S}=r,x=[...E];Be=x[g],jn=T,at=oa(Be),Se=qs(He,S&&Ue),He.setAttribute(zr,!0);function w(){Se.parentElement?window.requestAnimationFrame(w):(b.appendChild(Se),Se.focus(),ra(),Pi(He),b.appendChild(He),at[Ce]=Be[Ce])}window.requestAnimationFrame(w),gn(Array.from(qe.get(r.type)).filter(R=>R===oe||!fe.get(R).dropFromOthersDisabled),R=>fe.get(R).dropTargetStyle,R=>fe.get(R).dropTargetClasses),x.splice(g,1,at),Ir=Qs(oe),ft(oe,x,{trigger:De.DRAG_STARTED,id:Be[Ce],source:Ne.POINTER}),window.addEventListener("mousemove",Dn,{passive:!1}),window.addEventListener("touchmove",Dn,{passive:!1,capture:!1}),window.addEventListener("mouseup",zt,{passive:!1}),window.addEventListener("touchend",zt,{passive:!1})}function h({items:g=void 0,flipDurationMs:_=0,type:b=Xs,dragDisabled:E=!1,morphDisabled:T=!1,dropFromOthersDisabled:S=!1,dropTargetStyle:x=jr,dropTargetClasses:w=[],transformDraggedElement:R=()=>{},centreDraggedOnCursor:V=!1,dropAnimationDisabled:$=!1}){r.dropAnimationDurationMs=_,r.type&&b!==r.type&&Vr(t,r.type),r.type=b,r.items=[...g],r.dragDisabled=E,r.morphDisabled=T,r.transformDraggedElement=R,r.centreDraggedOnCursor=V,r.dropAnimationDisabled=$,n&&it&&!xr&&(!Ps(x,r.dropTargetStyle)||!Bs(w,r.dropTargetClasses))&&(In([t],()=>r.dropTargetStyle,()=>w),gn([t],()=>x,()=>w)),r.dropTargetStyle=x,r.dropTargetClasses=[...w];function L(A,D){return fe.get(A)?fe.get(A)[D]:r[D]}n&&it&&r.dropFromOthersDisabled!==S&&(S?In([t],A=>L(A,"dropTargetStyle"),A=>L(A,"dropTargetClasses")):gn([t],A=>L(A,"dropTargetStyle"),A=>L(A,"dropTargetClasses"))),r.dropFromOthersDisabled=S,fe.set(t,r),na(t,b);const N=it?Vn(r.items):-1;for(let A=0;A<t.children.length;A++){const D=t.children[A];if(Ws(D,E),A===N){T||Zs(Se,D,Ue.x,Ue.y),r.transformDraggedElement(Se,Be,A),Ys(D);continue}D.removeEventListener("mousedown",Wn.get(D)),D.removeEventListener("touchstart",Wn.get(D)),E||(D.addEventListener("mousedown",d),D.addEventListener("touchstart",d),Wn.set(D,d)),i.set(D,A),n||(n=!0)}}return h(e),{update:g=>{h(g)},destroy:()=>{function g(){Vr(t,fe.get(t).type),fe.delete(t)}it&&!t.closest(`[${zr}]`)?aa(t,g):g()}}}const or={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},Mi={[or.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[or.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},fa="dnd-action-aria-alert";let ue;function sr(){ue||(ue=document.createElement("div"),function(){ue.id=fa,ue.style.position="fixed",ue.style.bottom="0",ue.style.left="0",ue.style.zIndex="-5",ue.style.opacity="0",ue.style.height="0",ue.style.width="0",ue.setAttribute("role","alert")}(),document.body.prepend(ue),Object.entries(Mi).forEach(([t,e])=>document.body.prepend(pa(t,e))))}function ua(){return Tr?null:(document.readyState==="complete"?sr():window.addEventListener("DOMContentLoaded",sr),{...or})}function da(){Tr||!ue||(Object.keys(Mi).forEach(t=>{var e;return(e=document.getElementById(t))==null?void 0:e.remove()}),ue.remove(),ue=void 0)}function pa(t,e){const n=document.createElement("div");return n.id=t,n.innerHTML=`<p>${e}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}function Ft(t){if(Tr)return;ue||sr(),ue.innerHTML="";const e=document.createTextNode(t);ue.appendChild(e),ue.style.display="none",ue.style.display="inline"}const ha="--any--",Gr={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let Ve=!1,ar,Ie,kt="",Ct,We,st="";const wn=new WeakSet,Jr=new WeakMap,qr=new WeakMap,cr=new Map,ke=new Map,Je=new Map;let On;function ma(t,e){Je.size===0&&(On=ua(),window.addEventListener("keydown",$i),window.addEventListener("click",Fi)),Je.has(e)||Je.set(e,new Set),Je.get(e).has(t)||(Je.get(e).add(t),Si())}function Hr(t,e){Ie===t&&en(),Je.get(e).delete(t),xi(),Je.get(e).size===0&&Je.delete(e),Je.size===0&&(window.removeEventListener("keydown",$i),window.removeEventListener("click",Fi),On=void 0,da())}function $i(t){if(Ve)switch(t.key){case"Escape":{en();break}}}function Fi(){Ve&&(wn.has(document.activeElement)||en())}function ga(t){if(!Ve)return;const e=t.currentTarget;if(e===Ie)return;kt=e.getAttribute("aria-label")||"";const{items:n}=ke.get(Ie),r=n.find(d=>d[Ce]===We),i=n.indexOf(r),o=n.splice(i,1)[0],{items:a,autoAriaDisabled:l}=ke.get(e);e.getBoundingClientRect().top<Ie.getBoundingClientRect().top||e.getBoundingClientRect().left<Ie.getBoundingClientRect().left?(a.push(o),l||Ft(`Moved item ${st} to the end of the list ${kt}`)):(a.unshift(o),l||Ft(`Moved item ${st} to the beginning of the list ${kt}`)),jt(Ie,n,{trigger:De.DROPPED_INTO_ANOTHER,id:We,source:Ne.KEYBOARD}),jt(e,a,{trigger:De.DROPPED_INTO_ZONE,id:We,source:Ne.KEYBOARD}),Ie=e}function Ui(){cr.forEach(({update:t},e)=>t(ke.get(e)))}function en(t=!0){ke.get(Ie).autoAriaDisabled||Ft(`Stopped dragging item ${st}`),wn.has(document.activeElement)&&document.activeElement.blur(),t&&ft(Ie,ke.get(Ie).items,{trigger:De.DRAG_STOPPED,id:We,source:Ne.KEYBOARD}),In(Je.get(ar),e=>ke.get(e).dropTargetStyle,e=>ke.get(e).dropTargetClasses),Ct=null,We=null,st="",ar=null,Ie=null,kt="",Ve=!1,Ui()}function _a(t,e){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:Gr,dropTargetClasses:[],autoAriaDisabled:!1};function r(f,h,g){f.length<=1||f.splice(g,1,f.splice(h,1,f[g])[0])}function i(f){switch(f.key){case"Enter":case" ":{if((f.target.disabled!==void 0||f.target.href||f.target.isContentEditable)&&!wn.has(f.target))return;f.preventDefault(),f.stopPropagation(),Ve?en():o(f);break}case"ArrowDown":case"ArrowRight":{if(!Ve)return;f.preventDefault(),f.stopPropagation();const{items:h}=ke.get(t),g=Array.from(t.children),_=g.indexOf(f.currentTarget);_<g.length-1&&(n.autoAriaDisabled||Ft(`Moved item ${st} to position ${_+2} in the list ${kt}`),r(h,_,_+1),jt(t,h,{trigger:De.DROPPED_INTO_ZONE,id:We,source:Ne.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!Ve)return;f.preventDefault(),f.stopPropagation();const{items:h}=ke.get(t),_=Array.from(t.children).indexOf(f.currentTarget);_>0&&(n.autoAriaDisabled||Ft(`Moved item ${st} to position ${_} in the list ${kt}`),r(h,_,_-1),jt(t,h,{trigger:De.DROPPED_INTO_ZONE,id:We,source:Ne.KEYBOARD}));break}}}function o(f){l(f.currentTarget),Ie=t,ar=n.type,Ve=!0;const h=Array.from(Je.get(n.type)).filter(g=>g===Ie||!ke.get(g).dropFromOthersDisabled);if(gn(h,g=>ke.get(g).dropTargetStyle,g=>ke.get(g).dropTargetClasses),!n.autoAriaDisabled){let g=`Started dragging item ${st}. Use the arrow keys to move it within its list ${kt}`;h.length>1&&(g+=", or tab to another list in order to move the item into it"),Ft(g)}ft(t,ke.get(t).items,{trigger:De.DRAG_STARTED,id:We,source:Ne.KEYBOARD}),Ui()}function a(f){Ve&&f.currentTarget!==Ct&&(f.stopPropagation(),en(!1),o(f))}function l(f){const{items:h}=ke.get(t),g=Array.from(t.children),_=g.indexOf(f);Ct=f,Ct.tabIndex=n.zoneItemTabIndex,We=h[_][Ce],st=g[_].getAttribute("aria-label")||""}function u({items:f=[],type:h=ha,dragDisabled:g=!1,zoneTabIndex:_=0,zoneItemTabIndex:b=0,dropFromOthersDisabled:E=!1,dropTargetStyle:T=Gr,dropTargetClasses:S=[],autoAriaDisabled:x=!1}){n.items=[...f],n.dragDisabled=g,n.dropFromOthersDisabled=E,n.zoneTabIndex=_,n.zoneItemTabIndex=b,n.dropTargetStyle=T,n.dropTargetClasses=S,n.autoAriaDisabled=x,n.type&&h!==n.type&&Hr(t,n.type),n.type=h,ma(t,h),x||(t.setAttribute("aria-disabled",g),t.setAttribute("role","list"),t.setAttribute("aria-describedby",g?On.DND_ZONE_DRAG_DISABLED:On.DND_ZONE_ACTIVE)),ke.set(t,n),Ve?t.tabIndex=t===Ie||Ct.contains(t)||n.dropFromOthersDisabled||Ie&&n.type!==ke.get(Ie).type?-1:0:t.tabIndex=n.zoneTabIndex,t.addEventListener("focus",ga);for(let w=0;w<t.children.length;w++){const R=t.children[w];wn.add(R),R.tabIndex=Ve?-1:n.zoneItemTabIndex,x||R.setAttribute("role","listitem"),R.removeEventListener("keydown",Jr.get(R)),R.removeEventListener("click",qr.get(R)),g||(R.addEventListener("keydown",i),Jr.set(R,i),R.addEventListener("click",a),qr.set(R,a)),Ve&&n.items[w][Ce]===We&&(Ct=R,Ct.tabIndex=n.zoneItemTabIndex,R.focus())}}u(e);const d={update:f=>{u(f)},destroy:()=>{Hr(t,n.type),ke.delete(t),cr.delete(t)}};return cr.set(t,d),d}function Gn(t,e){if(ya(t))return{update:()=>{},destroy:()=>{}};Zr(e);const n=la(t,e),r=_a(t,e);return{update:i=>{Zr(i),n.update(i),r.update(i)},destroy:()=>{n.destroy(),r.destroy()}}}function ya(t){return!!t.closest(`[${Ss}="true"]`)}function Zr(t){const{items:e,flipDurationMs:n,type:r,dragDisabled:i,morphDisabled:o,dropFromOthersDisabled:a,zoneTabIndex:l,zoneItemTabIndex:u,dropTargetStyle:d,dropTargetClasses:f,transformDraggedElement:h,autoAriaDisabled:g,centreDraggedOnCursor:_,dropAnimationDisabled:b,...E}=t;if(Object.keys(E).length>0&&console.warn("dndzone will ignore unknown options",E),!e)throw new Error("no 'items' key provided to dndzone");const T=e.find(S=>!{}.hasOwnProperty.call(S,Ce));if(T)throw new Error(`missing '${Ce}' property for item ${hn(T)}`);if(f&&!Array.isArray(f))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof f}, ${hn(f)}`);if(l&&!Wr(l))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof l}, ${hn(l)}`);if(u&&!Wr(u))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof u}, ${hn(u)}`)}function Wr(t){return!isNaN(t)&&function(e){return(e|0)===e}(parseFloat(t))}function ba(t){let e=t[0].name+"",n,r,i,o=t[0].cost+"",a,l,u=Number.isInteger(t[0].offense),d,f=Number.isInteger(t[0].defense),h,g=u&&Yr(t),_=f&&Kr(t);return{c(){n=xe(e),r=Z(),i=P("div"),a=xe(o),l=Z(),g&&g.c(),d=Z(),_&&_.c(),h=ct(),F(i,"class","absolute left-1 top-1")},m(b,E){z(b,n,E),z(b,r,E),z(b,i,E),I(i,a),z(b,l,E),g&&g.m(b,E),z(b,d,E),_&&_.m(b,E),z(b,h,E)},p(b,E){E&1&&e!==(e=b[0].name+"")&&Le(n,e),E&1&&o!==(o=b[0].cost+"")&&Le(a,o),E&1&&(u=Number.isInteger(b[0].offense)),u?g?g.p(b,E):(g=Yr(b),g.c(),g.m(d.parentNode,d)):g&&(g.d(1),g=null),E&1&&(f=Number.isInteger(b[0].defense)),f?_?_.p(b,E):(_=Kr(b),_.c(),_.m(h.parentNode,h)):_&&(_.d(1),_=null)},d(b){b&&(j(n),j(r),j(i),j(l),j(d),j(h)),g&&g.d(b),_&&_.d(b)}}}function Ca(t){let e,n=t[0].name+"",r,i,o,a,l,u=t[0].rulesText+"",d,f,h,g,_=t[0].cost+"",b,E,T,S=t[0].speed+"",x,w,R=Number.isInteger(t[0].offense),V,$=Number.isInteger(t[0].defense),L,N=R&&Qr(t),A=$&&ei(t);return{c(){e=P("div"),r=xe(n),i=Z(),o=P("div"),a=Z(),l=P("div"),d=xe(u),f=Z(),h=P("div"),g=P("div"),b=xe(_),E=Z(),T=P("div"),x=xe(S),w=Z(),N&&N.c(),V=Z(),A&&A.c(),L=ct(),F(e,"class","absolute top-2"),F(o,"class","h-5"),F(l,"class","items-center p-2 text-xs"),F(h,"class","absolute left-1 top-1 flex flex-col")},m(D,O){z(D,e,O),I(e,r),z(D,i,O),z(D,o,O),z(D,a,O),z(D,l,O),I(l,d),z(D,f,O),z(D,h,O),I(h,g),I(g,b),I(h,E),I(h,T),I(T,x),z(D,w,O),N&&N.m(D,O),z(D,V,O),A&&A.m(D,O),z(D,L,O)},p(D,O){O&1&&n!==(n=D[0].name+"")&&Le(r,n),O&1&&u!==(u=D[0].rulesText+"")&&Le(d,u),O&1&&_!==(_=D[0].cost+"")&&Le(b,_),O&1&&S!==(S=D[0].speed+"")&&Le(x,S),O&1&&(R=Number.isInteger(D[0].offense)),R?N?N.p(D,O):(N=Qr(D),N.c(),N.m(V.parentNode,V)):N&&(N.d(1),N=null),O&1&&($=Number.isInteger(D[0].defense)),$?A?A.p(D,O):(A=ei(D),A.c(),A.m(L.parentNode,L)):A&&(A.d(1),A=null)},d(D){D&&(j(e),j(i),j(o),j(a),j(l),j(f),j(h),j(w),j(V),j(L)),N&&N.d(D),A&&A.d(D)}}}function Yr(t){let e,n=t[0].offense+"",r;return{c(){e=P("div"),r=xe(n),F(e,"class","absolute bottom-1 left-1 flex flex-col")},m(i,o){z(i,e,o),I(e,r)},p(i,o){o&1&&n!==(n=i[0].offense+"")&&Le(r,n)},d(i){i&&j(e)}}}function Kr(t){let e,n=t[0].defense+"",r;return{c(){e=P("div"),r=xe(n),F(e,"class","absolute bottom-1 right-1 flex flex-col")},m(i,o){z(i,e,o),I(e,r)},p(i,o){o&1&&n!==(n=i[0].defense+"")&&Le(r,n)},d(i){i&&j(e)}}}function Qr(t){let e,n,r=t[0].offense+"",i,o,a=t[1]&&Xr(t);return{c(){e=P("div"),n=P("div"),i=xe(r),o=Z(),a&&a.c(),F(e,"class","absolute bottom-1 left-1 flex flex-row")},m(l,u){z(l,e,u),I(e,n),I(n,i),I(e,o),a&&a.m(e,null)},p(l,u){u&1&&r!==(r=l[0].offense+"")&&Le(i,r),l[1]?a?a.p(l,u):(a=Xr(l),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(l){l&&j(e),a&&a.d()}}}function Xr(t){let e,n,r,i,o,a;return{c(){e=P("div"),n=P("div"),n.textContent="▲",r=Z(),i=P("div"),i.textContent="▼",F(n,"class","hover:cursor-pointer"),F(i,"class","hover:cursor-pointer"),F(e,"class","ml-1 flex flex-col justify-evenly gap-0 text-[0.5rem] leading-[0.5rem]")},m(l,u){z(l,e,u),I(e,n),I(e,r),I(e,i),o||(a=[de(n,"click",t[19]),de(i,"click",t[20])],o=!0)},p:Ee,d(l){l&&j(e),o=!1,Me(a)}}}function ei(t){let e,n,r=t[0].defense+"",i,o,a=t[1]&&ti(t);return{c(){e=P("div"),n=P("div"),i=xe(r),o=Z(),a&&a.c(),F(e,"class","absolute bottom-1 right-1 flex flex-row")},m(l,u){z(l,e,u),I(e,n),I(n,i),I(e,o),a&&a.m(e,null)},p(l,u){u&1&&r!==(r=l[0].defense+"")&&Le(i,r),l[1]?a?a.p(l,u):(a=ti(l),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},d(l){l&&j(e),a&&a.d()}}}function ti(t){let e,n,r,i,o,a;return{c(){e=P("div"),n=P("div"),n.textContent="▲",r=Z(),i=P("div"),i.textContent="▼",F(n,"class","hover:cursor-pointer"),F(i,"class","hover:cursor-pointer"),F(e,"class","ml-1 flex flex-col justify-evenly gap-0 text-[0.5rem] leading-[0.5rem]")},m(l,u){z(l,e,u),I(e,n),I(e,r),I(e,i),o||(a=[de(n,"click",t[21]),de(i,"click",t[22])],o=!0)},p:Ee,d(l){l&&j(e),o=!1,Me(a)}}}function Ea(t){let e,n,r,i,o,a;function l(f,h){if(f[3]&&!f[2])return Ca;if(!f[2])return ba}let u=l(t),d=u&&u(t);return{c(){e=P("div"),d&&d.c(),n=Z(),r=P("div"),F(r,"class","absolute z-30 h-[6rem] w-[8.5rem]"),F(e,"class",i=Pr(t[4])+" svelte-1wikwho")},m(f,h){z(f,e,h),d&&d.m(e,null),I(e,n),I(e,r),o||(a=[de(r,"mouseover",t[5]),de(r,"mouseleave",t[6]),de(r,"drag",t[6]),de(r,"click",t[8]),de(e,"contextmenu",t[7])],o=!0)},p(f,[h]){u===(u=l(f))&&d?d.p(f,h):(d&&d.d(1),d=u&&u(f),d&&(d.c(),d.m(e,n))),h&16&&i!==(i=Pr(f[4])+" svelte-1wikwho")&&F(e,"class",i)},i:Ee,o:Ee,d(f){f&&j(e),d&&d.d(),o=!1,Me(a)}}}const va="pt-2 -mb-[6rem] -ml-[2.75rem] -mt-[6rem] z-20 min-w-[14rem] min-h-[18rem] object-cover",ka="shadow shadow-green-500",Ta="!visible opacity-100 shadow shadow-red-500",Sa="shadow shadow-yellow-500";let xa=250;function Ia(t,e,n){let r,i,o,a,l,u,{card:d}=e,{extraClasses:f=""}=e,{forceDisableHover:h=!1}=e,{updateCard:g}=e,_=!1,b=!1;const E="text-sm flex flex-col justify-center items-center h-[6rem] w-[8.5rem] rounded border border-black bg-white relative";function T(){n(15,_=!0)}function S(){n(15,_=!1)}function x(k){k.preventDefault(),d.state!=="Facedown"&&(n(0,d.state=d.state==="Active"?"Faceup":"Active",d),g())}function w(k){k.preventDefault(),d.state!=="Active"&&(n(0,d.state=d.state==="Faceup"?"Facedown":"Faceup",d),g())}let R=!1,V=null;function $(k){if(R){clearTimeout(V),R=!1,w(k);return}R=!0,V=setTimeout(()=>{R=!1,n(1,b=!b)},xa)}function L(k){n(0,d.offense+=k,d),g()}function N(k){n(0,d.defense+=k,d),g()}const A=()=>L(1),D=()=>L(-1),O=()=>N(1),U=()=>N(-1);return t.$$set=k=>{"card"in k&&n(0,d=k.card),"extraClasses"in k&&n(11,f=k.extraClasses),"forceDisableHover"in k&&n(12,h=k.forceDisableHover),"updateCard"in k&&n(13,g=k.updateCard)},t.$$.update=()=>{t.$$.dirty&1&&n(2,r=d.state==="Facedown"),t.$$.dirty&1&&n(16,i=d.state==="Active"),t.$$.dirty&4100&&n(18,o=h||r),t.$$.dirty&32770&&n(3,a=_||b),t.$$.dirty&1&&n(17,l=d[sn]),t.$$.dirty&460814&&n(4,u=`${E} ${o||l||!a?"":va} ${l?Ta:""} ${r?"card-facedown":""} ${i?ka:""} ${b?Sa:""} ${f}`)},[d,b,r,a,u,T,S,x,$,L,N,f,h,g,E,_,i,l,o,A,D,O,U]}class cn extends ht{constructor(e){super(),pt(this,e,Ia,Ea,dt,{card:0,extraClasses:11,forceDisableHover:12,updateCard:13,baseStyle:14})}get baseStyle(){return this.$$.ctx[14]}}function ut(t){t.innerHTML="",t.className="text-sm flex flex-col justify-center items-center h-[6rem] w-[8.5rem] rounded border border-black bg-white relative",t.style.margin="6rem 0 0 2.75rem"}function ni(t,e,n){const r=t.slice();return r[8]=e[n],r[10]=n,r}function ri(t,e){let n,r,i;return r=new cn({props:{card:e[8],updateCard:e[4]}}),{key:t,first:null,c(){n=ct(),ie(r.$$.fragment),this.first=n},m(o,a){z(o,n,a),te(r,o,a),i=!0},p(o,a){e=o;const l={};a&1&&(l.card=e[8]),r.$set(l)},i(o){i||(W(r.$$.fragment,o),i=!0)},o(o){Y(r.$$.fragment,o),i=!1},d(o){o&&j(n),ne(r,o)}}}function Ra(t){let e,n,r,i=[],o=new Map,a,l,u,d,f=lt(t[0]);const h=g=>g[8].id;for(let g=0;g<f.length;g+=1){let _=ni(t,f,g),b=h(_);o.set(b,i[g]=ri(b,_))}return{c(){e=P("div"),n=xe(`Reality\r
    `),r=P("div");for(let g=0;g<i.length;g+=1)i[g].c();Qn(r,"grid-template-columns","repeat(6, 8.5rem)"),F(r,"class","grid max-h-[13.25rem] min-h-[12rem] min-w-[51rem] gap-x-1")},m(g,_){z(g,e,_),I(e,n),I(e,r);for(let b=0;b<i.length;b+=1)i[b]&&i[b].m(r,null);l=!0,u||(d=[Bn(a=Gn.call(null,r,{items:t[0],dropFromOthersDisabled:t[2],type:t[1],flipDurationMs:200,transformDraggedElement:ut,dropAnimationDisabled:!0})),de(r,"consider",t[3]),de(r,"finalize",t[3])],u=!0)},p(g,[_]){_&17&&(f=lt(g[0]),Tt(),i=Nn(i,_,h,1,g,f,o,r,Ln,ri,null,ni),St()),a&&xt(a.update)&&_&7&&a.update.call(null,{items:g[0],dropFromOthersDisabled:g[2],type:g[1],flipDurationMs:200,transformDraggedElement:ut,dropAnimationDisabled:!0})},i(g){if(!l){for(let _=0;_<f.length;_+=1)W(i[_]);l=!0}},o(g){for(let _=0;_<i.length;_+=1)Y(i[_]);l=!1},d(g){g&&j(e);for(let _=0;_<i.length;_+=1)i[_].d();u=!1,Me(d)}}}function Da(t,e,n){let r,{area:i}=e,{dragType:o}=e;const a={Unit:0,Item:1,Claim:2};function l(h){return a[h.type]===void 0?100:a[h.type]}function u(h,g){return l(h)-l(g)}function d(h){n(0,i=h.detail.items.sort(u))}function f(){n(0,i)}return t.$$set=h=>{"area"in h&&n(0,i=h.area),"dragType"in h&&n(1,o=h.dragType)},t.$$.update=()=>{t.$$.dirty&1&&n(2,r=i.length>=hs)},[i,o,r,d,f]}class ji extends ht{constructor(e){super(),pt(this,e,Da,Ra,dt,{area:0,dragType:1})}}function ii(t,e,n){const r=t.slice();return r[5]=e[n],r[7]=n,r}function oi(t){let e,n,r;return n=new cn({props:{card:t[0][t[0].length-2],extraClasses:"-mr-[8rem] -z-10 relative pointer-events-none",updateCard:t[4]}}),{c(){e=P("div"),ie(n.$$.fragment)},m(i,o){z(i,e,o),te(n,e,null),r=!0},p(i,o){const a={};o&1&&(a.card=i[0][i[0].length-2]),n.$set(a)},i(i){r||(W(n.$$.fragment,i),r=!0)},o(i){Y(n.$$.fragment,i),r=!1},d(i){i&&j(e),ne(n)}}}function wa(t){let e;return{c(){e=P("div")},m(n,r){z(n,e,r)},p:Ee,i:Ee,o:Ee,d(n){n&&j(e)}}}function Oa(t){let e,n;return e=new cn({props:{card:t[5],updateCard:t[4]}}),{c(){ie(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p(r,i){const o={};i&1&&(o.card=r[5]),e.$set(o)},i(r){n||(W(e.$$.fragment,r),n=!0)},o(r){Y(e.$$.fragment,r),n=!1},d(r){ne(e,r)}}}function si(t,e){let n,r,i,o,a;const l=[Oa,wa],u=[];function d(f,h){return f[7]===f[0].length-1?0:1}return r=d(e),i=u[r]=l[r](e),{key:t,first:null,c(){n=ct(),i.c(),o=ct(),this.first=n},m(f,h){z(f,n,h),u[r].m(f,h),z(f,o,h),a=!0},p(f,h){e=f;let g=r;r=d(e),r===g?u[r].p(e,h):(Tt(),Y(u[g],1,1,()=>{u[g]=null}),St(),i=u[r],i?i.p(e,h):(i=u[r]=l[r](e),i.c()),W(i,1),i.m(o.parentNode,o))},i(f){a||(W(i),a=!0)},o(f){Y(i),a=!1},d(f){f&&(j(n),j(o)),u[r].d(f)}}}function Aa(t){let e,n,r,i,o,a,l=[],u=new Map,d,f,h,g,_=t[0].length>1&&oi(t),b=lt(t[0]);const E=T=>T[5].id;for(let T=0;T<b.length;T+=1){let S=ii(t,b,T),x=E(S);u.set(x,l[T]=si(x,S))}return{c(){e=P("div"),n=xe(t[1]),r=Z(),i=P("div"),_&&_.c(),o=Z(),a=P("div");for(let T=0;T<l.length;T+=1)l[T].c();F(a,"class","flex h-[6rem] w-[8.5rem]"),F(i,"class","flex w-[9rem] rounded shadow-inner")},m(T,S){z(T,e,S),I(e,n),I(e,r),I(e,i),_&&_.m(i,null),I(i,o),I(i,a);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(a,null);f=!0,h||(g=[Bn(d=Gn.call(null,a,{items:t[0],type:t[2],transformDraggedElement:ut,dropAnimationDisabled:!0})),de(a,"consider",t[3]),de(a,"finalize",t[3])],h=!0)},p(T,[S]){(!f||S&2)&&Le(n,T[1]),T[0].length>1?_?(_.p(T,S),S&1&&W(_,1)):(_=oi(T),_.c(),W(_,1),_.m(i,o)):_&&(Tt(),Y(_,1,1,()=>{_=null}),St()),S&17&&(b=lt(T[0]),Tt(),l=Nn(l,S,E,1,T,b,u,a,Ln,si,null,ii),St()),d&&xt(d.update)&&S&5&&d.update.call(null,{items:T[0],type:T[2],transformDraggedElement:ut,dropAnimationDisabled:!0})},i(T){if(!f){W(_);for(let S=0;S<b.length;S+=1)W(l[S]);f=!0}},o(T){Y(_);for(let S=0;S<l.length;S+=1)Y(l[S]);f=!1},d(T){T&&j(e),_&&_.d();for(let S=0;S<l.length;S+=1)l[S].d();h=!1,Me(g)}}}function Pa(t,e){for(let n=0;n<e.length-1;++n){let r=e[n];if(t.findIndex(o=>o.id===r.id)===-1){let o=e[e.length-1];return e[e.length-1]=r,e[n]=o,e}}return e}function Ba(t,e,n){let{deck:r}=e,{name:i}=e,{dragType:o}=e;function a(u){n(0,r=Pa(r,u.detail.items))}function l(){n(0,r)}return t.$$set=u=>{"deck"in u&&n(0,r=u.deck),"name"in u&&n(1,i=u.name),"dragType"in u&&n(2,o=u.dragType)},[r,i,o,a,l]}class Ye extends ht{constructor(e){super(),pt(this,e,Ba,Aa,dt,{deck:0,name:1,dragType:2})}}function ai(t,e,n){const r=t.slice();return r[7]=e[n],r[9]=n,r}function ci(t,e){let n,r,i;return r=new cn({props:{card:e[7],updateCard:e[6]}}),{key:t,first:null,c(){n=ct(),ie(r.$$.fragment),this.first=n},m(o,a){z(o,n,a),te(r,o,a),i=!0},p(o,a){e=o;const l={};a&1&&(l.card=e[7]),r.$set(l)},i(o){i||(W(r.$$.fragment,o),i=!0)},o(o){Y(r.$$.fragment,o),i=!1},d(o){o&&j(n),ne(r,o)}}}function La(t){let e,n,r,i,o=[],a=new Map,l,u,d,f,h,g=lt(t[0]);const _=b=>b[7].id;for(let b=0;b<g.length;b+=1){let E=ai(t,g,b),T=_(E);a.set(T,o[b]=ci(T,E))}return{c(){e=P("div"),n=xe(t[1]),r=Z(),i=P("div");for(let b=0;b<o.length;b+=1)o[b].c();F(i,"class",l="grid "+(t[4]?"min-h-[66rem]":"min-h-[6rem]")+" min-w-[8.5rem] gap-x-1"),Qn(i,"grid-template-columns","repeat("+t[2]+", 8.5rem)")},m(b,E){z(b,e,E),I(e,n),I(e,r),I(e,i);for(let T=0;T<o.length;T+=1)o[T]&&o[T].m(i,null);d=!0,f||(h=[Bn(u=Gn.call(null,i,{items:t[0],type:t[3],transformDraggedElement:ut,dropAnimationDisabled:!0})),de(i,"consider",t[5]),de(i,"finalize",t[5])],f=!0)},p(b,[E]){(!d||E&2)&&Le(n,b[1]),E&65&&(g=lt(b[0]),Tt(),o=Nn(o,E,_,1,b,g,a,i,Ln,ci,null,ai),St()),(!d||E&16&&l!==(l="grid "+(b[4]?"min-h-[66rem]":"min-h-[6rem]")+" min-w-[8.5rem] gap-x-1"))&&F(i,"class",l),(!d||E&4)&&Qn(i,"grid-template-columns","repeat("+b[2]+", 8.5rem)"),u&&xt(u.update)&&E&9&&u.update.call(null,{items:b[0],type:b[3],transformDraggedElement:ut,dropAnimationDisabled:!0})},i(b){if(!d){for(let E=0;E<g.length;E+=1)W(o[E]);d=!0}},o(b){for(let E=0;E<o.length;E+=1)Y(o[E]);d=!1},d(b){b&&j(e);for(let E=0;E<o.length;E+=1)o[E].d();f=!1,Me(h)}}}function Na(t,e,n){let{area:r}=e,{name:i}=e,{col:o=6}=e,{dragType:a}=e,{isDream:l=!1}=e;function u(f){n(0,r=f.detail.items)}function d(){n(0,r)}return t.$$set=f=>{"area"in f&&n(0,r=f.area),"name"in f&&n(1,i=f.name),"col"in f&&n(2,o=f.col),"dragType"in f&&n(3,a=f.dragType),"isDream"in f&&n(4,l=f.isDream)},[r,i,o,a,l,u,d]}class lr extends ht{constructor(e){super(),pt(this,e,Na,La,dt,{area:0,name:1,col:2,dragType:3,isDream:4})}}function Ma(t){let e,n,r,i,o,a,l,u,d,f,h,g,_,b,E,T,S,x,w,R,V,$,L,N,A,D,O,U,k,q,pe,$e,K,ve,ye;function Oe(M){t[2](M)}let Ge={name:"Combat",dragType:"player"};t[0].combatArea!==void 0&&(Ge.area=t[0].combatArea),i=new lr({props:Ge}),le.push(()=>_e(i,"area",Oe));function Xe(M){t[3](M)}let wt={name:"Memory",dragType:"player"};t[0].memDiscard!==void 0&&(wt.deck=t[0].memDiscard),u=new Ye({props:wt}),le.push(()=>_e(u,"deck",Xe));function re(M){t[4](M)}let he={dragType:"player"};t[0].reality!==void 0&&(he.area=t[0].reality),b=new ji({props:he}),le.push(()=>_e(b,"area",re));function mt(M){t[5](M)}let gt={name:"Hand",dragType:"player"};t[1]!==void 0&&(gt.area=t[1]),x=new lr({props:gt}),le.push(()=>_e(x,"area",mt));function _t(M){t[6](M)}let G={name:"Channeled",dragType:"player"};t[0].channeled!==void 0&&(G.deck=t[0].channeled),L=new Ye({props:G}),le.push(()=>_e(L,"deck",_t));function Ae(M){t[7](M)}let je={name:"Void",dragType:"player"};t[0].voidPile!==void 0&&(je.deck=t[0].voidPile),D=new Ye({props:je}),le.push(()=>_e(D,"deck",Ae));function et(M){t[8](M)}let tt={name:"Random",dragType:"player"};t[0].randomZone!==void 0&&(tt.deck=t[0].randomZone),q=new Ye({props:tt}),le.push(()=>_e(q,"deck",et));function Ot(M){t[9](M)}let nt={name:"Deck",dragType:"player"};return t[0].deck!==void 0&&(nt.deck=t[0].deck),K=new Ye({props:nt}),le.push(()=>_e(K,"deck",Ot)),{c(){e=P("div"),n=P("div"),r=P("div"),ie(i.$$.fragment),a=Z(),l=P("div"),ie(u.$$.fragment),f=Z(),h=P("div"),g=P("div"),_=P("div"),ie(b.$$.fragment),T=Z(),S=P("div"),ie(x.$$.fragment),R=Z(),V=P("div"),$=P("div"),ie(L.$$.fragment),A=Z(),ie(D.$$.fragment),U=Z(),k=P("div"),ie(q.$$.fragment),$e=Z(),ie(K.$$.fragment),F(r,"class","min-w-2/3 rounded border border-black p-1"),F(l,"class","min-w-1/3 rounded border border-black p-1"),F(n,"class","flex flex-row gap-1"),F(_,"class","rounded border border-black p-1"),F(S,"class","rounded border border-black p-1"),F(g,"class","flex flex-col"),F($,"class","flex flex-row gap-1"),F(k,"class","flex flex-row gap-1"),F(V,"class","flex h-fit flex-col gap-1 rounded border border-black p-1"),F(h,"class","flex flex-row gap-1"),F(e,"class","flex flex-col gap-1")},m(M,me){z(M,e,me),I(e,n),I(n,r),te(i,r,null),I(n,a),I(n,l),te(u,l,null),I(e,f),I(e,h),I(h,g),I(g,_),te(b,_,null),I(g,T),I(g,S),te(x,S,null),I(h,R),I(h,V),I(V,$),te(L,$,null),I($,A),te(D,$,null),I(V,U),I(V,k),te(q,k,null),I(k,$e),te(K,k,null),ye=!0},p(M,[me]){const ln={};!o&&me&1&&(o=!0,ln.area=M[0].combatArea,ge(()=>o=!1)),i.$set(ln);const fn={};!d&&me&1&&(d=!0,fn.deck=M[0].memDiscard,ge(()=>d=!1)),u.$set(fn);const At={};!E&&me&1&&(E=!0,At.area=M[0].reality,ge(()=>E=!1)),b.$set(At);const un={};!w&&me&2&&(w=!0,un.area=M[1],ge(()=>w=!1)),x.$set(un);const dn={};!N&&me&1&&(N=!0,dn.deck=M[0].channeled,ge(()=>N=!1)),L.$set(dn);const Gt={};!O&&me&1&&(O=!0,Gt.deck=M[0].voidPile,ge(()=>O=!1)),D.$set(Gt);const yt={};!pe&&me&1&&(pe=!0,yt.deck=M[0].randomZone,ge(()=>pe=!1)),q.$set(yt);const Fe={};!ve&&me&1&&(ve=!0,Fe.deck=M[0].deck,ge(()=>ve=!1)),K.$set(Fe)},i(M){ye||(W(i.$$.fragment,M),W(u.$$.fragment,M),W(b.$$.fragment,M),W(x.$$.fragment,M),W(L.$$.fragment,M),W(D.$$.fragment,M),W(q.$$.fragment,M),W(K.$$.fragment,M),ye=!0)},o(M){Y(i.$$.fragment,M),Y(u.$$.fragment,M),Y(b.$$.fragment,M),Y(x.$$.fragment,M),Y(L.$$.fragment,M),Y(D.$$.fragment,M),Y(q.$$.fragment,M),Y(K.$$.fragment,M),ye=!1},d(M){M&&j(e),ne(i),ne(u),ne(b),ne(x),ne(L),ne(D),ne(q),ne(K)}}}function $a(t,e,n){let{playArea:r}=e,{hand:i}=e;function o(_){t.$$.not_equal(r.combatArea,_)&&(r.combatArea=_,n(0,r))}function a(_){t.$$.not_equal(r.memDiscard,_)&&(r.memDiscard=_,n(0,r))}function l(_){t.$$.not_equal(r.reality,_)&&(r.reality=_,n(0,r))}function u(_){i=_,n(1,i)}function d(_){t.$$.not_equal(r.channeled,_)&&(r.channeled=_,n(0,r))}function f(_){t.$$.not_equal(r.voidPile,_)&&(r.voidPile=_,n(0,r))}function h(_){t.$$.not_equal(r.randomZone,_)&&(r.randomZone=_,n(0,r))}function g(_){t.$$.not_equal(r.deck,_)&&(r.deck=_,n(0,r))}return t.$$set=_=>{"playArea"in _&&n(0,r=_.playArea),"hand"in _&&n(1,i=_.hand)},[r,i,o,a,l,u,d,f,h,g]}class Fa extends ht{constructor(e){super(),pt(this,e,$a,Ma,dt,{playArea:0,hand:1})}}function Ua(t){let e,n,r,i,o,a,l,u,d,f,h,g,_,b,E,T,S,x,w,R,V,$,L,N,A,D,O,U,k,q;function pe(G){t[1](G)}let $e={dragType:"opponent"};t[0].reality!==void 0&&($e.area=t[0].reality),i=new ji({props:$e}),le.push(()=>_e(i,"area",pe));function K(G){t[2](G)}let ve={name:"Combat",dragType:"opponent"};t[0].combatArea!==void 0&&(ve.area=t[0].combatArea),d=new lr({props:ve}),le.push(()=>_e(d,"area",K));function ye(G){t[3](G)}let Oe={name:"Memory",dragType:"opponent"};t[0].memDiscard!==void 0&&(Oe.deck=t[0].memDiscard),_=new Ye({props:Oe}),le.push(()=>_e(_,"deck",ye));function Ge(G){t[4](G)}let Xe={name:"Channeled",dragType:"opponent"};t[0].channeled!==void 0&&(Xe.deck=t[0].channeled),x=new Ye({props:Xe}),le.push(()=>_e(x,"deck",Ge));function wt(G){t[5](G)}let re={name:"Void",dragType:"opponent"};t[0].voidPile!==void 0&&(re.deck=t[0].voidPile),V=new Ye({props:re}),le.push(()=>_e(V,"deck",wt));function he(G){t[6](G)}let mt={name:"Random",dragType:"opponent"};t[0].randomZone!==void 0&&(mt.deck=t[0].randomZone),A=new Ye({props:mt}),le.push(()=>_e(A,"deck",he));function gt(G){t[7](G)}let _t={name:"Deck",dragType:"opponent"};return t[0].deck!==void 0&&(_t.deck=t[0].deck),U=new Ye({props:_t}),le.push(()=>_e(U,"deck",gt)),{c(){e=P("div"),n=P("div"),r=P("div"),ie(i.$$.fragment),a=Z(),l=P("div"),u=P("div"),ie(d.$$.fragment),h=Z(),g=P("div"),ie(_.$$.fragment),E=Z(),T=P("div"),S=P("div"),ie(x.$$.fragment),R=Z(),ie(V.$$.fragment),L=Z(),N=P("div"),ie(A.$$.fragment),O=Z(),ie(U.$$.fragment),F(r,"class","max-w-fit rounded border border-black p-1"),F(u,"class","h-fit rounded border border-black p-1"),F(g,"class","h-fit rounded border border-black p-1"),F(l,"class","flex min-w-fit flex-row"),F(n,"class","flex flex-col"),F(S,"class","flex flex-row gap-1"),F(N,"class","flex flex-row gap-1"),F(T,"class","h-fit rounded border border-black p-1"),F(e,"class","flex flex-row gap-1")},m(G,Ae){z(G,e,Ae),I(e,n),I(n,r),te(i,r,null),I(n,a),I(n,l),I(l,u),te(d,u,null),I(l,h),I(l,g),te(_,g,null),I(e,E),I(e,T),I(T,S),te(x,S,null),I(S,R),te(V,S,null),I(T,L),I(T,N),te(A,N,null),I(N,O),te(U,N,null),q=!0},p(G,[Ae]){const je={};!o&&Ae&1&&(o=!0,je.area=G[0].reality,ge(()=>o=!1)),i.$set(je);const et={};!f&&Ae&1&&(f=!0,et.area=G[0].combatArea,ge(()=>f=!1)),d.$set(et);const tt={};!b&&Ae&1&&(b=!0,tt.deck=G[0].memDiscard,ge(()=>b=!1)),_.$set(tt);const Ot={};!w&&Ae&1&&(w=!0,Ot.deck=G[0].channeled,ge(()=>w=!1)),x.$set(Ot);const nt={};!$&&Ae&1&&($=!0,nt.deck=G[0].voidPile,ge(()=>$=!1)),V.$set(nt);const M={};!D&&Ae&1&&(D=!0,M.deck=G[0].randomZone,ge(()=>D=!1)),A.$set(M);const me={};!k&&Ae&1&&(k=!0,me.deck=G[0].deck,ge(()=>k=!1)),U.$set(me)},i(G){q||(W(i.$$.fragment,G),W(d.$$.fragment,G),W(_.$$.fragment,G),W(x.$$.fragment,G),W(V.$$.fragment,G),W(A.$$.fragment,G),W(U.$$.fragment,G),q=!0)},o(G){Y(i.$$.fragment,G),Y(d.$$.fragment,G),Y(_.$$.fragment,G),Y(x.$$.fragment,G),Y(V.$$.fragment,G),Y(A.$$.fragment,G),Y(U.$$.fragment,G),q=!1},d(G){G&&j(e),ne(i),ne(d),ne(_),ne(x),ne(V),ne(A),ne(U)}}}function ja(t,e,n){let{playArea:r}=e;function i(h){t.$$.not_equal(r.reality,h)&&(r.reality=h,n(0,r))}function o(h){t.$$.not_equal(r.combatArea,h)&&(r.combatArea=h,n(0,r))}function a(h){t.$$.not_equal(r.memDiscard,h)&&(r.memDiscard=h,n(0,r))}function l(h){t.$$.not_equal(r.channeled,h)&&(r.channeled=h,n(0,r))}function u(h){t.$$.not_equal(r.voidPile,h)&&(r.voidPile=h,n(0,r))}function d(h){t.$$.not_equal(r.randomZone,h)&&(r.randomZone=h,n(0,r))}function f(h){t.$$.not_equal(r.deck,h)&&(r.deck=h,n(0,r))}return t.$$set=h=>{"playArea"in h&&n(0,r=h.playArea)},[r,i,o,a,l,u,d,f]}class za extends ht{constructor(e){super(),pt(this,e,ja,Ua,dt,{playArea:0})}}class Va{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return Ga(e).buffer}}function Ga(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t){const o=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);n.set(o,r),r+=i.byteLength}return n}function zi(t){return new Ja(t).unpack()}function Vi(t){const e=new qa,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class Ja{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,i="",o,a;for(;r<e;)o=n[r],o<160?(a=o,r++):(o^192)<32?(a=(o&31)<<6|n[r+1]&63,r+=2):(o^224)<16?(a=(o&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(a=(o&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),i+=String.fromCodePoint(a);return this.index+=e,i}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const i=this.unpack();n[i]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(n===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,a=(e&1048575|1048576)*2**(i-20)+n*2**(i-52);return(r===0?1:-1)*a}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class qa{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<n){const o=this.pack(e[i]);return o instanceof Promise?o.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,o=Math.floor(i*2**52),a=2**32,l=n<<31|r+1023<<20|o/a&1048575,u=o%a;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(u)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=o=>{if(o<n.length){const a=n[o];if(e.hasOwnProperty(a)){this.pack(a);const l=this.pack(e[a]);if(l instanceof Promise)return l.then(()=>i(o+1))}return i(o+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new Va,this._textEncoder=new TextEncoder}}let Gi=!0,Ji=!0;function yn(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function It(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(a,l){if(a!==e)return i.apply(this,arguments);const u=d=>{const f=n(d);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,u),i.apply(this,[a,u])};const o=r.removeEventListener;r.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const u=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,u])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Ha(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Gi=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Za(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Ji=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function qi(){if(typeof window=="object"){if(Gi)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Rr(t,e){Ji&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Wa(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=yn(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=yn(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=yn(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function li(t){return Object.prototype.toString.call(t)==="[object Object]"}function Hi(t){return li(t)?Object.keys(t).reduce(function(e,n){const r=li(t[n]),i=r?Hi(t[n]):t[n],o=r&&!Object.keys(i).length;return i===void 0||o?e:Object.assign(e,{[n]:i})},{}):t}function fr(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?fr(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{fr(t,t.get(i),n)})}))}function fi(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const o=[];return t.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{t.forEach(l=>{l.type===r&&l.trackId===a.id&&fr(t,l,i)})}),i}const ui=qi;function Zi(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const f=typeof l[d]=="object"?l[d]:{ideal:l[d]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const h=function(g,_){return g?g+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(f.ideal!==void 0){u.optional=u.optional||[];let g={};typeof f.ideal=="number"?(g[h("min",d)]=f.ideal,u.optional.push(g),g={},g[h("max",d)]=f.ideal,u.optional.push(g)):(g[h("",d)]=f.ideal,u.optional.push(g))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[h("",d)]=f.exact):["min","max"].forEach(g=>{f[g]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[h(g,d)]=f[g])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},i=function(l,u){if(e.version>=61)return u(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(f,h,g){h in f&&!(g in f)&&(f[g]=f[h],delete f[h])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const f=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!f)){delete l.video.facingMode;let h;if(d.exact==="environment"||d.ideal==="environment"?h=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(g=>{g=g.filter(b=>b.kind==="videoinput");let _=g.find(b=>h.some(E=>b.label.toLowerCase().includes(E)));return!_&&g.length&&h.includes("back")&&(_=g[g.length-1]),_&&(l.video.deviceId=d.exact?{exact:_.deviceId}:{ideal:_.deviceId}),l.video=r(l.video),ui("chrome: "+JSON.stringify(l)),u(l)})}l.video=r(l.video)}return ui("chrome: "+JSON.stringify(l)),u(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,u,d){i(l,f=>{n.webkitGetUserMedia(f,u,h=>{d&&d(o(h))})})};if(n.getUserMedia=a.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return i(u,d=>l(d).then(f=>{if(d.audio&&!f.getAudioTracks().length||d.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(o(f))))}}}function Wi(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Yi(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):o={track:i.track};const a=new Event("track");a.track=i.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(i=>{let o;t.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===i.id):o={track:i};const a=new Event("track");a.track=i,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else It(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Ki(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,u){let d=i.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(u=>u.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Qi(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),t.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>fi(a,o.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),It(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>fi(o,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,o,a;return this.getSenders().forEach(l=>{l.track===r&&(i?a=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===r&&(o?a=!0:o=l),l.track===r)),a||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Xi(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(a);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function eo(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Xi(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(h=>{if(this.getSenders().find(_=>_.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const h=new t.MediaStream(f.getTracks());this._streams[f.id]=h,this._reverseStreams[h.id]=f,f=h}r.apply(this,[f])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},t.RTCPeerConnection.prototype.addTrack=function(f,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const g=[].slice.call(arguments,1);if(g.length!==1||!g[0].getTracks().find(E=>E===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(E=>E.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const b=this._streams[h.id];if(b)b.addTrack(f),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const E=new t.MediaStream([f]);this._streams[h.id]=E,this._reverseStreams[E.id]=h,this.addStream(E)}return this.getSenders().find(E=>E.track===f)};function o(d,f){let h=f.sdp;return Object.keys(d._reverseStreams||[]).forEach(g=>{const _=d._reverseStreams[g],b=d._streams[_.id];h=h.replace(new RegExp(b.id,"g"),_.id)}),new RTCSessionDescription({type:f.type,sdp:h})}function a(d,f){let h=f.sdp;return Object.keys(d._reverseStreams||[]).forEach(g=>{const _=d._reverseStreams[g],b=d._streams[_.id];h=h.replace(new RegExp(_.id,"g"),b.id)}),new RTCSessionDescription({type:f.type,sdp:h})}["createOffer","createAnswer"].forEach(function(d){const f=t.RTCPeerConnection.prototype[d],h={[d](){const g=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[b=>{const E=o(this,b);g[0].apply(null,[E])},b=>{g[1]&&g[1].apply(null,b)},arguments[2]]):f.apply(this,arguments).then(b=>o(this,b))}};t.RTCPeerConnection.prototype[d]=h[d]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=u.get.apply(this);return d.type===""?d:o(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(f._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let g;Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(E=>f.track===E)&&(g=this._streams[_])}),g&&(g.getTracks().length===1?this.removeStream(this._reverseStreams[g.id]):g.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ur(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function to(t,e){It(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const di=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:to,shimAddTrackRemoveTrack:eo,shimAddTrackRemoveTrackWithNative:Xi,shimGetSendersWithDtmf:Ki,shimGetUserMedia:Zi,shimMediaStream:Wi,shimOnTrack:Yi,shimPeerConnection:ur,shimSenderReceiverGetStats:Qi},Symbol.toStringTag,{value:"Module"}));function no(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,o,a){Rr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(o,a)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(a,l,u){l in a&&!(u in a)&&(a[u]=a[l],delete a[l])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a.audio,"autoGainControl","mozAutoGainControl"),i(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const l=a.apply(this,arguments);return i(l,"mozAutoGainControl","autoGainControl"),i(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l,"autoGainControl","mozAutoGainControl"),i(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function Ya(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function ro(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dr(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=t.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=a[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return r.apply(this,[o||null]).then(u=>{if(e.version<53&&!a)try{u.forEach(d=>{d.type=n[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;u.forEach((f,h)=>{u.set(h,Object.assign({},f,{type:n[f.type]||f.type}))})}return u}).then(a,l)}}function io(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function oo(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),It(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function so(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Rr("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function ao(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function co(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(i){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function lo(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function fo(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function uo(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const pi=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:co,shimCreateAnswer:uo,shimCreateOffer:fo,shimGetDisplayMedia:Ya,shimGetParameters:lo,shimGetUserMedia:no,shimOnTrack:ro,shimPeerConnection:dr,shimRTCDataChannel:ao,shimReceiverGetStats:oo,shimRemoveStream:so,shimSenderGetStats:io},Symbol.toStringTag,{value:"Module"}));function po(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function ho(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,r.dispatchEvent(a)})}),e.apply(r,arguments)}}}function mo(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(d,f){const h=arguments.length>=2?arguments[2]:arguments[0],g=n.apply(this,[h]);return f?(g.then(d,f),Promise.resolve()):g},e.createAnswer=function(d,f){const h=arguments.length>=2?arguments[2]:arguments[0],g=r.apply(this,[h]);return f?(g.then(d,f),Promise.resolve()):g};let l=function(u,d,f){const h=i.apply(this,[u]);return f?(h.then(d,f),Promise.resolve()):h};e.setLocalDescription=l,l=function(u,d,f){const h=o.apply(this,[u]);return f?(h.then(d,f),Promise.resolve()):h},e.setRemoteDescription=l,l=function(u,d,f){const h=a.apply(this,[u]);return f?(h.then(d,f),Promise.resolve()):h},e.addIceCandidate=l}function go(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(_o(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,o){e.mediaDevices.getUserMedia(r).then(i,o)}).bind(e))}function _o(t){return t&&t.video!==void 0?Object.assign({},t,{video:Hi(t.video)}):t}function yo(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const o=[];for(let a=0;a<r.iceServers.length;a++){let l=r.iceServers[a];l.urls===void 0&&l.url?(Rr("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(r.iceServers[a])}r.iceServers=o}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function bo(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Co(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Eo(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const hi=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Eo,shimCallbacksAPI:mo,shimConstraints:_o,shimCreateOfferLegacy:Co,shimGetUserMedia:go,shimLocalStreamsAPI:po,shimRTCIceServerUrls:yo,shimRemoteStreamsAPI:ho,shimTrackEventTransceiver:bo},Symbol.toStringTag,{value:"Module"}));function Ka(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vo={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,o)=>(o>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":i.relatedAddress=r[o+1];break;case"rport":i.relatedPort=parseInt(r[o+1],10);break;case"tcptype":i.tcpType=r[o+1];break;case"ufrag":i.ufrag=r[o+1],i.usernameFragment=r[o+1];break;default:i[r[o]]===void 0&&(i[r[o]]=r[o+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const o=n.type;return r.push("typ"),r.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const o=n.substring(n.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)i=o[a].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(a=>{n.parameters[a]!==void 0?o.push(a+"="+n.parameters[a]):o.push(a)}),r+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},o=n.indexOf(":",r);return o>-1?(i.attribute=n.substring(r+1,o),i.value=n.substring(o+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(o=>{i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],o=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(n)[0].split(" ");r.profile=o[2];for(let l=3;l<o.length;l++){const u=o[l],d=e.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(d){const f=e.parseRtpMap(d),h=e.matchPrefix(n,"a=fmtp:"+u+" ");switch(f.parameters=h.length?e.parseFmtp(h[0]):{},f.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(e.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{a.forEach(u=>{l.rtcpFeedback.find(f=>f.type===u.type&&f.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{i+=e.writeRtpMap(a),i+=e.writeFmtp(a),i+=e.writeRtcpFb(a)});let o=0;return r.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{i+=e.writeExtmap(a)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),o=i.fecMechanisms.indexOf("RED")!==-1,a=i.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(g=>e.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),u=l.length>0&&l[0].ssrc;let d;const f=e.matchPrefix(n,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(b=>parseInt(b,10)));f.length>0&&f[0].length>1&&f[0][0]===u&&(d=f[0][1]),i.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let _={ssrc:u,codecPayloadType:parseInt(g.parameters.apt,10)};u&&d&&(_.rtx={ssrc:d}),r.push(_),o&&(_=JSON.parse(JSON.stringify(_)),_.fec={ssrc:u,mechanism:a?"red+ulpfec":"red"},r.push(_))}}),r.length===0&&u&&r.push({ssrc:u});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-50*40*8:h=void 0,r.forEach(g=>{g.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;const a=e.matchPrefix(n,"a=rtcp-mux");return r.mux=a.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(n,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let o;const a=r!==void 0?r:2;return n?o=n:o=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(vo);var ko=vo.exports;const Ut=Ka(ko),Qa=Bo({__proto__:null,default:Ut},[ko]);function bn(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),o=Ut.parseCandidate(r.candidate);for(const a in o)a in i||Object.defineProperty(i,a,{value:o[a]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,It(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function pr(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||It(t,"icecandidate",e=>{if(e.candidate){const n=Ut.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Cn(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=Ut.splitSections(l.sdp);return u.shift(),u.some(d=>{const f=Ut.parseMLine(d);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const d=parseInt(u[1],10);return d!==d?-1:d},i=function(l){let u=65536;return e.browser==="firefox"&&(e.version<57?l===-1?u=16384:u=2147483637:e.version<60?u=e.version===57?65535:65536:u=2147483637),u},o=function(l,u){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const f=Ut.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?d=parseInt(f[0].substring(19),10):e.browser==="firefox"&&u!==-1&&(d=2147483637),d},a=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=r(arguments[0]),d=i(u),f=o(arguments[0],u);let h;d===0&&f===0?h=Number.POSITIVE_INFINITY:d===0||f===0?h=Math.max(d,f):h=Math.min(d,f);const g={};Object.defineProperty(g,"maxMessageSize",{get(){return h}}),this._sctp=g}return a.apply(this,arguments)}}function En(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const o=r.send;r.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(r.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},It(t,"datachannel",r=>(e(r.channel,r.target),r))}function hr(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",i);o.dispatchEvent(a)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function mr(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return n.apply(this,arguments)}}function vn(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function kn(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}const Xa=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:mr,shimAddIceCandidateNullOrEmpty:vn,shimConnectionState:hr,shimMaxMessageSize:Cn,shimParameterlessSetLocalDescription:kn,shimRTCIceCandidate:bn,shimRTCIceCandidateRelayProtocol:pr,shimSendThrowTypeError:En},Symbol.toStringTag,{value:"Module"}));function ec({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=qi,r=Wa(t),i={browserDetails:r,commonShim:Xa,extractVersion:yn,disableLog:Ha,disableWarnings:Za,sdp:Qa};switch(r.browser){case"chrome":if(!di||!ur||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=di,vn(t,r),kn(t),Zi(t,r),Wi(t),ur(t,r),Yi(t),eo(t,r),Ki(t),Qi(t),to(t,r),bn(t),pr(t),hr(t),Cn(t,r),En(t),mr(t,r);break;case"firefox":if(!pi||!dr||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=pi,vn(t,r),kn(t),no(t,r),dr(t,r),ro(t),so(t),io(t),oo(t),ao(t),co(t),lo(t),fo(t),uo(t),bn(t),hr(t),Cn(t,r),En(t);break;case"safari":if(!hi||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=hi,vn(t,r),kn(t),yo(t),Co(t),mo(t),po(t),ho(t),bo(t),go(t),Eo(t),bn(t),pr(t),Cn(t,r),En(t),mr(t,r);break;default:n("Unsupported browser!");break}return i}const mi=ec({window:typeof window>"u"?void 0:window});function Rt(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class To{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let o=0,a=0;for(;a<r;){const l=Math.min(r,a+this.chunkedMTU),u=e.slice(a,l),d={__peerData:this._dataCount,n:o,data:u,total:i};n.push(d),a=l,o++}return this._dataCount++,n}}}function tc(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.byteLength;return n}const Yn=mi.default||mi,Ht=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Yn.browserDetails.browser}getVersion(){return Yn.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Yn.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},nc=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),So=()=>Math.random().toString(36).slice(2),gi={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class rc extends To{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(i){i.target&&n(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=gi,this.browser=Ht.getBrowser(),this.browserVersion=Ht.getVersion(),this.pack=Vi,this.unpack=zi,this.supports=function(){const n={browser:Ht.isBrowserSupported(),webRTC:Ht.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(gi),n.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!i.ordered;try{i.binaryType="blob",n.binaryBlob=!Ht.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=nc,this.randomToken=So}}const Pe=new rc,ic="PeerJS: ";var _i;(function(t){t[t.Disabled=0]="Disabled",t[t.Errors=1]="Errors",t[t.Warnings=2]="Warnings",t[t.All=3]="All"})(_i||(_i={}));class oc{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[ic,...n];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var B=new oc,Dr={},sc=Object.prototype.hasOwnProperty,we="~";function tn(){}Object.create&&(tn.prototype=Object.create(null),new tn().__proto__||(we=!1));function ac(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function xo(t,e,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var o=new ac(n,r||t,i),a=we?we+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],o]:t._events[a].push(o):(t._events[a]=o,t._eventsCount++),t}function Tn(t,e){--t._eventsCount===0?t._events=new tn:delete t._events[e]}function Re(){this._events=new tn,this._eventsCount=0}Re.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)sc.call(n,r)&&e.push(we?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};Re.prototype.listeners=function(e){var n=we?we+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a};Re.prototype.listenerCount=function(e){var n=we?we+e:e,r=this._events[n];return r?r.fn?1:r.length:0};Re.prototype.emit=function(e,n,r,i,o,a){var l=we?we+e:e;if(!this._events[l])return!1;var u=this._events[l],d=arguments.length,f,h;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,n),!0;case 3:return u.fn.call(u.context,n,r),!0;case 4:return u.fn.call(u.context,n,r,i),!0;case 5:return u.fn.call(u.context,n,r,i,o),!0;case 6:return u.fn.call(u.context,n,r,i,o,a),!0}for(h=1,f=new Array(d-1);h<d;h++)f[h-1]=arguments[h];u.fn.apply(u.context,f)}else{var g=u.length,_;for(h=0;h<g;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),d){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,n);break;case 3:u[h].fn.call(u[h].context,n,r);break;case 4:u[h].fn.call(u[h].context,n,r,i);break;default:if(!f)for(_=1,f=new Array(d-1);_<d;_++)f[_-1]=arguments[_];u[h].fn.apply(u[h].context,f)}}return!0};Re.prototype.on=function(e,n,r){return xo(this,e,n,r,!1)};Re.prototype.once=function(e,n,r){return xo(this,e,n,r,!0)};Re.prototype.removeListener=function(e,n,r,i){var o=we?we+e:e;if(!this._events[o])return this;if(!n)return Tn(this,o),this;var a=this._events[o];if(a.fn)a.fn===n&&(!i||a.once)&&(!r||a.context===r)&&Tn(this,o);else{for(var l=0,u=[],d=a.length;l<d;l++)(a[l].fn!==n||i&&!a[l].once||r&&a[l].context!==r)&&u.push(a[l]);u.length?this._events[o]=u.length===1?u[0]:u:Tn(this,o)}return this};Re.prototype.removeAllListeners=function(e){var n;return e?(n=we?we+e:e,this._events[n]&&Tn(this,n)):(this._events=new tn,this._eventsCount=0),this};Re.prototype.off=Re.prototype.removeListener;Re.prototype.addListener=Re.prototype.on;Re.prefixed=we;Re.EventEmitter=Re;Dr=Re;var Dt={};Rt(Dt,"ConnectionType",()=>Qe);Rt(Dt,"PeerErrorType",()=>ce);Rt(Dt,"BaseConnectionErrorType",()=>nn);Rt(Dt,"DataConnectionErrorType",()=>rn);Rt(Dt,"SerializationType",()=>Vt);Rt(Dt,"SocketEventType",()=>Ke);Rt(Dt,"ServerMessageType",()=>be);var Qe;(function(t){t.Data="data",t.Media="media"})(Qe||(Qe={}));var ce;(function(t){t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc"})(ce||(ce={}));var nn;(function(t){t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed"})(nn||(nn={}));var rn;(function(t){t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big"})(rn||(rn={}));var Vt;(function(t){t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw"})(Vt||(Vt={}));var Ke;(function(t){t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close"})(Ke||(Ke={}));var be;(function(t){t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE"})(be||(be={}));var wr={};wr=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class cc extends Dr.EventEmitter{constructor(e,n,r,i,o,a=5e3){super(),this.pingInterval=a,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+i+"peerjs?key="+o}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+wr.version),this._disconnected=!1,this._socket.onmessage=i=>{let o;try{o=JSON.parse(i.data),B.log("Server message received:",o)}catch{B.log("Invalid server message",i.data);return}this.emit(Ke.Message,o)},this._socket.onclose=i=>{this._disconnected||(B.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(Ke.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),B.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){B.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:be.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ke.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class Io{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Qe.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,i={ordered:!!e.reliable},o=n.createDataChannel(r.label,i);r._initializeDataChannel(o),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){B.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,o=this.connection.provider;B.log("Listening for ICE candidates."),e.onicecandidate=a=>{!a.candidate||!a.candidate.candidate||(B.log(`Received ICE candidates for ${n}:`,a.candidate),o.socket.send({type:be.Candidate,payload:{candidate:a.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":B.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(nn.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":B.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(nn.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":B.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},B.log("Listening for data channel"),e.ondatachannel=a=>{B.log("Received data channel");const l=a.channel;o.getConnection(n,r)._initializeDataChannel(l)},B.log("Listening for remote stream"),e.ontrack=a=>{B.log("Received remote stream");const l=a.streams[0],u=o.getConnection(n,r);if(u.type===Qe.Media){const d=u;this._addStreamToMediaConnection(l,d)}}}cleanup(){B.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);B.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),B.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Qe.Data){const o=this.connection;i={...i,label:o.label,reliable:o.reliable,serialization:o.serialization}}n.socket.send({type:be.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(ce.WebRTC,i),B.log("Failed to setLocalDescription, ",i))}}catch(r){n.emitError(ce.WebRTC,r),B.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();B.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),B.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:be.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){n.emitError(ce.WebRTC,i),B.log("Failed to setLocalDescription, ",i)}}catch(r){n.emitError(ce.WebRTC,r),B.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,i=this.connection.provider;B.log("Setting remote description",n);const o=this;try{await r.setRemoteDescription(n),B.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await o._makeAnswer()}catch(a){i.emitError(ce.WebRTC,a),B.log("Failed to setRemoteDescription, ",a)}}async handleCandidate(e){B.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),B.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(ce.WebRTC,n),B.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(B.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return B.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){B.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class Ro extends Dr.EventEmitter{emitError(e,n){B.error("Error:",n),this.emit("error",new lc(`${e}`,n))}}class lc extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class Do extends Ro{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var _r;const Wt=class Wt extends Do{get type(){return Qe.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Wt.ID_PREFIX+Pe.randomToken(),this._negotiator=new Io(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{B.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{B.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){B.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case be.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case be.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:B.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){B.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};_r=new WeakMap,Jt(Wt,_r,Wt.ID_PREFIX="mc_");let An=Wt;class fc{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:i,path:o,key:a}=this._options,l=new URL(`${n}://${r}:${i}${o}${a}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",wr.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){B.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==Pe.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===Pe.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw B.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var yr,br;const Et=class Et extends Do{get type(){return Qe.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||Et.ID_PREFIX+So(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new Io(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{B.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{B.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{B.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(rn.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case be.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case be.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:B.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};yr=new WeakMap,br=new WeakMap,Jt(Et,yr,Et.ID_PREFIX="dc_"),Jt(Et,br,Et.MAX_BUFFERED_AMOUNT=8388608);let Pn=Et;class Or extends Pn{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Pn.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return B.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Kn extends Or{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new To,this.serialization=Vt.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=zi(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const i=tc(r.data);this._handleDataMessage({data:i})}}_send(e,n){const r=Vi(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);B.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class uc extends Or{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Vt.None}}class dc extends Or{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=Pe.chunkedMTU){this.emitError(rn.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Vt.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Cr;const Yt=class Yt extends Ro{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:uc,json:dc,binary:Kn,"binary-utf8":Kn,default:Kn},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:Pe.CLOUD_HOST,port:Pe.CLOUD_PORT,path:"/",key:Yt.DEFAULT_KEY,token:Pe.randomToken(),config:Pe.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==Pe.CLOUD_HOST?this._options.secure=Pe.isSecure():this._options.host==Pe.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&B.setLogFunction(this._options.logFunction),B.logLevel=this._options.debug||0,this._api=new fc(n),this._socket=this._createServerConnection(),!Pe.supports.audioVideo&&!Pe.supports.data){this._delayedAbort(ce.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!Pe.validateId(r)){this._delayedAbort(ce.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(ce.ServerError,i))}_createServerConnection(){const e=new cc(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ke.Message,n=>{this._handleMessage(n)}),e.on(Ke.Error,n=>{this._abort(ce.SocketError,n)}),e.on(Ke.Disconnected,()=>{this.disconnected||(this.emitError(ce.Network,"Lost connection to server."),this.disconnect())}),e.on(Ke.Close,()=>{this.disconnected||this._abort(ce.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,i=e.src;switch(n){case be.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case be.Error:this._abort(ce.ServerError,r.msg);break;case be.IdTaken:this._abort(ce.UnavailableID,`ID "${this.id}" is taken`);break;case be.InvalidKey:this._abort(ce.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case be.Leave:B.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case be.Expire:this.emitError(ce.PeerUnavailable,`Could not connect to peer ${i}`);break;case be.Offer:{const o=r.connectionId;let a=this.getConnection(i,o);if(a&&(a.close(),B.warn(`Offer received for existing Connection ID:${o}`)),r.type===Qe.Media){const u=new An(i,this,{connectionId:o,_payload:r,metadata:r.metadata});a=u,this._addConnection(i,a),this.emit("call",u)}else if(r.type===Qe.Data){const u=new this._serializers[r.serialization](i,this,{connectionId:o,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});a=u,this._addConnection(i,a),this.emit("connection",u)}else{B.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(o);for(const u of l)a.handleMessage(u);break}default:{if(!r){B.warn(`You received a malformed message from ${i} of type ${n}`);return}const o=r.connectionId,a=this.getConnection(i,o);a&&a.peerConnection?a.handleMessage(e):o?this._storeMessage(o,e):B.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){B.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ce.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){B.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ce.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){B.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new An(e,this,{...r,_stream:n});return this._addConnection(e,i),i}_addConnection(e,n){B.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===n)return i;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){B.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(B.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;B.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)B.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)B.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(ce.ServerError,n))}};Cr=new WeakMap,Jt(Yt,Cr,Yt.DEFAULT_KEY="peerjs");let gr=Yt;function pc(){return{type:"turn_order",flip:Math.random()}}function hc(t){return{type:"state_change",state:t}}function yi(t,e,n){const r=t.slice();return r[5]=e[n],r}function bi(t,e){let n,r,i;return r=new cn({props:{card:e[5],updateCard:e[4]}}),{key:t,first:null,c(){n=ct(),ie(r.$$.fragment),this.first=n},m(o,a){z(o,n,a),te(r,o,a),i=!0},p(o,a){e=o;const l={};a&1&&(l.card=e[5]),r.$set(l)},i(o){i||(W(r.$$.fragment,o),i=!0)},o(o){Y(r.$$.fragment,o),i=!1},d(o){o&&j(n),ne(r,o)}}}function mc(t){let e,n,r,i,o=[],a=new Map,l,u,d,f,h=lt(t[0]);const g=_=>_[5].id;for(let _=0;_<h.length;_+=1){let b=yi(t,h,_),E=g(b);a.set(E,o[_]=bi(E,b))}return{c(){e=P("div"),n=xe(t[1]),r=Z(),i=P("div");for(let _=0;_<o.length;_+=1)o[_].c();F(i,"class","flex h-full min-w-[8.5rem] max-w-[8.5rem] flex-col gap-x-1"),F(e,"class","flex h-full flex-col")},m(_,b){z(_,e,b),I(e,n),I(e,r),I(e,i);for(let E=0;E<o.length;E+=1)o[E]&&o[E].m(i,null);u=!0,d||(f=[Bn(l=Gn.call(null,i,{items:t[0],type:t[2],transformDraggedElement:ut,dropAnimationDisabled:!0})),de(i,"consider",t[3]),de(i,"finalize",t[3])],d=!0)},p(_,[b]){(!u||b&2)&&Le(n,_[1]),b&17&&(h=lt(_[0]),Tt(),o=Nn(o,b,g,1,_,h,a,i,Ln,bi,null,yi),St()),l&&xt(l.update)&&b&5&&l.update.call(null,{items:_[0],type:_[2],transformDraggedElement:ut,dropAnimationDisabled:!0})},i(_){if(!u){for(let b=0;b<h.length;b+=1)W(o[b]);u=!0}},o(_){for(let b=0;b<o.length;b+=1)Y(o[b]);u=!1},d(_){_&&j(e);for(let b=0;b<o.length;b+=1)o[b].d();d=!1,Me(f)}}}function gc(t,e,n){let{area:r}=e,{name:i}=e,{dragType:o}=e;function a(u){n(0,r=u.detail.items)}function l(){console.log("here"),n(0,r)}return t.$$set=u=>{"area"in u&&n(0,r=u.area),"name"in u&&n(1,i=u.name),"dragType"in u&&n(2,o=u.dragType)},[r,i,o,a,l]}class _c extends ht{constructor(e){super(),pt(this,e,gc,mc,dt,{area:0,name:1,dragType:2})}}function yc(t){let e,n,r,i,o,a,l,u,d,f,h,g,_,b,E,T,S;function x(U,k){return U[5]?vc:Ec}let w=x(t),R=w(t);function V(U){t[11](U)}let $={name:"Dream",dragType:"player"};t[0].dream!==void 0&&($.area=t[0].dream),i=new _c({props:$}),le.push(()=>_e(i,"area",V));function L(U){t[12](U)}let N={};t[0].opponent!==void 0&&(N.playArea=t[0].opponent),d=new za({props:N}),le.push(()=>_e(d,"playArea",L));function A(U){t[13](U)}function D(U){t[14](U)}let O={};return t[0].player!==void 0&&(O.playArea=t[0].player),t[1]!==void 0&&(O.hand=t[1]),_=new Fa({props:O}),le.push(()=>_e(_,"playArea",A)),le.push(()=>_e(_,"hand",D)),{c(){R.c(),e=Z(),n=P("div"),r=P("div"),ie(i.$$.fragment),a=Z(),l=P("div"),u=P("div"),ie(d.$$.fragment),h=Z(),g=P("div"),ie(_.$$.fragment),F(r,"class","rounded border border-black"),F(u,"class","shrink-0 border-b border-black pb-1"),F(g,"class","shrink-0"),F(l,"class","flex flex-col gap-1"),F(n,"class",T="flex h-screen max-h-screen min-w-[65rem] flex-row gap-2 p-1 pl-24 pt-24 "+(t[5]?"":"pointer-events-none"))},m(U,k){R.m(U,k),z(U,e,k),z(U,n,k),I(n,r),te(i,r,null),I(n,a),I(n,l),I(l,u),te(d,u,null),I(l,h),I(l,g),te(_,g,null),S=!0},p(U,k){w===(w=x(U))&&R?R.p(U,k):(R.d(1),R=w(U),R&&(R.c(),R.m(e.parentNode,e)));const q={};!o&&k&1&&(o=!0,q.area=U[0].dream,ge(()=>o=!1)),i.$set(q);const pe={};!f&&k&1&&(f=!0,pe.playArea=U[0].opponent,ge(()=>f=!1)),d.$set(pe);const $e={};!b&&k&1&&(b=!0,$e.playArea=U[0].player,ge(()=>b=!1)),!E&&k&2&&(E=!0,$e.hand=U[1],ge(()=>E=!1)),_.$set($e),(!S||k&32&&T!==(T="flex h-screen max-h-screen min-w-[65rem] flex-row gap-2 p-1 pl-24 pt-24 "+(U[5]?"":"pointer-events-none")))&&F(n,"class",T)},i(U){S||(W(i.$$.fragment,U),W(d.$$.fragment,U),W(_.$$.fragment,U),S=!0)},o(U){Y(i.$$.fragment,U),Y(d.$$.fragment,U),Y(_.$$.fragment,U),S=!1},d(U){U&&(j(e),j(n)),R.d(U),ne(i),ne(d),ne(_)}}}function bc(t){let e,n,r,i,o,a,l,u,d,f;return{c(){e=P("div"),e.textContent="Send your ID to the other player:",n=Z(),r=P("div"),i=xe(t[3]),o=Z(),a=P("input"),l=Z(),u=P("button"),u.textContent="Connect!",F(r,"class","w-fit rounded border border-black")},m(h,g){z(h,e,g),z(h,n,g),z(h,r,g),I(r,i),z(h,o,g),z(h,a,g),Br(a,t[4]),z(h,l,g),z(h,u,g),d||(f=[de(a,"input",t[9]),de(u,"click",t[10])],d=!0)},p(h,g){g&8&&Le(i,h[3]),g&16&&a.value!==h[4]&&Br(a,h[4])},i:Ee,o:Ee,d(h){h&&(j(e),j(n),j(r),j(o),j(a),j(l),j(u)),d=!1,Me(f)}}}function Cc(t){let e;return{c(){e=P("div"),e.textContent="Waiting to initiate..."},m(n,r){z(n,e,r)},p:Ee,i:Ee,o:Ee,d(n){n&&j(e)}}}function Ec(t){let e;return{c(){e=P("button"),e.textContent="Waiting for other player",F(e,"class","absolute right-2 top-2"),e.disabled=!0},m(n,r){z(n,e,r)},p:Ee,d(n){n&&j(e)}}}function vc(t){let e,n,r;return{c(){e=P("button"),e.textContent="End Turn",F(e,"class","absolute right-2 top-2")},m(i,o){z(i,e,o),n||(r=de(e,"click",t[8]),n=!0)},p:Ee,d(i){i&&j(e),n=!1,r()}}}function kc(t){let e,n,r,i;const o=[Cc,bc,yc],a=[];function l(u,d){return u[3]===void 0?0:u[2]?2:1}return e=l(t),n=a[e]=o[e](t),{c(){n.c(),r=ct()},m(u,d){a[e].m(u,d),z(u,r,d),i=!0},p(u,[d]){let f=e;e=l(u),e===f?a[e].p(u,d):(Tt(),Y(a[f],1,1,()=>{a[f]=null}),St(),n=a[e],n?n.p(u,d):(n=a[e]=o[e](u),n.c()),W(n,1),n.m(r.parentNode,r))},i(u){i||(W(n),i=!0)},o(u){Y(n),i=!1},d(u){u&&j(r),a[e].d(u)}}}function Tc(t,e,n){let r={player:{reality:[],channeled:[],combatArea:[],deck:[],memDiscard:[],randomZone:[],voidPile:[]},opponent:{reality:[],channeled:[],combatArea:[],deck:[],memDiscard:[],randomZone:[],voidPile:[]},dream:[]},i=[],o=!1;$o(async function(){let $=await _s();console.log($),n(0,r.player.deck=$.slice(0,12),r),r.player.deck.forEach(L=>L.state="Facedown"),o=!0});function a($){!o||!l||_===void 0||!h||_.send(hc($))}let l=!1,u,d,f=pc(),h=!1,g=new gr,_;g.on("open",function($){n(3,u=$)});function b($){console.log("connected"),_=$,$.on("data",function(L){switch(console.log("Received",L),L.type){case"turn_order":{n(5,h=f.flip>L.flip);break}case"state_change":{n(0,r.player=L.state.opponent,r),n(0,r.opponent=L.state.player,r);break}case"end_turn":n(5,h=!0)}}),$.on("open",function(){$.send(f)}),n(2,l=!0)}g.on("connection",b);function E(){n(5,h=!1),_.send({type:"end_turn"})}function T(){d=this.value,n(4,d)}const S=()=>b(g.connect(d));function x($){t.$$.not_equal(r.dream,$)&&(r.dream=$,n(0,r))}function w($){t.$$.not_equal(r.opponent,$)&&(r.opponent=$,n(0,r))}function R($){t.$$.not_equal(r.player,$)&&(r.player=$,n(0,r))}function V($){i=$,n(1,i)}return t.$$.update=()=>{t.$$.dirty&1&&a(r)},[r,i,l,u,d,h,g,b,E,T,S,x,w,R,V]}class Sc extends ht{constructor(e){super(),pt(this,e,Tc,kc,dt,{})}}new Sc({target:document.getElementById("app")});
