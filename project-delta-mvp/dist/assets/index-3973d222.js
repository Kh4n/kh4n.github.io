var Ts=Object.defineProperty;var ks=(t,e,n)=>e in t?Ts(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var dn=(t,e,n)=>(ks(t,typeof e!="symbol"?e+"":e,n),n);var Jt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)};function xs(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function Pe(){}function pi(t){return t()}function Ar(){return Object.create(null)}function Je(t){t.forEach(pi)}function Vt(t){return typeof t=="function"}function yt(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Is(t){return Object.keys(t).length===0}function _r(t){return t&&Vt(t.destroy)?t.destroy:Pe}function O(t,e){t.appendChild(e)}function V(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode&&t.parentNode.removeChild(t)}function N(t){return document.createElement(t)}function Ae(t){return document.createTextNode(t)}function K(){return Ae(" ")}function Bt(){return Ae("")}function Ge(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function U(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Rs(t){return Array.from(t.childNodes)}function ze(t,e){e=""+e,t.data!==e&&(t.data=e)}function Pr(t,e){t.value=e??""}function Wn(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}let Kt;function Zt(t){Kt=t}function Ds(){if(!Kt)throw new Error("Function called outside component initialization");return Kt}function ws(t){Ds().$$.on_mount.push(t)}const wt=[],ue=[];let Ot=[];const Yn=[],Os=Promise.resolve();let Kn=!1;function As(){Kn||(Kn=!0,Os.then(hi))}function Qn(t){Ot.push(t)}function me(t){Yn.push(t)}const Vn=new Set;let It=0;function hi(){if(It!==0)return;const t=Kt;do{try{for(;It<wt.length;){const e=wt[It];It++,Zt(e),Ps(e.$$)}}catch(e){throw wt.length=0,It=0,e}for(Zt(null),wt.length=0,It=0;ue.length;)ue.pop()();for(let e=0;e<Ot.length;e+=1){const n=Ot[e];Vn.has(n)||(Vn.add(n),n())}Ot.length=0}while(wt.length);for(;Yn.length;)Yn.pop()();Kn=!1,Vn.clear(),Zt(t)}function Ps(t){if(t.fragment!==null){t.update(),Je(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Qn)}}function $s(t){const e=[],n=[];Ot.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ot=e}const hn=new Set;let gt;function Nt(){gt={r:0,c:[],p:gt}}function Lt(){gt.r||Je(gt.c),gt=gt.p}function q(t,e){t&&t.i&&(hn.delete(t),t.i(e))}function H(t,e,n,r){if(t&&t.o){if(hn.has(t))return;hn.add(t),gt.c.push(()=>{hn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function Mt(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function yr(t,e){H(t,1,1,()=>{e.delete(t.key)})}function br(t,e,n,r,i,s,c,l,u,p,f,g){let m=t.length,y=s.length,C=m;const v={};for(;C--;)v[t[C].key]=C;const k=[],x=new Map,S=new Map,R=[];for(C=y;C--;){const L=g(i,s,C),B=n(L);let T=c.get(B);T?r&&R.push(()=>T.p(L,e)):(T=p(B,L),T.c()),x.set(B,k[C]=T),B in v&&S.set(B,Math.abs(C-v[B]))}const A=new Set,j=new Set;function Z(L){q(L,1),L.m(l,f),c.set(L.key,L),f=L.first,y--}for(;m&&y;){const L=k[y-1],B=t[m-1],T=L.key,I=B.key;L===B?(f=L.first,m--,y--):x.has(I)?!c.has(T)||A.has(T)?Z(L):j.has(I)?m--:S.get(T)>S.get(I)?(j.add(T),Z(L)):(A.add(I),m--):(u(B,c),m--)}for(;m--;){const L=t[m];x.has(L.key)||u(L,c)}for(;y;)Z(k[y-1]);return Je(R),k}function ge(t,e,n){const r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function ae(t){t&&t.c()}function te(t,e,n){const{fragment:r,after_update:i}=t.$$;r&&r.m(e,n),Qn(()=>{const s=t.$$.on_mount.map(pi).filter(Vt);t.$$.on_destroy?t.$$.on_destroy.push(...s):Je(s),t.$$.on_mount=[]}),i.forEach(Qn)}function ne(t,e){const n=t.$$;n.fragment!==null&&($s(n.after_update),Je(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Bs(t,e){t.$$.dirty[0]===-1&&(wt.push(t),As(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function bt(t,e,n,r,i,s,c,l=[-1]){const u=Kt;Zt(t);const p=t.$$={fragment:null,ctx:[],props:s,update:Pe,not_equal:i,bound:Ar(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:Ar(),dirty:l,skip_bound:!1,root:e.target||u.$$.root};c&&c(p.root);let f=!1;if(p.ctx=n?n(t,e.props||{},(g,m,...y)=>{const C=y.length?y[0]:m;return p.ctx&&i(p.ctx[g],p.ctx[g]=C)&&(!p.skip_bound&&p.bound[g]&&p.bound[g](C),f&&Bs(t,g)),m}):[],p.update(),f=!0,Je(p.before_update),p.fragment=r?r(p.ctx):!1,e.target){if(e.hydrate){const g=Rs(e.target);p.fragment&&p.fragment.l(g),g.forEach(z)}else p.fragment&&p.fragment.c();e.intro&&q(t.$$.fragment),te(t,e.target,e.anchor),hi()}Zt(u)}class Ct{constructor(){dn(this,"$$");dn(this,"$$set")}$destroy(){ne(this,1),this.$destroy=Pe}$on(e,n){if(!Vt(n))return Pe;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!Is(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ns="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ns);var mi={},$n={};$n.byteLength=Fs;$n.toByteArray=js;$n.fromByteArray=Gs;var He=[],Me=[],Ls=typeof Uint8Array<"u"?Uint8Array:Array,Gn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Rt=0,Ms=Gn.length;Rt<Ms;++Rt)He[Rt]=Gn[Rt],Me[Gn.charCodeAt(Rt)]=Rt;Me["-".charCodeAt(0)]=62;Me["_".charCodeAt(0)]=63;function gi(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function Fs(t){var e=gi(t),n=e[0],r=e[1];return(n+r)*3/4-r}function Us(t,e,n){return(e+n)*3/4-n}function js(t){var e,n=gi(t),r=n[0],i=n[1],s=new Ls(Us(t,r,i)),c=0,l=i>0?r-4:r,u;for(u=0;u<l;u+=4)e=Me[t.charCodeAt(u)]<<18|Me[t.charCodeAt(u+1)]<<12|Me[t.charCodeAt(u+2)]<<6|Me[t.charCodeAt(u+3)],s[c++]=e>>16&255,s[c++]=e>>8&255,s[c++]=e&255;return i===2&&(e=Me[t.charCodeAt(u)]<<2|Me[t.charCodeAt(u+1)]>>4,s[c++]=e&255),i===1&&(e=Me[t.charCodeAt(u)]<<10|Me[t.charCodeAt(u+1)]<<4|Me[t.charCodeAt(u+2)]>>2,s[c++]=e>>8&255,s[c++]=e&255),s}function zs(t){return He[t>>18&63]+He[t>>12&63]+He[t>>6&63]+He[t&63]}function Vs(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(t[s+2]&255),i.push(zs(r));return i.join("")}function Gs(t){for(var e,n=t.length,r=n%3,i=[],s=16383,c=0,l=n-r;c<l;c+=s)i.push(Vs(t,c,c+s>l?l:c+s));return r===1?(e=t[n-1],i.push(He[e>>2]+He[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],i.push(He[e>>10]+He[e>>4&63]+He[e<<2&63]+"=")),i.join("")}var Cr={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Cr.read=function(t,e,n,r,i){var s,c,l=i*8-r-1,u=(1<<l)-1,p=u>>1,f=-7,g=n?i-1:0,m=n?-1:1,y=t[e+g];for(g+=m,s=y&(1<<-f)-1,y>>=-f,f+=l;f>0;s=s*256+t[e+g],g+=m,f-=8);for(c=s&(1<<-f)-1,s>>=-f,f+=r;f>0;c=c*256+t[e+g],g+=m,f-=8);if(s===0)s=1-p;else{if(s===u)return c?NaN:(y?-1:1)*(1/0);c=c+Math.pow(2,r),s=s-p}return(y?-1:1)*c*Math.pow(2,s-r)};Cr.write=function(t,e,n,r,i,s){var c,l,u,p=s*8-i-1,f=(1<<p)-1,g=f>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=r?0:s-1,C=r?1:-1,v=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,c=f):(c=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-c))<1&&(c--,u*=2),c+g>=1?e+=m/u:e+=m*Math.pow(2,1-g),e*u>=2&&(c++,u/=2),c+g>=f?(l=0,c=f):c+g>=1?(l=(e*u-1)*Math.pow(2,i),c=c+g):(l=e*Math.pow(2,g-1)*Math.pow(2,i),c=0));i>=8;t[n+y]=l&255,y+=C,l/=256,i-=8);for(c=c<<i|l,p+=i;p>0;t[n+y]=c&255,y+=C,c/=256,p-=8);t[n+y-C]|=v*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=$n,n=Cr,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=f,t.SlowBuffer=j,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i;const{Uint8Array:s,ArrayBuffer:c,SharedArrayBuffer:l}=globalThis;f.TYPED_ARRAY_SUPPORT=u(),!f.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{const d=new s(1),o={foo:function(){return 42}};return Object.setPrototypeOf(o,s.prototype),Object.setPrototypeOf(d,o),d.foo()===42}catch{return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.buffer}}),Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(f.isBuffer(this))return this.byteOffset}});function p(d){if(d>i)throw new RangeError('The value "'+d+'" is invalid for option "size"');const o=new s(d);return Object.setPrototypeOf(o,f.prototype),o}function f(d,o,a){if(typeof d=="number"){if(typeof o=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(d)}return g(d,o,a)}f.poolSize=8192;function g(d,o,a){if(typeof d=="string")return v(d,o);if(c.isView(d))return x(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(Be(d,c)||d&&Be(d.buffer,c)||typeof l<"u"&&(Be(d,l)||d&&Be(d.buffer,l)))return S(d,o,a);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const h=d.valueOf&&d.valueOf();if(h!=null&&h!==d)return f.from(h,o,a);const _=R(d);if(_)return _;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return f.from(d[Symbol.toPrimitive]("string"),o,a);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}f.from=function(d,o,a){return g(d,o,a)},Object.setPrototypeOf(f.prototype,s.prototype),Object.setPrototypeOf(f,s);function m(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function y(d,o,a){return m(d),d<=0?p(d):o!==void 0?typeof a=="string"?p(d).fill(o,a):p(d).fill(o):p(d)}f.alloc=function(d,o,a){return y(d,o,a)};function C(d){return m(d),p(d<0?0:A(d)|0)}f.allocUnsafe=function(d){return C(d)},f.allocUnsafeSlow=function(d){return C(d)};function v(d,o){if((typeof o!="string"||o==="")&&(o="utf8"),!f.isEncoding(o))throw new TypeError("Unknown encoding: "+o);const a=Z(d,o)|0;let h=p(a);const _=h.write(d,o);return _!==a&&(h=h.slice(0,_)),h}function k(d){const o=d.length<0?0:A(d.length)|0,a=p(o);for(let h=0;h<o;h+=1)a[h]=d[h]&255;return a}function x(d){if(Be(d,s)){const o=new s(d);return S(o.buffer,o.byteOffset,o.byteLength)}return k(d)}function S(d,o,a){if(o<0||d.byteLength<o)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<o+(a||0))throw new RangeError('"length" is outside of buffer bounds');let h;return o===void 0&&a===void 0?h=new s(d):a===void 0?h=new s(d,o):h=new s(d,o,a),Object.setPrototypeOf(h,f.prototype),h}function R(d){if(f.isBuffer(d)){const o=A(d.length)|0,a=p(o);return a.length===0||d.copy(a,0,0,o),a}if(d.length!==void 0)return typeof d.length!="number"||zn(d.length)?p(0):k(d);if(d.type==="Buffer"&&Array.isArray(d.data))return k(d.data)}function A(d){if(d>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return d|0}function j(d){return+d!=d&&(d=0),f.alloc(+d)}f.isBuffer=function(o){return o!=null&&o._isBuffer===!0&&o!==f.prototype},f.compare=function(o,a){if(Be(o,s)&&(o=f.from(o,o.offset,o.byteLength)),Be(a,s)&&(a=f.from(a,a.offset,a.byteLength)),!f.isBuffer(o)||!f.isBuffer(a))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(o===a)return 0;let h=o.length,_=a.length;for(let b=0,E=Math.min(h,_);b<E;++b)if(o[b]!==a[b]){h=o[b],_=a[b];break}return h<_?-1:_<h?1:0},f.isEncoding=function(o){switch(String(o).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(o,a){if(!Array.isArray(o))throw new TypeError('"list" argument must be an Array of Buffers');if(o.length===0)return f.alloc(0);let h;if(a===void 0)for(a=0,h=0;h<o.length;++h)a+=o[h].length;const _=f.allocUnsafe(a);let b=0;for(h=0;h<o.length;++h){let E=o[h];if(Be(E,s))b+E.length>_.length?(f.isBuffer(E)||(E=f.from(E)),E.copy(_,b)):s.prototype.set.call(_,E,b);else if(f.isBuffer(E))E.copy(_,b);else throw new TypeError('"list" argument must be an Array of Buffers');b+=E.length}return _};function Z(d,o){if(f.isBuffer(d))return d.length;if(c.isView(d)||Be(d,c))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const a=d.length,h=arguments.length>2&&arguments[2]===!0;if(!h&&a===0)return 0;let _=!1;for(;;)switch(o){case"ascii":case"latin1":case"binary":return a;case"utf8":case"utf-8":return xt(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a*2;case"hex":return a>>>1;case"base64":return Gt(d).length;default:if(_)return h?-1:xt(d).length;o=(""+o).toLowerCase(),_=!0}}f.byteLength=Z;function L(d,o,a){let h=!1;if((o===void 0||o<0)&&(o=0),o>this.length||((a===void 0||a>this.length)&&(a=this.length),a<=0)||(a>>>=0,o>>>=0,a<=o))return"";for(d||(d="utf8");;)switch(d){case"hex":return Xe(this,o,a);case"utf8":case"utf-8":return W(this,o,a);case"ascii":return Re(this,o,a);case"latin1":case"binary":return Ue(this,o,a);case"base64":return Qe(this,o,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Tt(this,o,a);default:if(h)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),h=!0}}f.prototype._isBuffer=!0;function B(d,o,a){const h=d[o];d[o]=d[a],d[a]=h}f.prototype.swap16=function(){const o=this.length;if(o%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let a=0;a<o;a+=2)B(this,a,a+1);return this},f.prototype.swap32=function(){const o=this.length;if(o%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let a=0;a<o;a+=4)B(this,a,a+3),B(this,a+1,a+2);return this},f.prototype.swap64=function(){const o=this.length;if(o%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let a=0;a<o;a+=8)B(this,a,a+7),B(this,a+1,a+6),B(this,a+2,a+5),B(this,a+3,a+4);return this},f.prototype.toString=function(){const o=this.length;return o===0?"":arguments.length===0?W(this,0,o):L.apply(this,arguments)},f.prototype.toLocaleString=f.prototype.toString,f.prototype.equals=function(o){if(!f.isBuffer(o))throw new TypeError("Argument must be a Buffer");return this===o?!0:f.compare(this,o)===0},f.prototype.inspect=function(){let o="";const a=t.INSPECT_MAX_BYTES;return o=this.toString("hex",0,a).replace(/(.{2})/g,"$1 ").trim(),this.length>a&&(o+=" ... "),"<Buffer "+o+">"},r&&(f.prototype[r]=f.prototype.inspect),f.prototype.compare=function(o,a,h,_,b){if(Be(o,s)&&(o=f.from(o,o.offset,o.byteLength)),!f.isBuffer(o))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof o);if(a===void 0&&(a=0),h===void 0&&(h=o?o.length:0),_===void 0&&(_=0),b===void 0&&(b=this.length),a<0||h>o.length||_<0||b>this.length)throw new RangeError("out of range index");if(_>=b&&a>=h)return 0;if(_>=b)return-1;if(a>=h)return 1;if(a>>>=0,h>>>=0,_>>>=0,b>>>=0,this===o)return 0;let E=b-_,G=h-a;const ie=Math.min(E,G),X=this.slice(_,b),se=o.slice(a,h);for(let Q=0;Q<ie;++Q)if(X[Q]!==se[Q]){E=X[Q],G=se[Q];break}return E<G?-1:G<E?1:0};function T(d,o,a,h,_){if(d.length===0)return-1;if(typeof a=="string"?(h=a,a=0):a>2147483647?a=2147483647:a<-2147483648&&(a=-2147483648),a=+a,zn(a)&&(a=_?0:d.length-1),a<0&&(a=d.length+a),a>=d.length){if(_)return-1;a=d.length-1}else if(a<0)if(_)a=0;else return-1;if(typeof o=="string"&&(o=f.from(o,h)),f.isBuffer(o))return o.length===0?-1:I(d,o,a,h,_);if(typeof o=="number")return o=o&255,typeof s.prototype.indexOf=="function"?_?s.prototype.indexOf.call(d,o,a):s.prototype.lastIndexOf.call(d,o,a):I(d,[o],a,h,_);throw new TypeError("val must be string, number or Buffer")}function I(d,o,a,h,_){let b=1,E=d.length,G=o.length;if(h!==void 0&&(h=String(h).toLowerCase(),h==="ucs2"||h==="ucs-2"||h==="utf16le"||h==="utf-16le")){if(d.length<2||o.length<2)return-1;b=2,E/=2,G/=2,a/=2}function ie(se,Q){return b===1?se[Q]:se.readUInt16BE(Q*b)}let X;if(_){let se=-1;for(X=a;X<E;X++)if(ie(d,X)===ie(o,se===-1?0:X-se)){if(se===-1&&(se=X),X-se+1===G)return se*b}else se!==-1&&(X-=X-se),se=-1}else for(a+G>E&&(a=E-G),X=a;X>=0;X--){let se=!0;for(let Q=0;Q<G;Q++)if(ie(d,X+Q)!==ie(o,Q)){se=!1;break}if(se)return X}return-1}f.prototype.includes=function(o,a,h){return this.indexOf(o,a,h)!==-1},f.prototype.indexOf=function(o,a,h){return T(this,o,a,h,!0)},f.prototype.lastIndexOf=function(o,a,h){return T(this,o,a,h,!1)};function D(d,o,a,h){a=Number(a)||0;const _=d.length-a;h?(h=Number(h),h>_&&(h=_)):h=_;const b=o.length;h>b/2&&(h=b/2);let E;for(E=0;E<h;++E){const G=parseInt(o.substr(E*2,2),16);if(zn(G))return E;d[a+E]=G}return E}function le(d,o,a,h){return dt(xt(o,d.length-a),d,a,h)}function P(d,o,a,h){return dt(fn(o),d,a,h)}function J(d,o,a,h){return dt(Gt(o),d,a,h)}function Se(d,o,a,h){return dt(un(o,d.length-a),d,a,h)}f.prototype.write=function(o,a,h,_){if(a===void 0)_="utf8",h=this.length,a=0;else if(h===void 0&&typeof a=="string")_=a,h=this.length,a=0;else if(isFinite(a))a=a>>>0,isFinite(h)?(h=h>>>0,_===void 0&&(_="utf8")):(_=h,h=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const b=this.length-a;if((h===void 0||h>b)&&(h=b),o.length>0&&(h<0||a<0)||a>this.length)throw new RangeError("Attempt to write outside buffer bounds");_||(_="utf8");let E=!1;for(;;)switch(_){case"hex":return D(this,o,a,h);case"utf8":case"utf-8":return le(this,o,a,h);case"ascii":case"latin1":case"binary":return P(this,o,a,h);case"base64":return J(this,o,a,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Se(this,o,a,h);default:if(E)throw new TypeError("Unknown encoding: "+_);_=(""+_).toLowerCase(),E=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Qe(d,o,a){return o===0&&a===d.length?e.fromByteArray(d):e.fromByteArray(d.slice(o,a))}function W(d,o,a){a=Math.min(d.length,a);const h=[];let _=o;for(;_<a;){const b=d[_];let E=null,G=b>239?4:b>223?3:b>191?2:1;if(_+G<=a){let ie,X,se,Q;switch(G){case 1:b<128&&(E=b);break;case 2:ie=d[_+1],(ie&192)===128&&(Q=(b&31)<<6|ie&63,Q>127&&(E=Q));break;case 3:ie=d[_+1],X=d[_+2],(ie&192)===128&&(X&192)===128&&(Q=(b&15)<<12|(ie&63)<<6|X&63,Q>2047&&(Q<55296||Q>57343)&&(E=Q));break;case 4:ie=d[_+1],X=d[_+2],se=d[_+3],(ie&192)===128&&(X&192)===128&&(se&192)===128&&(Q=(b&15)<<18|(ie&63)<<12|(X&63)<<6|se&63,Q>65535&&Q<1114112&&(E=Q))}}E===null?(E=65533,G=1):E>65535&&(E-=65536,h.push(E>>>10&1023|55296),E=56320|E&1023),h.push(E),_+=G}return he(h)}const be=4096;function he(d){const o=d.length;if(o<=be)return String.fromCharCode.apply(String,d);let a="",h=0;for(;h<o;)a+=String.fromCharCode.apply(String,d.slice(h,h+=be));return a}function Re(d,o,a){let h="";a=Math.min(d.length,a);for(let _=o;_<a;++_)h+=String.fromCharCode(d[_]&127);return h}function Ue(d,o,a){let h="";a=Math.min(d.length,a);for(let _=o;_<a;++_)h+=String.fromCharCode(d[_]);return h}function Xe(d,o,a){const h=d.length;(!o||o<0)&&(o=0),(!a||a<0||a>h)&&(a=h);let _="";for(let b=o;b<a;++b)_+=vs[d[b]];return _}function Tt(d,o,a){const h=d.slice(o,a);let _="";for(let b=0;b<h.length-1;b+=2)_+=String.fromCharCode(h[b]+h[b+1]*256);return _}f.prototype.slice=function(o,a){const h=this.length;o=~~o,a=a===void 0?h:~~a,o<0?(o+=h,o<0&&(o=0)):o>h&&(o=h),a<0?(a+=h,a<0&&(a=0)):a>h&&(a=h),a<o&&(a=o);const _=this.subarray(o,a);return Object.setPrototypeOf(_,f.prototype),_};function ee(d,o,a){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+o>a)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(o,a,h){o=o>>>0,a=a>>>0,h||ee(o,a,this.length);let _=this[o],b=1,E=0;for(;++E<a&&(b*=256);)_+=this[o+E]*b;return _},f.prototype.readUintBE=f.prototype.readUIntBE=function(o,a,h){o=o>>>0,a=a>>>0,h||ee(o,a,this.length);let _=this[o+--a],b=1;for(;a>0&&(b*=256);)_+=this[o+--a]*b;return _},f.prototype.readUint8=f.prototype.readUInt8=function(o,a){return o=o>>>0,a||ee(o,1,this.length),this[o]},f.prototype.readUint16LE=f.prototype.readUInt16LE=function(o,a){return o=o>>>0,a||ee(o,2,this.length),this[o]|this[o+1]<<8},f.prototype.readUint16BE=f.prototype.readUInt16BE=function(o,a){return o=o>>>0,a||ee(o,2,this.length),this[o]<<8|this[o+1]},f.prototype.readUint32LE=f.prototype.readUInt32LE=function(o,a){return o=o>>>0,a||ee(o,4,this.length),(this[o]|this[o+1]<<8|this[o+2]<<16)+this[o+3]*16777216},f.prototype.readUint32BE=f.prototype.readUInt32BE=function(o,a){return o=o>>>0,a||ee(o,4,this.length),this[o]*16777216+(this[o+1]<<16|this[o+2]<<8|this[o+3])},f.prototype.readBigUInt64LE=rt(function(o){o=o>>>0,$(o,"offset");const a=this[o],h=this[o+7];(a===void 0||h===void 0)&&pe(o,this.length-8);const _=a+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24,b=this[++o]+this[++o]*2**8+this[++o]*2**16+h*2**24;return BigInt(_)+(BigInt(b)<<BigInt(32))}),f.prototype.readBigUInt64BE=rt(function(o){o=o>>>0,$(o,"offset");const a=this[o],h=this[o+7];(a===void 0||h===void 0)&&pe(o,this.length-8);const _=a*2**24+this[++o]*2**16+this[++o]*2**8+this[++o],b=this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+h;return(BigInt(_)<<BigInt(32))+BigInt(b)}),f.prototype.readIntLE=function(o,a,h){o=o>>>0,a=a>>>0,h||ee(o,a,this.length);let _=this[o],b=1,E=0;for(;++E<a&&(b*=256);)_+=this[o+E]*b;return b*=128,_>=b&&(_-=Math.pow(2,8*a)),_},f.prototype.readIntBE=function(o,a,h){o=o>>>0,a=a>>>0,h||ee(o,a,this.length);let _=a,b=1,E=this[o+--_];for(;_>0&&(b*=256);)E+=this[o+--_]*b;return b*=128,E>=b&&(E-=Math.pow(2,8*a)),E},f.prototype.readInt8=function(o,a){return o=o>>>0,a||ee(o,1,this.length),this[o]&128?(255-this[o]+1)*-1:this[o]},f.prototype.readInt16LE=function(o,a){o=o>>>0,a||ee(o,2,this.length);const h=this[o]|this[o+1]<<8;return h&32768?h|4294901760:h},f.prototype.readInt16BE=function(o,a){o=o>>>0,a||ee(o,2,this.length);const h=this[o+1]|this[o]<<8;return h&32768?h|4294901760:h},f.prototype.readInt32LE=function(o,a){return o=o>>>0,a||ee(o,4,this.length),this[o]|this[o+1]<<8|this[o+2]<<16|this[o+3]<<24},f.prototype.readInt32BE=function(o,a){return o=o>>>0,a||ee(o,4,this.length),this[o]<<24|this[o+1]<<16|this[o+2]<<8|this[o+3]},f.prototype.readBigInt64LE=rt(function(o){o=o>>>0,$(o,"offset");const a=this[o],h=this[o+7];(a===void 0||h===void 0)&&pe(o,this.length-8);const _=this[o+4]+this[o+5]*2**8+this[o+6]*2**16+(h<<24);return(BigInt(_)<<BigInt(32))+BigInt(a+this[++o]*2**8+this[++o]*2**16+this[++o]*2**24)}),f.prototype.readBigInt64BE=rt(function(o){o=o>>>0,$(o,"offset");const a=this[o],h=this[o+7];(a===void 0||h===void 0)&&pe(o,this.length-8);const _=(a<<24)+this[++o]*2**16+this[++o]*2**8+this[++o];return(BigInt(_)<<BigInt(32))+BigInt(this[++o]*2**24+this[++o]*2**16+this[++o]*2**8+h)}),f.prototype.readFloatLE=function(o,a){return o=o>>>0,a||ee(o,4,this.length),n.read(this,o,!0,23,4)},f.prototype.readFloatBE=function(o,a){return o=o>>>0,a||ee(o,4,this.length),n.read(this,o,!1,23,4)},f.prototype.readDoubleLE=function(o,a){return o=o>>>0,a||ee(o,8,this.length),n.read(this,o,!0,52,8)},f.prototype.readDoubleBE=function(o,a){return o=o>>>0,a||ee(o,8,this.length),n.read(this,o,!1,52,8)};function de(d,o,a,h,_,b){if(!f.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(o>_||o<b)throw new RangeError('"value" argument is out of bounds');if(a+h>d.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(o,a,h,_){if(o=+o,a=a>>>0,h=h>>>0,!_){const G=Math.pow(2,8*h)-1;de(this,o,a,h,G,0)}let b=1,E=0;for(this[a]=o&255;++E<h&&(b*=256);)this[a+E]=o/b&255;return a+h},f.prototype.writeUintBE=f.prototype.writeUIntBE=function(o,a,h,_){if(o=+o,a=a>>>0,h=h>>>0,!_){const G=Math.pow(2,8*h)-1;de(this,o,a,h,G,0)}let b=h-1,E=1;for(this[a+b]=o&255;--b>=0&&(E*=256);)this[a+b]=o/E&255;return a+h},f.prototype.writeUint8=f.prototype.writeUInt8=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,1,255,0),this[a]=o&255,a+1},f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,2,65535,0),this[a]=o&255,this[a+1]=o>>>8,a+2},f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,2,65535,0),this[a]=o>>>8,this[a+1]=o&255,a+2},f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,4,4294967295,0),this[a+3]=o>>>24,this[a+2]=o>>>16,this[a+1]=o>>>8,this[a]=o&255,a+4},f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,4,4294967295,0),this[a]=o>>>24,this[a+1]=o>>>16,this[a+2]=o>>>8,this[a+3]=o&255,a+4};function lt(d,o,a,h,_){nt(o,h,_,d,a,7);let b=Number(o&BigInt(4294967295));d[a++]=b,b=b>>8,d[a++]=b,b=b>>8,d[a++]=b,b=b>>8,d[a++]=b;let E=Number(o>>BigInt(32)&BigInt(4294967295));return d[a++]=E,E=E>>8,d[a++]=E,E=E>>8,d[a++]=E,E=E>>8,d[a++]=E,a}function ft(d,o,a,h,_){nt(o,h,_,d,a,7);let b=Number(o&BigInt(4294967295));d[a+7]=b,b=b>>8,d[a+6]=b,b=b>>8,d[a+5]=b,b=b>>8,d[a+4]=b;let E=Number(o>>BigInt(32)&BigInt(4294967295));return d[a+3]=E,E=E>>8,d[a+2]=E,E=E>>8,d[a+1]=E,E=E>>8,d[a]=E,a+8}f.prototype.writeBigUInt64LE=rt(function(o,a=0){return lt(this,o,a,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeBigUInt64BE=rt(function(o,a=0){return ft(this,o,a,BigInt(0),BigInt("0xffffffffffffffff"))}),f.prototype.writeIntLE=function(o,a,h,_){if(o=+o,a=a>>>0,!_){const ie=Math.pow(2,8*h-1);de(this,o,a,h,ie-1,-ie)}let b=0,E=1,G=0;for(this[a]=o&255;++b<h&&(E*=256);)o<0&&G===0&&this[a+b-1]!==0&&(G=1),this[a+b]=(o/E>>0)-G&255;return a+h},f.prototype.writeIntBE=function(o,a,h,_){if(o=+o,a=a>>>0,!_){const ie=Math.pow(2,8*h-1);de(this,o,a,h,ie-1,-ie)}let b=h-1,E=1,G=0;for(this[a+b]=o&255;--b>=0&&(E*=256);)o<0&&G===0&&this[a+b+1]!==0&&(G=1),this[a+b]=(o/E>>0)-G&255;return a+h},f.prototype.writeInt8=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,1,127,-128),o<0&&(o=255+o+1),this[a]=o&255,a+1},f.prototype.writeInt16LE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,2,32767,-32768),this[a]=o&255,this[a+1]=o>>>8,a+2},f.prototype.writeInt16BE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,2,32767,-32768),this[a]=o>>>8,this[a+1]=o&255,a+2},f.prototype.writeInt32LE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,4,2147483647,-2147483648),this[a]=o&255,this[a+1]=o>>>8,this[a+2]=o>>>16,this[a+3]=o>>>24,a+4},f.prototype.writeInt32BE=function(o,a,h){return o=+o,a=a>>>0,h||de(this,o,a,4,2147483647,-2147483648),o<0&&(o=4294967295+o+1),this[a]=o>>>24,this[a+1]=o>>>16,this[a+2]=o>>>8,this[a+3]=o&255,a+4},f.prototype.writeBigInt64LE=rt(function(o,a=0){return lt(this,o,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),f.prototype.writeBigInt64BE=rt(function(o,a=0){return ft(this,o,a,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ut(d,o,a,h,_,b){if(a+h>d.length)throw new RangeError("Index out of range");if(a<0)throw new RangeError("Index out of range")}function M(d,o,a,h,_){return o=+o,a=a>>>0,_||ut(d,o,a,4),n.write(d,o,a,h,23,4),a+4}f.prototype.writeFloatLE=function(o,a,h){return M(this,o,a,!0,h)},f.prototype.writeFloatBE=function(o,a,h){return M(this,o,a,!1,h)};function De(d,o,a,h,_){return o=+o,a=a>>>0,_||ut(d,o,a,8),n.write(d,o,a,h,52,8),a+8}f.prototype.writeDoubleLE=function(o,a,h){return De(this,o,a,!0,h)},f.prototype.writeDoubleBE=function(o,a,h){return De(this,o,a,!1,h)},f.prototype.copy=function(o,a,h,_){if(!f.isBuffer(o))throw new TypeError("argument should be a Buffer");if(h||(h=0),!_&&_!==0&&(_=this.length),a>=o.length&&(a=o.length),a||(a=0),_>0&&_<h&&(_=h),_===h||o.length===0||this.length===0)return 0;if(a<0)throw new RangeError("targetStart out of bounds");if(h<0||h>=this.length)throw new RangeError("Index out of range");if(_<0)throw new RangeError("sourceEnd out of bounds");_>this.length&&(_=this.length),o.length-a<_-h&&(_=o.length-a+h);const b=_-h;return this===o&&typeof s.prototype.copyWithin=="function"?this.copyWithin(a,h,_):s.prototype.set.call(o,this.subarray(h,_),a),b},f.prototype.fill=function(o,a,h,_){if(typeof o=="string"){if(typeof a=="string"?(_=a,a=0,h=this.length):typeof h=="string"&&(_=h,h=this.length),_!==void 0&&typeof _!="string")throw new TypeError("encoding must be a string");if(typeof _=="string"&&!f.isEncoding(_))throw new TypeError("Unknown encoding: "+_);if(o.length===1){const E=o.charCodeAt(0);(_==="utf8"&&E<128||_==="latin1")&&(o=E)}}else typeof o=="number"?o=o&255:typeof o=="boolean"&&(o=Number(o));if(a<0||this.length<a||this.length<h)throw new RangeError("Out of range index");if(h<=a)return this;a=a>>>0,h=h===void 0?this.length:h>>>0,o||(o=0);let b;if(typeof o=="number")for(b=a;b<h;++b)this[b]=o;else{const E=f.isBuffer(o)?o:f.from(o,_),G=E.length;if(G===0)throw new TypeError('The value "'+o+'" is invalid for argument "value"');for(b=0;b<h-a;++b)this[b+a]=E[b%G]}return this};const Le={};function et(d,o,a){Le[d]=class extends a{constructor(){super(),Object.defineProperty(this,"message",{value:o.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(_){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:_,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}et("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),et("ERR_INVALID_ARG_TYPE",function(d,o){return`The "${d}" argument must be of type number. Received type ${typeof o}`},TypeError),et("ERR_OUT_OF_RANGE",function(d,o,a){let h=`The value of "${d}" is out of range.`,_=a;return Number.isInteger(a)&&Math.abs(a)>2**32?_=tt(String(a)):typeof a=="bigint"&&(_=String(a),(a>BigInt(2)**BigInt(32)||a<-(BigInt(2)**BigInt(32)))&&(_=tt(_)),_+="n"),h+=` It must be ${o}. Received ${_}`,h},RangeError);function tt(d){let o="",a=d.length;const h=d[0]==="-"?1:0;for(;a>=h+4;a-=3)o=`_${d.slice(a-3,a)}${o}`;return`${d.slice(0,a)}${o}`}function kt(d,o,a){$(o,"offset"),(d[o]===void 0||d[o+a]===void 0)&&pe(o,d.length-(a+1))}function nt(d,o,a,h,_,b){if(d>a||d<o){const E=typeof o=="bigint"?"n":"";let G;throw b>3?o===0||o===BigInt(0)?G=`>= 0${E} and < 2${E} ** ${(b+1)*8}${E}`:G=`>= -(2${E} ** ${(b+1)*8-1}${E}) and < 2 ** ${(b+1)*8-1}${E}`:G=`>= ${o}${E} and <= ${a}${E}`,new Le.ERR_OUT_OF_RANGE("value",G,d)}kt(h,_,b)}function $(d,o){if(typeof d!="number")throw new Le.ERR_INVALID_ARG_TYPE(o,"number",d)}function pe(d,o,a){throw Math.floor(d)!==d?($(d,a),new Le.ERR_OUT_OF_RANGE(a||"offset","an integer",d)):o<0?new Le.ERR_BUFFER_OUT_OF_BOUNDS:new Le.ERR_OUT_OF_RANGE(a||"offset",`>= ${a?1:0} and <= ${o}`,d)}const cn=/[^+/0-9A-Za-z-_]/g;function ln(d){if(d=d.split("=")[0],d=d.trim().replace(cn,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function xt(d,o){o=o||1/0;let a;const h=d.length;let _=null;const b=[];for(let E=0;E<h;++E){if(a=d.charCodeAt(E),a>55295&&a<57344){if(!_){if(a>56319){(o-=3)>-1&&b.push(239,191,189);continue}else if(E+1===h){(o-=3)>-1&&b.push(239,191,189);continue}_=a;continue}if(a<56320){(o-=3)>-1&&b.push(239,191,189),_=a;continue}a=(_-55296<<10|a-56320)+65536}else _&&(o-=3)>-1&&b.push(239,191,189);if(_=null,a<128){if((o-=1)<0)break;b.push(a)}else if(a<2048){if((o-=2)<0)break;b.push(a>>6|192,a&63|128)}else if(a<65536){if((o-=3)<0)break;b.push(a>>12|224,a>>6&63|128,a&63|128)}else if(a<1114112){if((o-=4)<0)break;b.push(a>>18|240,a>>12&63|128,a>>6&63|128,a&63|128)}else throw new Error("Invalid code point")}return b}function fn(d){const o=[];for(let a=0;a<d.length;++a)o.push(d.charCodeAt(a)&255);return o}function un(d,o){let a,h,_;const b=[];for(let E=0;E<d.length&&!((o-=2)<0);++E)a=d.charCodeAt(E),h=a>>8,_=a%256,b.push(_),b.push(h);return b}function Gt(d){return e.toByteArray(ln(d))}function dt(d,o,a,h){let _;for(_=0;_<h&&!(_+a>=o.length||_>=d.length);++_)o[_+a]=d[_];return _}function Be(d,o){return d instanceof o||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===o.name}function zn(d){return d!==d}const vs=function(){const d="0123456789abcdef",o=new Array(256);for(let a=0;a<16;++a){const h=a*16;for(let _=0;_<16;++_)o[h+_]=d[a]+d[_]}return o}();function rt(d){return typeof BigInt>"u"?Ss:d}function Ss(){throw new Error("BigInt not supported")}})(mi);const F=mi.Buffer;class Y extends Error{constructor(e,n,r,...i){Array.isArray(n)&&(n=n.join(" ").trim()),super(n),Error.captureStackTrace!==void 0&&Error.captureStackTrace(this,Y),this.code=e;for(const s of i)for(const c in s){const l=s[c];this[c]=F.isBuffer(l)?l.toString(r.encoding):l==null?l:JSON.parse(JSON.stringify(l))}}}const Js=function(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)},_i=function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const i=t[n];if(i==null||i===!1)e[n]={disabled:!0};else if(typeof i=="string")e[n]={name:i};else if(Js(i)){if(typeof i.name!="string")throw new Y("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${n}`,"when column is an object literal"]);e[n]=i}else throw new Y("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(i)} at position ${n}`])}return e};class $r{constructor(e=100){this.size=e,this.length=0,this.buf=F.allocUnsafe(e)}prepend(e){if(F.isBuffer(e)){const n=this.length+e.length;if(n>=this.size&&(this.resize(),n>=this.size))throw Error("INVALID_BUFFER_STATE");const r=this.buf;this.buf=F.allocUnsafe(this.size),e.copy(this.buf,0),r.copy(this.buf,e.length),this.length+=e.length}else{const n=this.length++;n===this.size&&this.resize();const r=this.clone();this.buf[0]=e,r.copy(this.buf,1,0,n)}}append(e){const n=this.length++;n===this.size&&this.resize(),this.buf[n]=e}clone(){return F.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=this.size*2;const n=F.allocUnsafe(this.size);this.buf.copy(n,0,0,e),this.buf=n}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const qs=12,Hs=13,Zs=10,Ws=32,Ys=9,Ks=function(t){return{bomSkipped:!1,bufBytesStart:0,castField:t.cast_function,commenting:!1,error:void 0,enabled:t.from_line===1,escaping:!1,escapeIsQuote:F.isBuffer(t.escape)&&F.isBuffer(t.quote)&&F.compare(t.escape,t.quote)===0,expectedRecordLength:Array.isArray(t.columns)?t.columns.length:void 0,field:new $r(20),firstLineToHeaders:t.cast_first_line_to_header,needMoreDataSize:Math.max(t.comment!==null?t.comment.length:0,...t.delimiter.map(e=>e.length),t.quote!==null?t.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new $r(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:t.record_delimiter.length===0?0:Math.max(...t.record_delimiter.map(e=>e.length)),trimChars:[F.from(" ",t.encoding)[0],F.from("	",t.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[F.from(F.from([Hs],"utf8").toString(),t.encoding),F.from(F.from([Zs],"utf8").toString(),t.encoding),F.from(F.from([qs],"utf8").toString(),t.encoding),F.from(F.from([Ws],"utf8").toString(),t.encoding),F.from(F.from([Ys],"utf8").toString(),t.encoding)]}},Qs=function(t){return t.replace(/([A-Z])/g,function(e,n){return"_"+n.toLowerCase()})},Br=function(t){const e={};for(const r in t)e[Qs(r)]=t[r];if(e.encoding===void 0||e.encoding===!0)e.encoding="utf8";else if(e.encoding===null||e.encoding===!1)e.encoding=null;else if(typeof e.encoding!="string"&&e.encoding!==null)throw new Y("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(e.bom===void 0||e.bom===null||e.bom===!1)e.bom=!1;else if(e.bom!==!0)throw new Y("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,e.cast===void 0||e.cast===null||e.cast===!1||e.cast==="")e.cast=void 0;else if(typeof e.cast=="function")e.cast_function=e.cast,e.cast=!0;else if(e.cast!==!0)throw new Y("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(e.cast_date===void 0||e.cast_date===null||e.cast_date===!1||e.cast_date==="")e.cast_date=!1;else if(e.cast_date===!0)e.cast_date=function(r){const i=Date.parse(r);return isNaN(i)?r:new Date(i)};else if(typeof e.cast_date!="function")throw new Y("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,e.columns===!0)e.cast_first_line_to_header=void 0;else if(typeof e.columns=="function")e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=_i(e.columns);else if(e.columns===void 0||e.columns===null||e.columns===!1)e.columns=!1;else throw new Y("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);if(e.group_columns_by_name===void 0||e.group_columns_by_name===null||e.group_columns_by_name===!1)e.group_columns_by_name=!1;else{if(e.group_columns_by_name!==!0)throw new Y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(e.columns===!1)throw new Y("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(e.comment===void 0||e.comment===null||e.comment===!1||e.comment==="")e.comment=null;else if(typeof e.comment=="string"&&(e.comment=F.from(e.comment,e.encoding)),!F.isBuffer(e.comment))throw new Y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(e.comment_no_infix===void 0||e.comment_no_infix===null||e.comment_no_infix===!1)e.comment_no_infix=!1;else if(e.comment_no_infix!==!0)throw new Y("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const n=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),e.delimiter.length===0)throw new Y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${n}`],e);if(e.delimiter=e.delimiter.map(function(r){if(r==null||r===!1)return F.from(",",e.encoding);if(typeof r=="string"&&(r=F.from(r,e.encoding)),!F.isBuffer(r)||r.length===0)throw new Y("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${n}`],e);return r}),e.escape===void 0||e.escape===!0?e.escape=F.from('"',e.encoding):typeof e.escape=="string"?e.escape=F.from(e.escape,e.encoding):(e.escape===null||e.escape===!1)&&(e.escape=null),e.escape!==null&&!F.isBuffer(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(e.from===void 0||e.from===null)e.from=1;else if(typeof e.from=="string"&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),Number.isInteger(e.from)){if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(t.from)}`)}else throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from_line===void 0||e.from_line===null)e.from_line=1;else if(typeof e.from_line=="string"&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),Number.isInteger(e.from_line)){if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(t.from_line)}`)}else throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(t.from_line)}`);if(e.ignore_last_delimiters===void 0||e.ignore_last_delimiters===null)e.ignore_last_delimiters=!1;else if(typeof e.ignore_last_delimiters=="number")e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),e.ignore_last_delimiters===0&&(e.ignore_last_delimiters=!1);else if(typeof e.ignore_last_delimiters!="boolean")throw new Y("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(e.ignore_last_delimiters===!0&&e.columns===!1)throw new Y("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(e.info===void 0||e.info===null||e.info===!1)e.info=!1;else if(e.info!==!0)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(e.max_record_size===void 0||e.max_record_size===null||e.max_record_size===!1)e.max_record_size=0;else if(!(Number.isInteger(e.max_record_size)&&e.max_record_size>=0))if(typeof e.max_record_size=="string"&&/\d+/.test(e.max_record_size))e.max_record_size=parseInt(e.max_record_size);else throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);if(e.objname===void 0||e.objname===null||e.objname===!1)e.objname=void 0;else if(F.isBuffer(e.objname)){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty buffer");e.encoding===null||(e.objname=e.objname.toString(e.encoding))}else if(typeof e.objname=="string"){if(e.objname.length===0)throw new Error("Invalid Option: objname must be a non empty string")}else if(typeof e.objname!="number")throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(e.objname!==void 0){if(typeof e.objname=="number"){if(e.columns!==!1)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(e.columns===!1)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index")}if(e.on_record===void 0||e.on_record===null)e.on_record=void 0;else if(typeof e.on_record!="function")throw new Y("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(e.on_skip!==void 0&&e.on_skip!==null&&typeof e.on_skip!="function")throw new Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(e.on_skip)}`);if(e.quote===null||e.quote===!1||e.quote==="")e.quote=null;else if(e.quote===void 0||e.quote===!0?e.quote=F.from('"',e.encoding):typeof e.quote=="string"&&(e.quote=F.from(e.quote,e.encoding)),!F.isBuffer(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(e.raw===void 0||e.raw===null||e.raw===!1)e.raw=!1;else if(e.raw!==!0)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(e.record_delimiter===void 0)e.record_delimiter=[];else if(typeof e.record_delimiter=="string"||F.isBuffer(e.record_delimiter)){if(e.record_delimiter.length===0)throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(r,i){if(typeof r!="string"&&!F.isBuffer(r))throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${i},`,`got ${JSON.stringify(r)}`],e);if(r.length===0)throw new Y("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${i},`,`got ${JSON.stringify(r)}`],e);return typeof r=="string"&&(r=F.from(r,e.encoding)),r}),typeof e.relax_column_count!="boolean")if(e.relax_column_count===void 0||e.relax_column_count===null)e.relax_column_count=!1;else throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);if(typeof e.relax_column_count_less!="boolean")if(e.relax_column_count_less===void 0||e.relax_column_count_less===null)e.relax_column_count_less=!1;else throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);if(typeof e.relax_column_count_more!="boolean")if(e.relax_column_count_more===void 0||e.relax_column_count_more===null)e.relax_column_count_more=!1;else throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);if(typeof e.relax_quotes!="boolean")if(e.relax_quotes===void 0||e.relax_quotes===null)e.relax_quotes=!1;else throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);if(typeof e.skip_empty_lines!="boolean")if(e.skip_empty_lines===void 0||e.skip_empty_lines===null)e.skip_empty_lines=!1;else throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);if(typeof e.skip_records_with_empty_values!="boolean")if(e.skip_records_with_empty_values===void 0||e.skip_records_with_empty_values===null)e.skip_records_with_empty_values=!1;else throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);if(typeof e.skip_records_with_error!="boolean")if(e.skip_records_with_error===void 0||e.skip_records_with_error===null)e.skip_records_with_error=!1;else throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);if(e.rtrim===void 0||e.rtrim===null||e.rtrim===!1)e.rtrim=!1;else if(e.rtrim!==!0)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(e.ltrim===void 0||e.ltrim===null||e.ltrim===!1)e.ltrim=!1;else if(e.ltrim!==!0)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(e.trim===void 0||e.trim===null||e.trim===!1)e.trim=!1;else if(e.trim!==!0)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(e.trim===!0&&t.ltrim!==!1?e.ltrim=!0:e.ltrim!==!0&&(e.ltrim=!1),e.trim===!0&&t.rtrim!==!1?e.rtrim=!0:e.rtrim!==!0&&(e.rtrim=!1),e.to===void 0||e.to===null)e.to=-1;else if(typeof e.to=="string"&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),Number.isInteger(e.to)){if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(t.to)}`)}else throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(t.to)}`);if(e.to_line===void 0||e.to_line===null)e.to_line=-1;else if(typeof e.to_line=="string"&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),Number.isInteger(e.to_line)){if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(t.to_line)}`)}else throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(t.to_line)}`);return e},Nr=function(t){return t.every(e=>e==null||e.toString&&e.toString().trim()==="")},Xs=13,eo=10,Dt={utf8:F.from([239,187,191]),utf16le:F.from([255,254])},to=function(t={}){const e={bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},n=Br(t);return{info:e,original_options:t,options:n,state:Ks(n),__needMoreData:function(r,i,s){if(s)return!1;const{encoding:c,escape:l,quote:u}=this.options,{quoting:p,needMoreDataSize:f,recordDelimiterMaxLength:g}=this.state,m=i-r-1,y=Math.max(f,g===0?F.from(`\r
`,c).length:g,p?(l===null?0:l.length)+u.length:0,p?u.length+g:0);return m<y},parse:function(r,i,s,c){const{bom:l,comment_no_infix:u,encoding:p,from_line:f,ltrim:g,max_record_size:m,raw:y,relax_quotes:C,rtrim:v,skip_empty_lines:k,to:x,to_line:S}=this.options;let{comment:R,escape:A,quote:j,record_delimiter:Z}=this.options;const{bomSkipped:L,previousBuf:B,rawBuffer:T,escapeIsQuote:I}=this.state;let D;if(B===void 0)if(r===void 0){c();return}else D=r;else B!==void 0&&r===void 0?D=B:D=F.concat([B,r]);if(L===!1)if(l===!1)this.state.bomSkipped=!0;else if(D.length<3){if(i===!1){this.state.previousBuf=D;return}}else{for(const J in Dt)if(Dt[J].compare(D,0,Dt[J].length)===0){const Se=Dt[J].length;this.state.bufBytesStart+=Se,D=D.slice(Se),this.options=Br({...this.original_options,encoding:J}),{comment:R,escape:A,quote:j}=this.options;break}this.state.bomSkipped=!0}const le=D.length;let P;for(P=0;P<le&&!this.__needMoreData(P,le,i);P++){if(this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1),S!==-1&&this.info.lines>S){this.state.stop=!0,c();return}this.state.quoting===!1&&Z.length===0&&this.__autoDiscoverRecordDelimiter(D,P)&&(Z=this.options.record_delimiter);const J=D[P];if(y===!0&&T.append(J),(J===Xs||J===eo)&&this.state.wasRowDelimiter===!1&&(this.state.wasRowDelimiter=!0),this.state.escaping===!0)this.state.escaping=!1;else{if(A!==null&&this.state.quoting===!0&&this.__isEscape(D,P,J)&&P+A.length<le)if(I){if(this.__isQuote(D,P+A.length)){this.state.escaping=!0,P+=A.length-1;continue}}else{this.state.escaping=!0,P+=A.length-1;continue}if(this.state.commenting===!1&&this.__isQuote(D,P))if(this.state.quoting===!0){const W=D[P+j.length],be=v&&this.__isCharTrimable(D,P+j.length),he=R!==null&&this.__compareBytes(R,D,P+j.length,W),Re=this.__isDelimiter(D,P+j.length,W),Ue=Z.length===0?this.__autoDiscoverRecordDelimiter(D,P+j.length):this.__isRecordDelimiter(W,D,P+j.length);if(A!==null&&this.__isEscape(D,P,J)&&this.__isQuote(D,P+A.length))P+=A.length-1;else if(!W||Re||Ue||he||be){this.state.quoting=!1,this.state.wasQuoting=!0,P+=j.length-1;continue}else if(C===!1){const Xe=this.__error(new Y("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(W)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(Xe!==void 0)return Xe}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(j),P+=j.length-1}else if(this.state.field.length!==0){if(C===!1){const W=this.__infoField(),be=Object.keys(Dt).map(Re=>Dt[Re].equals(this.state.field.toString())?Re:!1).filter(Boolean)[0],he=this.__error(new Y("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(W.column)} at line ${W.lines}, value is ${JSON.stringify(this.state.field.toString(p))}`,be?`(${be} bom)`:void 0],this.options,W,{field:this.state.field}));if(he!==void 0)return he}}else{this.state.quoting=!0,P+=j.length-1;continue}if(this.state.quoting===!1){const W=this.__isRecordDelimiter(J,D,P);if(W!==0){if(this.state.commenting&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0)this.info.comment_lines++;else{if(this.state.enabled===!1&&this.info.lines+(this.state.wasRowDelimiter===!0?1:0)>=f){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),P+=W-1;continue}if(k===!0&&this.state.wasQuoting===!1&&this.state.record.length===0&&this.state.field.length===0){this.info.empty_lines++,P+=W-1;continue}this.info.bytes=this.state.bufBytesStart+P;const Re=this.__onField();if(Re!==void 0)return Re;this.info.bytes=this.state.bufBytesStart+P+W;const Ue=this.__onRecord(s);if(Ue!==void 0)return Ue;if(x!==-1&&this.info.records>=x){this.state.stop=!0,c();return}}this.state.commenting=!1,P+=W-1;continue}if(this.state.commenting)continue;if(R!==null&&(u===!1||this.state.record.length===0&&this.state.field.length===0)&&this.__compareBytes(R,D,P,J)!==0){this.state.commenting=!0;continue}const be=this.__isDelimiter(D,P,J);if(be!==0){this.info.bytes=this.state.bufBytesStart+P;const he=this.__onField();if(he!==void 0)return he;P+=be-1;continue}}}if(this.state.commenting===!1&&m!==0&&this.state.record_length+this.state.field.length>m)return this.__error(new Y("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${m}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const Se=g===!1||this.state.quoting===!0||this.state.field.length!==0||!this.__isCharTrimable(D,P),Qe=v===!1||this.state.wasQuoting===!1;if(Se===!0&&Qe===!0)this.state.field.append(J);else{if(v===!0&&!this.__isCharTrimable(D,P))return this.__error(new Y("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()));Se===!1&&(P+=this.__isCharTrimable(D,P)-1);continue}}if(i===!0)if(this.state.quoting===!0){const J=this.__error(new Y("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(J!==void 0)return J}else if(this.state.wasQuoting===!0||this.state.record.length!==0||this.state.field.length!==0){this.info.bytes=this.state.bufBytesStart+P;const J=this.__onField();if(J!==void 0)return J;const Se=this.__onRecord(s);if(Se!==void 0)return Se}else this.state.wasRowDelimiter===!0?this.info.empty_lines++:this.state.commenting===!0&&this.info.comment_lines++;else this.state.bufBytesStart+=P,this.state.previousBuf=D.slice(P);this.state.wasRowDelimiter===!0&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(r){const{columns:i,group_columns_by_name:s,encoding:c,info:l,from:u,relax_column_count:p,relax_column_count_less:f,relax_column_count_more:g,raw:m,skip_records_with_empty_values:y}=this.options,{enabled:C,record:v}=this.state;if(C===!1)return this.__resetRecord();const k=v.length;if(i===!0){if(y===!0&&Nr(v)){this.__resetRecord();return}return this.__firstLineToColumns(v)}if(i===!1&&this.info.records===0&&(this.state.expectedRecordLength=k),k!==this.state.expectedRecordLength){const x=i===!1?new Y("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${k} on line ${this.info.lines}`],this.options,this.__infoField(),{record:v}):new Y("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${i.length},`,`got ${k} on line ${this.info.lines}`],this.options,this.__infoField(),{record:v});if(p===!0||f===!0&&k<this.state.expectedRecordLength||g===!0&&k>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=x;else{const S=this.__error(x);if(S)return S}}if(y===!0&&Nr(v)){this.__resetRecord();return}if(this.state.recordHasError===!0){this.__resetRecord(),this.state.recordHasError=!1;return}if(this.info.records++,u===1||this.info.records>=u){const{objname:x}=this.options;if(i!==!1){const S={};for(let R=0,A=v.length;R<A;R++)i[R]===void 0||i[R].disabled||(s===!0&&S[i[R].name]!==void 0?Array.isArray(S[i[R].name])?S[i[R].name]=S[i[R].name].concat(v[R]):S[i[R].name]=[S[i[R].name],v[R]]:S[i[R].name]=v[R]);if(m===!0||l===!0){const R=Object.assign({record:S},m===!0?{raw:this.state.rawBuffer.toString(c)}:{},l===!0?{info:this.__infoRecord()}:{}),A=this.__push(x===void 0?R:[S[x],R],r);if(A)return A}else{const R=this.__push(x===void 0?S:[S[x],S],r);if(R)return R}}else if(m===!0||l===!0){const S=Object.assign({record:v},m===!0?{raw:this.state.rawBuffer.toString(c)}:{},l===!0?{info:this.__infoRecord()}:{}),R=this.__push(x===void 0?S:[v[x],S],r);if(R)return R}else{const S=this.__push(x===void 0?v:[v[x],v],r);if(S)return S}}this.__resetRecord()},__firstLineToColumns:function(r){const{firstLineToHeaders:i}=this.state;try{const s=i===void 0?r:i.call(null,r);if(!Array.isArray(s))return this.__error(new Y("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(s)}`],this.options,this.__infoField(),{headers:s}));const c=_i(s);this.state.expectedRecordLength=c.length,this.options.columns=c,this.__resetRecord();return}catch(s){return s}},__resetRecord:function(){this.options.raw===!0&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:r,encoding:i,rtrim:s,max_record_size:c}=this.options,{enabled:l,wasQuoting:u}=this.state;if(l===!1)return this.__resetField();let p=this.state.field.toString(i);if(s===!0&&u===!1&&(p=p.trimRight()),r===!0){const[f,g]=this.__cast(p);if(f!==void 0)return f;p=g}this.state.record.push(p),c!==0&&typeof p=="string"&&(this.state.record_length+=p.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(r,i){const{on_record:s}=this.options;if(s!==void 0){const c=this.__infoRecord();try{r=s.call(null,r,c)}catch(l){return l}if(r==null)return}i(r)},__cast:function(r){const{columns:i,relax_column_count:s}=this.options;if(Array.isArray(i)===!0&&s&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(this.state.castField!==null)try{const l=this.__infoField();return[void 0,this.state.castField.call(null,r,l)]}catch(l){return[l]}if(this.__isFloat(r))return[void 0,parseFloat(r)];if(this.options.cast_date!==!1){const l=this.__infoField();return[void 0,this.options.cast_date.call(null,r,l)]}return[void 0,r]},__isCharTrimable:function(r,i){return((c,l)=>{const{timchars:u}=this.state;e:for(let p=0;p<u.length;p++){const f=u[p];for(let g=0;g<f.length;g++)if(f[g]!==c[l+g])continue e;return f.length}return 0})(r,i)},__isFloat:function(r){return r-parseFloat(r)+1>=0},__compareBytes:function(r,i,s,c){if(r[0]!==c)return 0;const l=r.length;for(let u=1;u<l;u++)if(r[u]!==i[s+u])return 0;return l},__isDelimiter:function(r,i,s){const{delimiter:c,ignore_last_delimiters:l}=this.options;if(l===!0&&this.state.record.length===this.options.columns.length-1)return 0;if(l!==!1&&typeof l=="number"&&this.state.record.length===l-1)return 0;e:for(let u=0;u<c.length;u++){const p=c[u];if(p[0]===s){for(let f=1;f<p.length;f++)if(p[f]!==r[i+f])continue e;return p.length}}return 0},__isRecordDelimiter:function(r,i,s){const{record_delimiter:c}=this.options,l=c.length;e:for(let u=0;u<l;u++){const p=c[u],f=p.length;if(p[0]===r){for(let g=1;g<f;g++)if(p[g]!==i[s+g])continue e;return p.length}}return 0},__isEscape:function(r,i,s){const{escape:c}=this.options;if(c===null)return!1;const l=c.length;if(c[0]===s){for(let u=0;u<l;u++)if(c[u]!==r[i+u])return!1;return!0}return!1},__isQuote:function(r,i){const{quote:s}=this.options;if(s===null)return!1;const c=s.length;for(let l=0;l<c;l++)if(s[l]!==r[i+l])return!1;return!0},__autoDiscoverRecordDelimiter:function(r,i){const{encoding:s}=this.options,c=[F.from(`\r
`,s),F.from(`
`,s),F.from("\r",s)];e:for(let l=0;l<c.length;l++){const u=c[l].length;for(let p=0;p<u;p++)if(c[l][p]!==r[i+p])continue e;return this.options.record_delimiter.push(c[l]),this.state.recordDelimiterMaxLength=c[l].length,c[l].length}return 0},__error:function(r){const{encoding:i,raw:s,skip_records_with_error:c}=this.options,l=typeof r=="string"?new Error(r):r;if(c){this.state.recordHasError=!0,this.options.on_skip!==void 0&&this.options.on_skip(l,s?this.state.rawBuffer.toString(i):void 0);return}else return l},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:r,raw:i,encoding:s}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:r===!0,index:this.state.record.length,raw:i?this.state.rawBuffer.toString(s):void 0}},__infoField:function(){const{columns:r}=this.options,i=Array.isArray(r);return{...this.__infoRecord(),column:i===!0?r.length>this.state.record.length?r[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}},no=function(t,e={}){typeof t=="string"&&(t=F.from(t));const n=e&&e.objname?{}:[],r=to(e),i=u=>{r.options.objname===void 0?n.push(u):n[u[0]]=u[1]},s=()=>{},c=r.parse(t,!1,i,s);if(c!==void 0)throw c;const l=r.parse(void 0,!0,i,s);if(l!==void 0)throw l;return n},ro="/project-delta-mvp/dist/assets/atnia_set1-6ec0853c.csv",io=2,so=6,oo=io*so;class ao{constructor(){dn(this,"id",Math.random())}}class co extends ao{constructor(e,n,r,i,s,c,l,u,p,f){super(),this.name=e,this.cost=n,this.source=r,this.type=i,this.subtype=s,this.speed=c,this.offense=l,this.defense=u,this.rulesText=p,this.flavorText=f}}const Jn=["Name","Energy Cost","Source","Type","Subtype","Speed","Offense","Defense","RulesText","FlavorText","image","CommentsTags","Comments","RelatedCards","TagsReal","Formats","Set"];async function lo(){const t=await(await fetch(ro)).text();let e=no(t);e=e.filter(function(n){return n.length>0&&n[0].length>0&&n[0]!="BEGIN_CARDS"&&!n[0].startsWith("-")});for(let n=0;n<Math.min(e[0].length,Jn.length);++n)if(e[0][n]!==Jn[n])throw`cards header did not match! expected ${Jn} but got ${e[0]}`;return e.slice(1).map(function(n){return new co(n[0],parseInt(n[1]),n[2],n[3],n[4],parseInt(n[5]),parseInt(n[6]),parseInt(n[7]),n[8],n[9])})}const fo="finalize",uo="consider";function Ft(t,e,n){t.dispatchEvent(new CustomEvent(fo,{detail:{items:e,info:n}}))}function ct(t,e,n){t.dispatchEvent(new CustomEvent(uo,{detail:{items:e,info:n}}))}const Bn="draggedEntered",sn="draggedLeft",Nn="draggedOverIndex",Er="draggedLeftDocument",Tn={LEFT_FOR_ANOTHER:"leftForAnother",OUTSIDE_OF_ANY:"outsideOfAny"};function po(t,e,n){t.dispatchEvent(new CustomEvent(Bn,{detail:{indexObj:e,draggedEl:n}}))}function ho(t,e,n){t.dispatchEvent(new CustomEvent(sn,{detail:{draggedEl:e,type:Tn.LEFT_FOR_ANOTHER,theOtherDz:n}}))}function mo(t,e){t.dispatchEvent(new CustomEvent(sn,{detail:{draggedEl:e,type:Tn.OUTSIDE_OF_ANY}}))}function go(t,e,n){t.dispatchEvent(new CustomEvent(Nn,{detail:{indexObj:e,draggedEl:n}}))}function _o(t){window.dispatchEvent(new CustomEvent(Er,{detail:{draggedEl:t}}))}const xe={DRAG_STARTED:"dragStarted",DRAGGED_ENTERED:Bn,DRAGGED_ENTERED_ANOTHER:"dragEnteredAnother",DRAGGED_OVER_INDEX:Nn,DRAGGED_LEFT:sn,DRAGGED_LEFT_ALL:"draggedLeftAll",DROPPED_INTO_ZONE:"droppedIntoZone",DROPPED_INTO_ANOTHER:"droppedIntoAnother",DROPPED_OUTSIDE_OF_ANY:"droppedOutsideOfAny",DRAG_STOPPED:"dragStopped"},$e={POINTER:"pointer",KEYBOARD:"keyboard"},on="isDndShadowItem",vr="data-is-dnd-shadow-item-internal",yo="data-is-dnd-shadow-item-hint",bo="id:dnd-shadow-placeholder-0000",Co="dnd-action-dragged-el";let ye="id",Xn=0;function yi(){Xn++}function bi(){if(Xn===0)throw new Error("Bug! trying to decrement when there are no dropzones");Xn--}const Sr=typeof window>"u";function er(t){let e;const n=t.getBoundingClientRect(),r=getComputedStyle(t),i=r.transform;if(i){let s,c,l,u;if(i.startsWith("matrix3d("))e=i.slice(9,-1).split(/, /),s=+e[0],c=+e[5],l=+e[12],u=+e[13];else if(i.startsWith("matrix("))e=i.slice(7,-1).split(/, /),s=+e[0],c=+e[3],l=+e[4],u=+e[5];else return n;const p=r.transformOrigin,f=n.x-l-(1-s)*parseFloat(p),g=n.y-u-(1-c)*parseFloat(p.slice(p.indexOf(" ")+1)),m=s?n.width/s:t.offsetWidth,y=c?n.height/c:t.offsetHeight;return{x:f,y:g,width:m,height:y,top:g,right:f+m,bottom:g+y,left:f}}else return n}function Ci(t){const e=er(t);return{top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}}function Ei(t){const e=t.getBoundingClientRect();return{top:e.top+window.scrollY,bottom:e.bottom+window.scrollY,left:e.left+window.scrollX,right:e.right+window.scrollX}}function vi(t){return{x:(t.left+t.right)/2,y:(t.top+t.bottom)/2}}function Eo(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Ln(t,e){return t.y<=e.bottom&&t.y>=e.top&&t.x>=e.left&&t.x<=e.right}function Qt(t){return vi(Ei(t))}function Lr(t,e){const n=Qt(t),r=Ci(e);return Ln(n,r)}function vo(t,e){const n=Qt(t),r=Qt(e);return Eo(n,r)}function So(t){const e=Ei(t);return e.right<0||e.left>document.documentElement.scrollWidth||e.bottom<0||e.top>document.documentElement.scrollHeight}let At;function Tr(){At=new Map}Tr();function To(t){const e=Array.from(t.children).findIndex(n=>n.getAttribute(vr));if(e>=0)return At.has(t)||At.set(t,new Map),At.get(t).set(e,Ci(t.children[e])),e}function ko(t,e){if(!Lr(t,e))return null;const n=e.children;if(n.length===0)return{index:0,isProximityBased:!0};const r=To(e);for(let c=0;c<n.length;c++)if(Lr(t,n[c])){const l=At.has(e)&&At.get(e).get(c);return l&&!Ln(Qt(t),l)?{index:r,isProximityBased:!1}:{index:c,isProximityBased:!1}}let i=Number.MAX_VALUE,s;for(let c=0;c<n.length;c++){const l=vo(t,n[c]);l<i&&(i=l,s=c)}return{index:s,isProximityBased:!0}}function pn(t){return JSON.stringify(t,null,2)}function kn(t){if(!t)throw new Error("cannot get depth of a falsy node");return Si(t,0)}function Si(t,e=0){return t.parentElement?Si(t.parentElement,e+1):e-1}function xo(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!{}.hasOwnProperty.call(e,n)||e[n]!==t[n])return!1;return!0}function Io(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const Ro=200,Mr=10;let tr;function Do(t,e,n=Ro,r){let i,s,c=!1,l;const u=Array.from(e).sort((f,g)=>kn(g)-kn(f));function p(){const f=Qt(t),g=r.multiScrollIfNeeded();if(!g&&l&&Math.abs(l.x-f.x)<Mr&&Math.abs(l.y-f.y)<Mr){tr=window.setTimeout(p,n);return}if(So(t)){_o(t);return}l=f;let m=!1;for(const y of u){g&&Tr();const C=ko(t,y);if(C===null)continue;const{index:v}=C;m=!0,y!==i?(i&&ho(i,t,y),po(y,C,t),i=y):v!==s&&(go(y,C,t),s=v);break}!m&&c&&i?(mo(i,t),i=void 0,s=void 0,c=!1):c=!0,tr=window.setTimeout(p,n)}p()}function wo(){clearTimeout(tr),Tr()}const qt=30;function Oo(){let t;function e(){t={directionObj:void 0,stepPx:0}}e();function n(s){const{directionObj:c,stepPx:l}=t;c&&(s.scrollBy(c.x*l,c.y*l),window.requestAnimationFrame(()=>n(s)))}function r(s){return qt-s}function i(s,c){if(!c)return!1;const l=Ao(s,c),u=!!t.directionObj;if(l===null)return u&&e(),!1;let[p,f]=[!1,!1];return c.scrollHeight>c.clientHeight&&(l.bottom<qt?(p=!0,t.directionObj={x:0,y:1},t.stepPx=r(l.bottom)):l.top<qt&&(p=!0,t.directionObj={x:0,y:-1},t.stepPx=r(l.top)),!u&&p)||c.scrollWidth>c.clientWidth&&(l.right<qt?(f=!0,t.directionObj={x:1,y:0},t.stepPx=r(l.right)):l.left<qt&&(f=!0,t.directionObj={x:-1,y:0},t.stepPx=r(l.left)),!u&&f)?(n(c),!0):(e(),!1)}return{scrollIfNeeded:i,resetScrolling:e}}function Ao(t,e){const n=e===document.scrollingElement?{top:0,bottom:window.innerHeight,left:0,right:window.innerWidth}:e.getBoundingClientRect();return Ln(t,n)?{top:t.y-n.top,bottom:n.bottom-t.y,left:t.x-n.left,right:n.right-t.x}:null}function Po(t=[],e){const n=Bo(t),r=Array.from(n).sort((l,u)=>kn(u)-kn(l)),{scrollIfNeeded:i,resetScrolling:s}=Oo();function c(){const l=e();if(!l||!r)return!1;const u=r.filter(p=>Ln(l,p.getBoundingClientRect())||p===document.scrollingElement);for(let p=0;p<u.length;p++)if(i(l,u[p]))return!0;return!1}return{multiScrollIfNeeded:n.size>0?c:()=>!1,destroy:()=>s()}}function $o(t){if(!t)return[];const e=[];let n=t;for(;n;){const{overflow:r}=window.getComputedStyle(n);r.split(" ").some(i=>i.includes("auto")||i.includes("scroll"))&&e.push(n),n=n.parentElement}return e}function Bo(t){const e=new Set;for(let n of t)$o(n).forEach(r=>e.add(r));return(document.scrollingElement.scrollHeight>document.scrollingElement.clientHeight||document.scrollingElement.scrollWidth>document.scrollingElement.clientHeight)&&e.add(document.scrollingElement),e}function No(t){const e=t.cloneNode(!0),n=[],r=t.tagName==="SELECT",i=r?[t]:[...t.querySelectorAll("select")];for(const l of i)n.push(l.value);if(i.length>0){const l=r?[e]:[...e.querySelectorAll("select")];for(let u=0;u<l.length;u++){const p=l[u],f=n[u],g=p.querySelector(`option[value="${f}"`);g&&g.setAttribute("selected",!0)}}const s=t.tagName==="CANVAS",c=s?[t]:[...t.querySelectorAll("canvas")];if(c.length>0){const l=s?[e]:[...e.querySelectorAll("canvas")];for(let u=0;u<l.length;u++){const p=c[u],f=l[u];f.width=p.width,f.height=p.height,p.width>0&&p.height>0&&f.getContext("2d").drawImage(p,0,0)}}return e}const Xt=Object.freeze({USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT:"USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT"}),Lo={[Xt.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT]:!1};function Ti(t){if(!Xt[t])throw new Error(`Can't get non existing feature flag ${t}! Supported flags: ${Object.keys(Xt)}`);return Lo[t]}const Mo=.2;function pt(t){return`${t} ${Mo}s ease`}function Fo(t,e){const n=t.getBoundingClientRect(),r=No(t);ki(t,r),r.id=Co,r.style.position="fixed";let i=n.top,s=n.left;if(r.style.top=`${i}px`,r.style.left=`${s}px`,e){const c=vi(n);i-=c.y-e.y,s-=c.x-e.x,window.setTimeout(()=>{r.style.top=`${i}px`,r.style.left=`${s}px`},0)}return r.style.margin="0",r.style.boxSizing="border-box",r.style.height=`${n.height}px`,r.style.width=`${n.width}px`,r.style.transition=`${pt("top")}, ${pt("left")}, ${pt("background-color")}, ${pt("opacity")}, ${pt("color")} `,window.setTimeout(()=>r.style.transition+=`, ${pt("width")}, ${pt("height")}`,0),r.style.zIndex="9999",r.style.cursor="grabbing",r}function Uo(t){t.style.cursor="grab"}function jo(t,e,n,r){ki(e,t);const i=e.getBoundingClientRect(),s=t.getBoundingClientRect(),c=i.width-s.width,l=i.height-s.height;if(c||l){const u={left:(n-s.left)/s.width,top:(r-s.top)/s.height};Ti(Xt.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)||(t.style.height=`${i.height}px`,t.style.width=`${i.width}px`),t.style.left=`${parseFloat(t.style.left)-u.left*c}px`,t.style.top=`${parseFloat(t.style.top)-u.top*l}px`}}function ki(t,e){const n=window.getComputedStyle(t);Array.from(n).filter(r=>r.startsWith("background")||r.startsWith("padding")||r.startsWith("font")||r.startsWith("text")||r.startsWith("align")||r.startsWith("justify")||r.startsWith("display")||r.startsWith("flex")||r.startsWith("border")||r==="opacity"||r==="color"||r==="list-style-type"||Ti(Xt.USE_COMPUTED_STYLE_INSTEAD_OF_BOUNDING_RECT)&&(r==="width"||r==="height")).forEach(r=>e.style.setProperty(r,n.getPropertyValue(r),n.getPropertyPriority(r)))}function zo(t,e){t.draggable=!1,t.ondragstart=()=>!1,e?(t.style.userSelect="",t.style.WebkitUserSelect="",t.style.cursor=""):(t.style.userSelect="none",t.style.WebkitUserSelect="none",t.style.cursor="grab")}function xi(t){t.style.display="none",t.style.position="fixed",t.style.zIndex="-5"}function Vo(t){t.style.visibility="hidden",t.setAttribute(vr,"true")}function Go(t){t.style.visibility="",t.removeAttribute(vr)}function mn(t,e=()=>{},n=()=>[]){t.forEach(r=>{const i=e(r);Object.keys(i).forEach(s=>{r.style[s]=i[s]}),n(r).forEach(s=>r.classList.add(s))})}function xn(t,e=()=>{},n=()=>[]){t.forEach(r=>{const i=e(r);Object.keys(i).forEach(s=>{r.style[s]=""}),n(r).forEach(s=>r.classList.contains(s)&&r.classList.remove(s))})}function Jo(t){const e=t.style.minHeight;t.style.minHeight=window.getComputedStyle(t).getPropertyValue("height");const n=t.style.minWidth;return t.style.minWidth=window.getComputedStyle(t).getPropertyValue("width"),function(){t.style.minHeight=e,t.style.minWidth=n}}const qo="--any--",Ho=100,Zo=20,Fr=3,Ur={outline:"rgba(255, 255, 102, 0.7) solid 2px"},jr="data-is-dnd-original-dragged-item";let qe,ve,Oe,Mn,re,Fn,at,Ee,st,Ne,it=!1,kr=!1,xr,an=!1,gn=[],In;const Ve=new Map,ce=new Map,qn=new WeakMap;function Wo(t,e){Ve.has(e)||Ve.set(e,new Set),Ve.get(e).has(t)||(Ve.get(e).add(t),yi())}function zr(t,e){Ve.get(e).delete(t),bi(),Ve.get(e).size===0&&Ve.delete(e)}function Yo(){const t=Ve.get(Mn);for(const r of t)r.addEventListener(Bn,Ii),r.addEventListener(sn,Ri),r.addEventListener(Nn,Di);window.addEventListener(Er,Ut);const e=Math.max(...Array.from(t.keys()).map(r=>ce.get(r).dropAnimationDurationMs)),n=e===0?Zo:Math.max(e,Ho);In=Po(t,()=>Ne),Do(ve,t,n*1.07,In)}function Ko(){const t=Ve.get(Mn);for(const e of t)e.removeEventListener(Bn,Ii),e.removeEventListener(sn,Ri),e.removeEventListener(Nn,Di);window.removeEventListener(Er,Ut),In.destroy(),In=void 0,wo()}function Un(t){return t.findIndex(e=>!!e[on])}function Qo(t){return{...t,[on]:!0,[ye]:bo}}function Ii(t){let{items:e,dropFromOthersDisabled:n}=ce.get(t.currentTarget);if(n&&t.currentTarget!==re)return;if(an=!1,e=e.filter(c=>c[ye]!==at[ye]),re!==t.currentTarget){const l=ce.get(re).items.filter(u=>!u[on]);ct(re,l,{trigger:xe.DRAGGED_ENTERED_ANOTHER,id:Oe[ye],source:$e.POINTER})}const{index:r,isProximityBased:i}=t.detail.indexObj,s=i&&r===t.currentTarget.children.length-1?r+1:r;Ee=t.currentTarget,e.splice(s,0,at),ct(t.currentTarget,e,{trigger:xe.DRAGGED_ENTERED,id:Oe[ye],source:$e.POINTER})}function Ri(t){if(!it)return;const{items:e,dropFromOthersDisabled:n}=ce.get(t.currentTarget);if(n&&t.currentTarget!==re&&t.currentTarget!==Ee)return;const r=[...e],i=Un(r);i!==-1&&r.splice(i,1);const s=Ee;Ee=void 0;const{type:c,theOtherDz:l}=t.detail;if(c===Tn.OUTSIDE_OF_ANY||c===Tn.LEFT_FOR_ANOTHER&&l!==re&&ce.get(l).dropFromOthersDisabled){an=!0,Ee=re;const u=s===re?r:[...ce.get(re).items];u.splice(Fn,0,at),ct(re,u,{trigger:xe.DRAGGED_LEFT_ALL,id:Oe[ye],source:$e.POINTER})}ct(t.currentTarget,r,{trigger:xe.DRAGGED_LEFT,id:Oe[ye],source:$e.POINTER})}function Di(t){const{items:e,dropFromOthersDisabled:n}=ce.get(t.currentTarget);if(n&&t.currentTarget!==re)return;const r=[...e];an=!1;const{index:i}=t.detail.indexObj,s=Un(r);s!==-1&&r.splice(s,1),r.splice(i,0,at),ct(t.currentTarget,r,{trigger:xe.DRAGGED_OVER_INDEX,id:Oe[ye],source:$e.POINTER})}function Rn(t){t.preventDefault();const e=t.touches?t.touches[0]:t;Ne={x:e.clientX,y:e.clientY},ve.style.transform=`translate3d(${Ne.x-st.x}px, ${Ne.y-st.y}px, 0)`}function Ut(){kr=!0,window.removeEventListener("mousemove",Rn),window.removeEventListener("touchmove",Rn),window.removeEventListener("mouseup",Ut),window.removeEventListener("touchend",Ut),Ko(),Uo(ve),Ee||(Ee=re);let{items:t,type:e}=ce.get(Ee);xn(Ve.get(e),i=>ce.get(i).dropTargetStyle,i=>ce.get(i).dropTargetClasses);let n=Un(t);n===-1&&Ee===re&&(n=Fn),t=t.map(i=>i[on]?Oe:i);function r(){xr(),Ft(Ee,t,{trigger:an?xe.DROPPED_OUTSIDE_OF_ANY:xe.DROPPED_INTO_ZONE,id:Oe[ye],source:$e.POINTER}),Ee!==re&&Ft(re,ce.get(re).items,{trigger:xe.DROPPED_INTO_ANOTHER,id:Oe[ye],source:$e.POINTER}),n!==-1&&Go(Ee.children[n]),ta()}ce.get(Ee).dropAnimationDisabled?r():Xo(n,r)}function Xo(t,e){const n=t>-1?er(Ee.children[t]):er(Ee),r={x:n.left-parseFloat(ve.style.left),y:n.top-parseFloat(ve.style.top)},{dropAnimationDurationMs:i}=ce.get(Ee),s=`transform ${i}ms ease`;ve.style.transition=ve.style.transition?ve.style.transition+","+s:s,ve.style.transform=`translate3d(${r.x}px, ${r.y}px, 0)`,window.setTimeout(e,i)}function ea(t,e){gn.push({dz:t,destroy:e}),window.requestAnimationFrame(()=>{xi(t),document.body.appendChild(t)})}function ta(){ve.remove(),qe.remove(),gn.length&&(gn.forEach(({dz:t,destroy:e})=>{e(),t.remove()}),gn=[]),ve=void 0,qe=void 0,Oe=void 0,Mn=void 0,re=void 0,Fn=void 0,at=void 0,Ee=void 0,st=void 0,Ne=void 0,it=!1,kr=!1,xr=void 0,an=!1}function na(t,e){let n=!1;const r={items:void 0,type:void 0,flipDurationMs:0,dragDisabled:!1,morphDisabled:!1,dropFromOthersDisabled:!1,dropTargetStyle:Ur,dropTargetClasses:[],transformDraggedElement:()=>{},centreDraggedOnCursor:!1,dropAnimationDisabled:!1};let i=new Map;function s(){window.addEventListener("mousemove",u,{passive:!1}),window.addEventListener("touchmove",u,{passive:!1,capture:!1}),window.addEventListener("mouseup",l,{passive:!1}),window.addEventListener("touchend",l,{passive:!1})}function c(){window.removeEventListener("mousemove",u),window.removeEventListener("touchmove",u),window.removeEventListener("mouseup",l),window.removeEventListener("touchend",l)}function l(m){c(),qe=void 0,st=void 0,Ne=void 0,m.type==="touchend"&&m.target.click()}function u(m){m.preventDefault();const y=m.touches?m.touches[0]:m;Ne={x:y.clientX,y:y.clientY},(Math.abs(Ne.x-st.x)>=Fr||Math.abs(Ne.y-st.y)>=Fr)&&(c(),f())}function p(m){if(m.target!==m.currentTarget&&(m.target.value!==void 0||m.target.isContentEditable)||m.button||it)return;m.preventDefault(),m.stopPropagation();const y=m.touches?m.touches[0]:m;st={x:y.clientX,y:y.clientY},Ne={...st},qe=m.currentTarget,s()}function f(){it=!0;const m=i.get(qe);Fn=m,re=qe.parentElement;const y=re.closest("dialog")||re.getRootNode(),C=y.body||y,{items:v,type:k,centreDraggedOnCursor:x}=r,S=[...v];Oe=S[m],Mn=k,at=Qo(Oe),ve=Fo(qe,x&&Ne),qe.setAttribute(jr,!0);function R(){ve.parentElement?window.requestAnimationFrame(R):(C.appendChild(ve),ve.focus(),Yo(),xi(qe),C.appendChild(qe),at[ye]=Oe[ye])}window.requestAnimationFrame(R),mn(Array.from(Ve.get(r.type)).filter(A=>A===re||!ce.get(A).dropFromOthersDisabled),A=>ce.get(A).dropTargetStyle,A=>ce.get(A).dropTargetClasses),S.splice(m,1,at),xr=Jo(re),ct(re,S,{trigger:xe.DRAG_STARTED,id:Oe[ye],source:$e.POINTER}),window.addEventListener("mousemove",Rn,{passive:!1}),window.addEventListener("touchmove",Rn,{passive:!1,capture:!1}),window.addEventListener("mouseup",Ut,{passive:!1}),window.addEventListener("touchend",Ut,{passive:!1})}function g({items:m=void 0,flipDurationMs:y=0,type:C=qo,dragDisabled:v=!1,morphDisabled:k=!1,dropFromOthersDisabled:x=!1,dropTargetStyle:S=Ur,dropTargetClasses:R=[],transformDraggedElement:A=()=>{},centreDraggedOnCursor:j=!1,dropAnimationDisabled:Z=!1}){r.dropAnimationDurationMs=y,r.type&&C!==r.type&&zr(t,r.type),r.type=C,r.items=[...m],r.dragDisabled=v,r.morphDisabled=k,r.transformDraggedElement=A,r.centreDraggedOnCursor=j,r.dropAnimationDisabled=Z,n&&it&&!kr&&(!xo(S,r.dropTargetStyle)||!Io(R,r.dropTargetClasses))&&(xn([t],()=>r.dropTargetStyle,()=>R),mn([t],()=>S,()=>R)),r.dropTargetStyle=S,r.dropTargetClasses=[...R];function L(T,I){return ce.get(T)?ce.get(T)[I]:r[I]}n&&it&&r.dropFromOthersDisabled!==x&&(x?xn([t],T=>L(T,"dropTargetStyle"),T=>L(T,"dropTargetClasses")):mn([t],T=>L(T,"dropTargetStyle"),T=>L(T,"dropTargetClasses"))),r.dropFromOthersDisabled=x,ce.set(t,r),Wo(t,C);const B=it?Un(r.items):-1;for(let T=0;T<t.children.length;T++){const I=t.children[T];if(zo(I,v),T===B){k||jo(ve,I,Ne.x,Ne.y),r.transformDraggedElement(ve,Oe,T),Vo(I);continue}I.removeEventListener("mousedown",qn.get(I)),I.removeEventListener("touchstart",qn.get(I)),v||(I.addEventListener("mousedown",p),I.addEventListener("touchstart",p),qn.set(I,p)),i.set(I,T),n||(n=!0)}}return g(e),{update:m=>{g(m)},destroy:()=>{function m(){zr(t,ce.get(t).type),ce.delete(t)}it&&!t.closest(`[${jr}]`)?ea(t,m):m()}}}const nr={DND_ZONE_ACTIVE:"dnd-zone-active",DND_ZONE_DRAG_DISABLED:"dnd-zone-drag-disabled"},wi={[nr.DND_ZONE_ACTIVE]:"Tab to one the items and press space-bar or enter to start dragging it",[nr.DND_ZONE_DRAG_DISABLED]:"This is a disabled drag and drop list"},ra="dnd-action-aria-alert";let fe;function rr(){fe||(fe=document.createElement("div"),function(){fe.id=ra,fe.style.position="fixed",fe.style.bottom="0",fe.style.left="0",fe.style.zIndex="-5",fe.style.opacity="0",fe.style.height="0",fe.style.width="0",fe.setAttribute("role","alert")}(),document.body.prepend(fe),Object.entries(wi).forEach(([t,e])=>document.body.prepend(oa(t,e))))}function ia(){return Sr?null:(document.readyState==="complete"?rr():window.addEventListener("DOMContentLoaded",rr),{...nr})}function sa(){Sr||!fe||(Object.keys(wi).forEach(t=>{var e;return(e=document.getElementById(t))==null?void 0:e.remove()}),fe.remove(),fe=void 0)}function oa(t,e){const n=document.createElement("div");return n.id=t,n.innerHTML=`<p>${e}</p>`,n.style.display="none",n.style.position="fixed",n.style.zIndex="-5",n}function Pt(t){if(Sr)return;fe||rr(),fe.innerHTML="";const e=document.createTextNode(t);fe.appendChild(e),fe.style.display="none",fe.style.display="inline"}const aa="--any--",Vr={outline:"rgba(255, 255, 102, 0.7) solid 2px"};let Fe=!1,ir,Te,_t="",ht,Ze,ot="";const Dn=new WeakSet,Gr=new WeakMap,Jr=new WeakMap,sr=new Map,Ce=new Map,je=new Map;let wn;function ca(t,e){je.size===0&&(wn=ia(),window.addEventListener("keydown",Oi),window.addEventListener("click",Ai)),je.has(e)||je.set(e,new Set),je.get(e).has(t)||(je.get(e).add(t),yi())}function qr(t,e){Te===t&&en(),je.get(e).delete(t),bi(),je.get(e).size===0&&je.delete(e),je.size===0&&(window.removeEventListener("keydown",Oi),window.removeEventListener("click",Ai),wn=void 0,sa())}function Oi(t){if(Fe)switch(t.key){case"Escape":{en();break}}}function Ai(){Fe&&(Dn.has(document.activeElement)||en())}function la(t){if(!Fe)return;const e=t.currentTarget;if(e===Te)return;_t=e.getAttribute("aria-label")||"";const{items:n}=Ce.get(Te),r=n.find(p=>p[ye]===Ze),i=n.indexOf(r),s=n.splice(i,1)[0],{items:c,autoAriaDisabled:l}=Ce.get(e);e.getBoundingClientRect().top<Te.getBoundingClientRect().top||e.getBoundingClientRect().left<Te.getBoundingClientRect().left?(c.push(s),l||Pt(`Moved item ${ot} to the end of the list ${_t}`)):(c.unshift(s),l||Pt(`Moved item ${ot} to the beginning of the list ${_t}`)),Ft(Te,n,{trigger:xe.DROPPED_INTO_ANOTHER,id:Ze,source:$e.KEYBOARD}),Ft(e,c,{trigger:xe.DROPPED_INTO_ZONE,id:Ze,source:$e.KEYBOARD}),Te=e}function Pi(){sr.forEach(({update:t},e)=>t(Ce.get(e)))}function en(t=!0){Ce.get(Te).autoAriaDisabled||Pt(`Stopped dragging item ${ot}`),Dn.has(document.activeElement)&&document.activeElement.blur(),t&&ct(Te,Ce.get(Te).items,{trigger:xe.DRAG_STOPPED,id:Ze,source:$e.KEYBOARD}),xn(je.get(ir),e=>Ce.get(e).dropTargetStyle,e=>Ce.get(e).dropTargetClasses),ht=null,Ze=null,ot="",ir=null,Te=null,_t="",Fe=!1,Pi()}function fa(t,e){const n={items:void 0,type:void 0,dragDisabled:!1,zoneTabIndex:0,zoneItemTabIndex:0,dropFromOthersDisabled:!1,dropTargetStyle:Vr,dropTargetClasses:[],autoAriaDisabled:!1};function r(f,g,m){f.length<=1||f.splice(m,1,f.splice(g,1,f[m])[0])}function i(f){switch(f.key){case"Enter":case" ":{if((f.target.disabled!==void 0||f.target.href||f.target.isContentEditable)&&!Dn.has(f.target))return;f.preventDefault(),f.stopPropagation(),Fe?en():s(f);break}case"ArrowDown":case"ArrowRight":{if(!Fe)return;f.preventDefault(),f.stopPropagation();const{items:g}=Ce.get(t),m=Array.from(t.children),y=m.indexOf(f.currentTarget);y<m.length-1&&(n.autoAriaDisabled||Pt(`Moved item ${ot} to position ${y+2} in the list ${_t}`),r(g,y,y+1),Ft(t,g,{trigger:xe.DROPPED_INTO_ZONE,id:Ze,source:$e.KEYBOARD}));break}case"ArrowUp":case"ArrowLeft":{if(!Fe)return;f.preventDefault(),f.stopPropagation();const{items:g}=Ce.get(t),y=Array.from(t.children).indexOf(f.currentTarget);y>0&&(n.autoAriaDisabled||Pt(`Moved item ${ot} to position ${y} in the list ${_t}`),r(g,y,y-1),Ft(t,g,{trigger:xe.DROPPED_INTO_ZONE,id:Ze,source:$e.KEYBOARD}));break}}}function s(f){l(f.currentTarget),Te=t,ir=n.type,Fe=!0;const g=Array.from(je.get(n.type)).filter(m=>m===Te||!Ce.get(m).dropFromOthersDisabled);if(mn(g,m=>Ce.get(m).dropTargetStyle,m=>Ce.get(m).dropTargetClasses),!n.autoAriaDisabled){let m=`Started dragging item ${ot}. Use the arrow keys to move it within its list ${_t}`;g.length>1&&(m+=", or tab to another list in order to move the item into it"),Pt(m)}ct(t,Ce.get(t).items,{trigger:xe.DRAG_STARTED,id:Ze,source:$e.KEYBOARD}),Pi()}function c(f){Fe&&f.currentTarget!==ht&&(f.stopPropagation(),en(!1),s(f))}function l(f){const{items:g}=Ce.get(t),m=Array.from(t.children),y=m.indexOf(f);ht=f,ht.tabIndex=n.zoneItemTabIndex,Ze=g[y][ye],ot=m[y].getAttribute("aria-label")||""}function u({items:f=[],type:g=aa,dragDisabled:m=!1,zoneTabIndex:y=0,zoneItemTabIndex:C=0,dropFromOthersDisabled:v=!1,dropTargetStyle:k=Vr,dropTargetClasses:x=[],autoAriaDisabled:S=!1}){n.items=[...f],n.dragDisabled=m,n.dropFromOthersDisabled=v,n.zoneTabIndex=y,n.zoneItemTabIndex=C,n.dropTargetStyle=k,n.dropTargetClasses=x,n.autoAriaDisabled=S,n.type&&g!==n.type&&qr(t,n.type),n.type=g,ca(t,g),S||(t.setAttribute("aria-disabled",m),t.setAttribute("role","list"),t.setAttribute("aria-describedby",m?wn.DND_ZONE_DRAG_DISABLED:wn.DND_ZONE_ACTIVE)),Ce.set(t,n),Fe?t.tabIndex=t===Te||ht.contains(t)||n.dropFromOthersDisabled||Te&&n.type!==Ce.get(Te).type?-1:0:t.tabIndex=n.zoneTabIndex,t.addEventListener("focus",la);for(let R=0;R<t.children.length;R++){const A=t.children[R];Dn.add(A),A.tabIndex=Fe?-1:n.zoneItemTabIndex,S||A.setAttribute("role","listitem"),A.removeEventListener("keydown",Gr.get(A)),A.removeEventListener("click",Jr.get(A)),m||(A.addEventListener("keydown",i),Gr.set(A,i),A.addEventListener("click",c),Jr.set(A,c)),Fe&&n.items[R][ye]===Ze&&(ht=A,ht.tabIndex=n.zoneItemTabIndex,A.focus())}}u(e);const p={update:f=>{u(f)},destroy:()=>{qr(t,n.type),Ce.delete(t),sr.delete(t)}};return sr.set(t,p),p}function Ir(t,e){if(ua(t))return{update:()=>{},destroy:()=>{}};Hr(e);const n=na(t,e),r=fa(t,e);return{update:i=>{Hr(i),n.update(i),r.update(i)},destroy:()=>{n.destroy(),r.destroy()}}}function ua(t){return!!t.closest(`[${yo}="true"]`)}function Hr(t){const{items:e,flipDurationMs:n,type:r,dragDisabled:i,morphDisabled:s,dropFromOthersDisabled:c,zoneTabIndex:l,zoneItemTabIndex:u,dropTargetStyle:p,dropTargetClasses:f,transformDraggedElement:g,autoAriaDisabled:m,centreDraggedOnCursor:y,dropAnimationDisabled:C,...v}=t;if(Object.keys(v).length>0&&console.warn("dndzone will ignore unknown options",v),!e)throw new Error("no 'items' key provided to dndzone");const k=e.find(x=>!{}.hasOwnProperty.call(x,ye));if(k)throw new Error(`missing '${ye}' property for item ${pn(k)}`);if(f&&!Array.isArray(f))throw new Error(`dropTargetClasses should be an array but instead it is a ${typeof f}, ${pn(f)}`);if(l&&!Zr(l))throw new Error(`zoneTabIndex should be a number but instead it is a ${typeof l}, ${pn(l)}`);if(u&&!Zr(u))throw new Error(`zoneItemTabIndex should be a number but instead it is a ${typeof u}, ${pn(u)}`)}function Zr(t){return!isNaN(t)&&function(e){return(e|0)===e}(parseFloat(t))}function da(t){let e=t[0].name+"",n,r,i,s=t[0].cost+"",c;return{c(){n=Ae(e),r=K(),i=N("div"),c=Ae(s),U(i,"class","absolute left-1 top-1")},m(l,u){V(l,n,u),V(l,r,u),V(l,i,u),O(i,c)},p(l,u){u&1&&e!==(e=l[0].name+"")&&ze(n,e),u&1&&s!==(s=l[0].cost+"")&&ze(c,s)},d(l){l&&(z(n),z(r),z(i))}}}function pa(t){let e,n=t[0].name+"",r,i,s,c,l,u=t[0].rulesText+"",p,f,g,m,y=t[0].cost+"",C,v,k,x=t[0].speed+"",S,R,A=!Number.isNaN(t[0].offense),j,Z=!Number.isNaN(t[0].defense),L,B=A&&Wr(t),T=Z&&Yr(t);return{c(){e=N("div"),r=Ae(n),i=K(),s=N("div"),c=K(),l=N("div"),p=Ae(u),f=K(),g=N("div"),m=N("div"),C=Ae(y),v=K(),k=N("div"),S=Ae(x),R=K(),B&&B.c(),j=K(),T&&T.c(),L=Bt(),U(e,"class","absolute top-2"),U(s,"class","h-5"),U(l,"class","items-center p-2 text-xs"),U(g,"class","absolute left-1 top-1 flex flex-col")},m(I,D){V(I,e,D),O(e,r),V(I,i,D),V(I,s,D),V(I,c,D),V(I,l,D),O(l,p),V(I,f,D),V(I,g,D),O(g,m),O(m,C),O(g,v),O(g,k),O(k,S),V(I,R,D),B&&B.m(I,D),V(I,j,D),T&&T.m(I,D),V(I,L,D)},p(I,D){D&1&&n!==(n=I[0].name+"")&&ze(r,n),D&1&&u!==(u=I[0].rulesText+"")&&ze(p,u),D&1&&y!==(y=I[0].cost+"")&&ze(C,y),D&1&&x!==(x=I[0].speed+"")&&ze(S,x),D&1&&(A=!Number.isNaN(I[0].offense)),A?B?B.p(I,D):(B=Wr(I),B.c(),B.m(j.parentNode,j)):B&&(B.d(1),B=null),D&1&&(Z=!Number.isNaN(I[0].defense)),Z?T?T.p(I,D):(T=Yr(I),T.c(),T.m(L.parentNode,L)):T&&(T.d(1),T=null)},d(I){I&&(z(e),z(i),z(s),z(c),z(l),z(f),z(g),z(R),z(j),z(L)),B&&B.d(I),T&&T.d(I)}}}function Wr(t){let e,n=t[0].offense+"",r;return{c(){e=N("div"),r=Ae(n),U(e,"class","absolute bottom-1 left-1 flex flex-col")},m(i,s){V(i,e,s),O(e,r)},p(i,s){s&1&&n!==(n=i[0].offense+"")&&ze(r,n)},d(i){i&&z(e)}}}function Yr(t){let e,n=t[0].defense+"",r;return{c(){e=N("div"),r=Ae(n),U(e,"class","absolute bottom-1 right-1 flex flex-col")},m(i,s){V(i,e,s),O(e,r)},p(i,s){s&1&&n!==(n=i[0].defense+"")&&ze(r,n)},d(i){i&&z(e)}}}function ha(t){let e,n,r,i,s;function c(p,f){return p[1]?pa:da}let l=c(t),u=l(t);return{c(){e=N("div"),u.c(),n=K(),r=N("div"),U(r,"class","absolute h-[6rem] w-[8.5rem]"),U(e,"class",t[2])},m(p,f){V(p,e,f),u.m(e,null),O(e,n),O(e,r),i||(s=[Ge(r,"mouseover",t[3]),Ge(r,"mouseleave",t[4]),Ge(r,"drag",t[4])],i=!0)},p(p,[f]){l===(l=c(p))&&u?u.p(p,f):(u.d(1),u=l(p),u&&(u.c(),u.m(e,n))),f&4&&U(e,"class",p[2])},i:Pe,o:Pe,d(p){p&&z(e),u.d(),i=!1,Je(s)}}}const ma="pt-2 -mb-[6rem] -ml-[2.75rem] -mt-[6rem] z-20 min-w-[14rem] min-h-[18rem] object-cover",ga="!visible opacity-100 shadow shadow-red-500";function _a(t,e,n){let r,i,{card:s}=e,{extraClasses:c=""}=e,{disableHover:l=!1}=e,u=!1;const p="text-sm flex flex-col justify-center items-center h-[6rem] w-[8.5rem] rounded border border-black bg-white relative";function f(){n(1,u=!0)}function g(){n(1,u=!1)}return t.$$set=m=>{"card"in m&&n(0,s=m.card),"extraClasses"in m&&n(5,c=m.extraClasses),"disableHover"in m&&n(6,l=m.disableHover)},t.$$.update=()=>{t.$$.dirty&1&&n(8,r=s[on]),t.$$.dirty&354&&n(2,i=`${p} ${l||r||!u?"":ma} ${r?ga:""} ${c}`)},[s,u,i,f,g,c,l,p,r]}class jn extends Ct{constructor(e){super(),bt(this,e,_a,ha,yt,{card:0,extraClasses:5,disableHover:6,baseStyle:7})}get baseStyle(){return this.$$.ctx[7]}}function jt(t){t.innerHTML="",t.className="text-sm flex flex-col justify-center items-center h-[6rem] w-[8.5rem] rounded border border-black bg-white relative",t.style.margin="6rem 0 0 2.75rem"}function Kr(t,e,n){const r=t.slice();return r[6]=e[n],r[8]=n,r}function Qr(t,e){let n,r,i;return r=new jn({props:{card:e[6]}}),{key:t,first:null,c(){n=Bt(),ae(r.$$.fragment),this.first=n},m(s,c){V(s,n,c),te(r,s,c),i=!0},p(s,c){e=s;const l={};c&1&&(l.card=e[6]),r.$set(l)},i(s){i||(q(r.$$.fragment,s),i=!0)},o(s){H(r.$$.fragment,s),i=!1},d(s){s&&z(n),ne(r,s)}}}function ya(t){let e,n,r,i,s=[],c=new Map,l,u,p,f,g,m=Mt(t[0]);const y=C=>C[6].id;for(let C=0;C<m.length;C+=1){let v=Kr(t,m,C),k=y(v);c.set(k,s[C]=Qr(k,v))}return{c(){e=N("div"),n=Ae(t[1]),r=K(),i=N("div");for(let C=0;C<s.length;C+=1)s[C].c();U(i,"class",l="grid "+(t[4],"min-h-[6rem]")+" min-w-[8.5rem] gap-x-1"),Wn(i,"grid-template-columns","repeat("+t[2]+", 8.5rem)")},m(C,v){V(C,e,v),O(e,n),O(e,r),O(e,i);for(let k=0;k<s.length;k+=1)s[k]&&s[k].m(i,null);p=!0,f||(g=[_r(u=Ir.call(null,i,{items:t[0],type:t[3],transformDraggedElement:jt,dropAnimationDisabled:!0})),Ge(i,"consider",t[5]),Ge(i,"finalize",t[5])],f=!0)},p(C,[v]){(!p||v&2)&&ze(n,C[1]),v&1&&(m=Mt(C[0]),Nt(),s=br(s,v,y,1,C,m,c,i,yr,Qr,null,Kr),Lt()),(!p||v&16&&l!==(l="grid "+(C[4],"min-h-[6rem]")+" min-w-[8.5rem] gap-x-1"))&&U(i,"class",l),(!p||v&4)&&Wn(i,"grid-template-columns","repeat("+C[2]+", 8.5rem)"),u&&Vt(u.update)&&v&9&&u.update.call(null,{items:C[0],type:C[3],transformDraggedElement:jt,dropAnimationDisabled:!0})},i(C){if(!p){for(let v=0;v<m.length;v+=1)q(s[v]);p=!0}},o(C){for(let v=0;v<s.length;v+=1)H(s[v]);p=!1},d(C){C&&z(e);for(let v=0;v<s.length;v+=1)s[v].d();f=!1,Je(g)}}}function ba(t,e,n){let{area:r}=e,{name:i}=e,{col:s=6}=e,{dragType:c}=e,{isDream:l=!1}=e;function u(p){n(0,r=p.detail.items)}return t.$$set=p=>{"area"in p&&n(0,r=p.area),"name"in p&&n(1,i=p.name),"col"in p&&n(2,s=p.col),"dragType"in p&&n(3,c=p.dragType),"isDream"in p&&n(4,l=p.isDream)},[r,i,s,c,l,u]}class On extends Ct{constructor(e){super(),bt(this,e,ba,ya,yt,{area:0,name:1,col:2,dragType:3,isDream:4})}}function Xr(t,e,n){const r=t.slice();return r[7]=e[n],r[9]=n,r}function ei(t,e){let n,r,i;return r=new jn({props:{card:e[7]}}),{key:t,first:null,c(){n=Bt(),ae(r.$$.fragment),this.first=n},m(s,c){V(s,n,c),te(r,s,c),i=!0},p(s,c){e=s;const l={};c&1&&(l.card=e[7]),r.$set(l)},i(s){i||(q(r.$$.fragment,s),i=!0)},o(s){H(r.$$.fragment,s),i=!1},d(s){s&&z(n),ne(r,s)}}}function Ca(t){let e,n,r,i=[],s=new Map,c,l,u,p,f=Mt(t[0]);const g=m=>m[7].id;for(let m=0;m<f.length;m+=1){let y=Xr(t,f,m),C=g(y);s.set(C,i[m]=ei(C,y))}return{c(){e=N("div"),n=Ae(`Reality\r
    `),r=N("div");for(let m=0;m<i.length;m+=1)i[m].c();Wn(r,"grid-template-columns","repeat(6, 8.5rem)"),U(r,"class","grid max-h-[13.25rem] min-h-[12rem] min-w-[51rem] gap-x-1")},m(m,y){V(m,e,y),O(e,n),O(e,r);for(let C=0;C<i.length;C+=1)i[C]&&i[C].m(r,null);l=!0,u||(p=[_r(c=Ir.call(null,r,{items:t[0],dropFromOthersDisabled:t[2],type:t[1],flipDurationMs:200,transformDraggedElement:jt,dropAnimationDisabled:!0})),Ge(r,"consider",t[3]),Ge(r,"finalize",t[3])],u=!0)},p(m,[y]){y&1&&(f=Mt(m[0]),Nt(),i=br(i,y,g,1,m,f,s,r,yr,ei,null,Xr),Lt()),c&&Vt(c.update)&&y&7&&c.update.call(null,{items:m[0],dropFromOthersDisabled:m[2],type:m[1],flipDurationMs:200,transformDraggedElement:jt,dropAnimationDisabled:!0})},i(m){if(!l){for(let y=0;y<f.length;y+=1)q(i[y]);l=!0}},o(m){for(let y=0;y<i.length;y+=1)H(i[y]);l=!1},d(m){m&&z(e);for(let y=0;y<i.length;y+=1)i[y].d();u=!1,Je(p)}}}function Ea(t,e,n){let r,{area:i}=e,{dragType:s}=e;const c={Unit:0,Item:1,Claim:2};function l(f){return c[f.type]===void 0?100:c[f.type]}function u(f,g){return l(f)-l(g)}function p(f){n(0,i=f.detail.items.sort(u))}return t.$$set=f=>{"area"in f&&n(0,i=f.area),"dragType"in f&&n(1,s=f.dragType)},t.$$.update=()=>{t.$$.dirty&1&&n(2,r=i.length>=oo)},[i,s,r,p]}class $i extends Ct{constructor(e){super(),bt(this,e,Ea,Ca,yt,{area:0,dragType:1})}}function ti(t,e,n){const r=t.slice();return r[4]=e[n],r[6]=n,r}function ni(t){let e,n,r;return n=new jn({props:{card:t[0][t[0].length-2],extraClasses:"-mr-[8rem] -z-10 relative pointer-events-none"}}),{c(){e=N("div"),ae(n.$$.fragment)},m(i,s){V(i,e,s),te(n,e,null),r=!0},p(i,s){const c={};s&1&&(c.card=i[0][i[0].length-2]),n.$set(c)},i(i){r||(q(n.$$.fragment,i),r=!0)},o(i){H(n.$$.fragment,i),r=!1},d(i){i&&z(e),ne(n)}}}function va(t){let e;return{c(){e=N("div")},m(n,r){V(n,e,r)},p:Pe,i:Pe,o:Pe,d(n){n&&z(e)}}}function Sa(t){let e,n;return e=new jn({props:{card:t[4]}}),{c(){ae(e.$$.fragment)},m(r,i){te(e,r,i),n=!0},p(r,i){const s={};i&1&&(s.card=r[4]),e.$set(s)},i(r){n||(q(e.$$.fragment,r),n=!0)},o(r){H(e.$$.fragment,r),n=!1},d(r){ne(e,r)}}}function ri(t,e){let n,r,i,s,c;const l=[Sa,va],u=[];function p(f,g){return f[6]===f[0].length-1?0:1}return r=p(e),i=u[r]=l[r](e),{key:t,first:null,c(){n=Bt(),i.c(),s=Bt(),this.first=n},m(f,g){V(f,n,g),u[r].m(f,g),V(f,s,g),c=!0},p(f,g){e=f;let m=r;r=p(e),r===m?u[r].p(e,g):(Nt(),H(u[m],1,1,()=>{u[m]=null}),Lt(),i=u[r],i?i.p(e,g):(i=u[r]=l[r](e),i.c()),q(i,1),i.m(s.parentNode,s))},i(f){c||(q(i),c=!0)},o(f){H(i),c=!1},d(f){f&&(z(n),z(s)),u[r].d(f)}}}function Ta(t){let e,n,r,i,s,c,l=[],u=new Map,p,f,g,m,y=t[0].length>1&&ni(t),C=Mt(t[0]);const v=k=>k[4].id;for(let k=0;k<C.length;k+=1){let x=ti(t,C,k),S=v(x);u.set(S,l[k]=ri(S,x))}return{c(){e=N("div"),n=Ae(t[1]),r=K(),i=N("div"),y&&y.c(),s=K(),c=N("div");for(let k=0;k<l.length;k+=1)l[k].c();U(c,"class","flex h-[6rem] w-[8.5rem]"),U(i,"class","flex w-[9rem] rounded shadow-inner")},m(k,x){V(k,e,x),O(e,n),O(e,r),O(e,i),y&&y.m(i,null),O(i,s),O(i,c);for(let S=0;S<l.length;S+=1)l[S]&&l[S].m(c,null);f=!0,g||(m=[_r(p=Ir.call(null,c,{items:t[0],type:t[2],transformDraggedElement:jt,dropAnimationDisabled:!0})),Ge(c,"consider",t[3]),Ge(c,"finalize",t[3])],g=!0)},p(k,[x]){(!f||x&2)&&ze(n,k[1]),k[0].length>1?y?(y.p(k,x),x&1&&q(y,1)):(y=ni(k),y.c(),q(y,1),y.m(i,s)):y&&(Nt(),H(y,1,1,()=>{y=null}),Lt()),x&1&&(C=Mt(k[0]),Nt(),l=br(l,x,v,1,k,C,u,c,yr,ri,null,ti),Lt()),p&&Vt(p.update)&&x&5&&p.update.call(null,{items:k[0],type:k[2],transformDraggedElement:jt,dropAnimationDisabled:!0})},i(k){if(!f){q(y);for(let x=0;x<C.length;x+=1)q(l[x]);f=!0}},o(k){H(y);for(let x=0;x<l.length;x+=1)H(l[x]);f=!1},d(k){k&&z(e),y&&y.d();for(let x=0;x<l.length;x+=1)l[x].d();g=!1,Je(m)}}}function ka(t,e){for(let n=0;n<e.length-1;++n){let r=e[n];if(t.findIndex(s=>s.id===r.id)===-1){let s=e[e.length-1];return e[e.length-1]=r,e[n]=s,e}}return e}function xa(t,e,n){let{deck:r}=e,{name:i}=e,{dragType:s}=e;function c(l){n(0,r=ka(r,l.detail.items))}return t.$$set=l=>{"deck"in l&&n(0,r=l.deck),"name"in l&&n(1,i=l.name),"dragType"in l&&n(2,s=l.dragType)},[r,i,s,c]}class We extends Ct{constructor(e){super(),bt(this,e,xa,Ta,yt,{deck:0,name:1,dragType:2})}}function Ia(t){let e,n,r,i,s,c,l,u,p,f,g,m,y,C,v,k,x,S,R,A,j,Z,L,B,T,I,D,le,P,J,Se,Qe,W,be,he;function Re($){t[1]($)}let Ue={name:"Combat",dragType:"player"};t[0].combatArea!==void 0&&(Ue.area=t[0].combatArea),i=new On({props:Ue}),ue.push(()=>ge(i,"area",Re));function Xe($){t[2]($)}let Tt={name:"Memory",dragType:"player"};t[0].memDiscard!==void 0&&(Tt.deck=t[0].memDiscard),u=new We({props:Tt}),ue.push(()=>ge(u,"deck",Xe));function ee($){t[3]($)}let de={dragType:"player"};t[0].reality!==void 0&&(de.area=t[0].reality),C=new $i({props:de}),ue.push(()=>ge(C,"area",ee));function lt($){t[4]($)}let ft={name:"Hand",dragType:"player"};t[0].hand!==void 0&&(ft.area=t[0].hand),S=new On({props:ft}),ue.push(()=>ge(S,"area",lt));function ut($){t[5]($)}let M={name:"Channeled",dragType:"player"};t[0].channeled!==void 0&&(M.deck=t[0].channeled),L=new We({props:M}),ue.push(()=>ge(L,"deck",ut));function De($){t[6]($)}let Le={name:"Void",dragType:"player"};t[0].voidPile!==void 0&&(Le.deck=t[0].voidPile),I=new We({props:Le}),ue.push(()=>ge(I,"deck",De));function et($){t[7]($)}let tt={name:"Random",dragType:"player"};t[0].randomZone!==void 0&&(tt.deck=t[0].randomZone),J=new We({props:tt}),ue.push(()=>ge(J,"deck",et));function kt($){t[8]($)}let nt={name:"Deck",dragType:"player"};return t[0].deck!==void 0&&(nt.deck=t[0].deck),W=new We({props:nt}),ue.push(()=>ge(W,"deck",kt)),{c(){e=N("div"),n=N("div"),r=N("div"),ae(i.$$.fragment),c=K(),l=N("div"),ae(u.$$.fragment),f=K(),g=N("div"),m=N("div"),y=N("div"),ae(C.$$.fragment),k=K(),x=N("div"),ae(S.$$.fragment),A=K(),j=N("div"),Z=N("div"),ae(L.$$.fragment),T=K(),ae(I.$$.fragment),le=K(),P=N("div"),ae(J.$$.fragment),Qe=K(),ae(W.$$.fragment),U(r,"class","min-w-2/3 rounded border border-black p-1"),U(l,"class","min-w-1/3 rounded border border-black p-1"),U(n,"class","flex flex-row gap-1"),U(y,"class","rounded border border-black p-1"),U(x,"class","rounded border border-black p-1"),U(m,"class","flex flex-col"),U(Z,"class","flex flex-row gap-1"),U(P,"class","flex flex-row gap-1"),U(j,"class","flex h-fit flex-col gap-1 rounded border border-black p-1"),U(g,"class","flex flex-row gap-1"),U(e,"class","flex flex-col gap-1")},m($,pe){V($,e,pe),O(e,n),O(n,r),te(i,r,null),O(n,c),O(n,l),te(u,l,null),O(e,f),O(e,g),O(g,m),O(m,y),te(C,y,null),O(m,k),O(m,x),te(S,x,null),O(g,A),O(g,j),O(j,Z),te(L,Z,null),O(Z,T),te(I,Z,null),O(j,le),O(j,P),te(J,P,null),O(P,Qe),te(W,P,null),he=!0},p($,[pe]){const cn={};!s&&pe&1&&(s=!0,cn.area=$[0].combatArea,me(()=>s=!1)),i.$set(cn);const ln={};!p&&pe&1&&(p=!0,ln.deck=$[0].memDiscard,me(()=>p=!1)),u.$set(ln);const xt={};!v&&pe&1&&(v=!0,xt.area=$[0].reality,me(()=>v=!1)),C.$set(xt);const fn={};!R&&pe&1&&(R=!0,fn.area=$[0].hand,me(()=>R=!1)),S.$set(fn);const un={};!B&&pe&1&&(B=!0,un.deck=$[0].channeled,me(()=>B=!1)),L.$set(un);const Gt={};!D&&pe&1&&(D=!0,Gt.deck=$[0].voidPile,me(()=>D=!1)),I.$set(Gt);const dt={};!Se&&pe&1&&(Se=!0,dt.deck=$[0].randomZone,me(()=>Se=!1)),J.$set(dt);const Be={};!be&&pe&1&&(be=!0,Be.deck=$[0].deck,me(()=>be=!1)),W.$set(Be)},i($){he||(q(i.$$.fragment,$),q(u.$$.fragment,$),q(C.$$.fragment,$),q(S.$$.fragment,$),q(L.$$.fragment,$),q(I.$$.fragment,$),q(J.$$.fragment,$),q(W.$$.fragment,$),he=!0)},o($){H(i.$$.fragment,$),H(u.$$.fragment,$),H(C.$$.fragment,$),H(S.$$.fragment,$),H(L.$$.fragment,$),H(I.$$.fragment,$),H(J.$$.fragment,$),H(W.$$.fragment,$),he=!1},d($){$&&z(e),ne(i),ne(u),ne(C),ne(S),ne(L),ne(I),ne(J),ne(W)}}}function Ra(t,e,n){let{playArea:r}=e;function i(m){t.$$.not_equal(r.combatArea,m)&&(r.combatArea=m,n(0,r))}function s(m){t.$$.not_equal(r.memDiscard,m)&&(r.memDiscard=m,n(0,r))}function c(m){t.$$.not_equal(r.reality,m)&&(r.reality=m,n(0,r))}function l(m){t.$$.not_equal(r.hand,m)&&(r.hand=m,n(0,r))}function u(m){t.$$.not_equal(r.channeled,m)&&(r.channeled=m,n(0,r))}function p(m){t.$$.not_equal(r.voidPile,m)&&(r.voidPile=m,n(0,r))}function f(m){t.$$.not_equal(r.randomZone,m)&&(r.randomZone=m,n(0,r))}function g(m){t.$$.not_equal(r.deck,m)&&(r.deck=m,n(0,r))}return t.$$set=m=>{"playArea"in m&&n(0,r=m.playArea)},[r,i,s,c,l,u,p,f,g]}class Da extends Ct{constructor(e){super(),bt(this,e,Ra,Ia,yt,{playArea:0})}}function wa(t){let e,n,r,i,s,c,l,u,p,f,g,m,y,C,v,k,x,S,R,A,j,Z,L,B,T,I,D,le,P,J;function Se(M){t[1](M)}let Qe={dragType:"opponent"};t[0].reality!==void 0&&(Qe.area=t[0].reality),i=new $i({props:Qe}),ue.push(()=>ge(i,"area",Se));function W(M){t[2](M)}let be={name:"Combat",dragType:"opponent"};t[0].combatArea!==void 0&&(be.area=t[0].combatArea),p=new On({props:be}),ue.push(()=>ge(p,"area",W));function he(M){t[3](M)}let Re={name:"Memory",dragType:"opponent"};t[0].memDiscard!==void 0&&(Re.deck=t[0].memDiscard),y=new We({props:Re}),ue.push(()=>ge(y,"deck",he));function Ue(M){t[4](M)}let Xe={name:"Channeled",dragType:"opponent"};t[0].channeled!==void 0&&(Xe.deck=t[0].channeled),S=new We({props:Xe}),ue.push(()=>ge(S,"deck",Ue));function Tt(M){t[5](M)}let ee={name:"Void",dragType:"opponent"};t[0].voidPile!==void 0&&(ee.deck=t[0].voidPile),j=new We({props:ee}),ue.push(()=>ge(j,"deck",Tt));function de(M){t[6](M)}let lt={name:"Random",dragType:"opponent"};t[0].randomZone!==void 0&&(lt.deck=t[0].randomZone),T=new We({props:lt}),ue.push(()=>ge(T,"deck",de));function ft(M){t[7](M)}let ut={name:"Deck",dragType:"opponent"};return t[0].deck!==void 0&&(ut.deck=t[0].deck),le=new We({props:ut}),ue.push(()=>ge(le,"deck",ft)),{c(){e=N("div"),n=N("div"),r=N("div"),ae(i.$$.fragment),c=K(),l=N("div"),u=N("div"),ae(p.$$.fragment),g=K(),m=N("div"),ae(y.$$.fragment),v=K(),k=N("div"),x=N("div"),ae(S.$$.fragment),A=K(),ae(j.$$.fragment),L=K(),B=N("div"),ae(T.$$.fragment),D=K(),ae(le.$$.fragment),U(r,"class","max-w-fit rounded border border-black p-1"),U(u,"class","h-fit rounded border border-black p-1"),U(m,"class","h-fit rounded border border-black p-1"),U(l,"class","flex min-w-fit flex-row"),U(n,"class","flex flex-col"),U(x,"class","flex flex-row gap-1"),U(B,"class","flex flex-row gap-1"),U(k,"class","h-fit rounded border border-black p-1"),U(e,"class","flex flex-row gap-1")},m(M,De){V(M,e,De),O(e,n),O(n,r),te(i,r,null),O(n,c),O(n,l),O(l,u),te(p,u,null),O(l,g),O(l,m),te(y,m,null),O(e,v),O(e,k),O(k,x),te(S,x,null),O(x,A),te(j,x,null),O(k,L),O(k,B),te(T,B,null),O(B,D),te(le,B,null),J=!0},p(M,[De]){const Le={};!s&&De&1&&(s=!0,Le.area=M[0].reality,me(()=>s=!1)),i.$set(Le);const et={};!f&&De&1&&(f=!0,et.area=M[0].combatArea,me(()=>f=!1)),p.$set(et);const tt={};!C&&De&1&&(C=!0,tt.deck=M[0].memDiscard,me(()=>C=!1)),y.$set(tt);const kt={};!R&&De&1&&(R=!0,kt.deck=M[0].channeled,me(()=>R=!1)),S.$set(kt);const nt={};!Z&&De&1&&(Z=!0,nt.deck=M[0].voidPile,me(()=>Z=!1)),j.$set(nt);const $={};!I&&De&1&&(I=!0,$.deck=M[0].randomZone,me(()=>I=!1)),T.$set($);const pe={};!P&&De&1&&(P=!0,pe.deck=M[0].deck,me(()=>P=!1)),le.$set(pe)},i(M){J||(q(i.$$.fragment,M),q(p.$$.fragment,M),q(y.$$.fragment,M),q(S.$$.fragment,M),q(j.$$.fragment,M),q(T.$$.fragment,M),q(le.$$.fragment,M),J=!0)},o(M){H(i.$$.fragment,M),H(p.$$.fragment,M),H(y.$$.fragment,M),H(S.$$.fragment,M),H(j.$$.fragment,M),H(T.$$.fragment,M),H(le.$$.fragment,M),J=!1},d(M){M&&z(e),ne(i),ne(p),ne(y),ne(S),ne(j),ne(T),ne(le)}}}function Oa(t,e,n){let{playArea:r}=e;function i(g){t.$$.not_equal(r.reality,g)&&(r.reality=g,n(0,r))}function s(g){t.$$.not_equal(r.combatArea,g)&&(r.combatArea=g,n(0,r))}function c(g){t.$$.not_equal(r.memDiscard,g)&&(r.memDiscard=g,n(0,r))}function l(g){t.$$.not_equal(r.channeled,g)&&(r.channeled=g,n(0,r))}function u(g){t.$$.not_equal(r.voidPile,g)&&(r.voidPile=g,n(0,r))}function p(g){t.$$.not_equal(r.randomZone,g)&&(r.randomZone=g,n(0,r))}function f(g){t.$$.not_equal(r.deck,g)&&(r.deck=g,n(0,r))}return t.$$set=g=>{"playArea"in g&&n(0,r=g.playArea)},[r,i,s,c,l,u,p,f]}class Aa extends Ct{constructor(e){super(),bt(this,e,Oa,wa,yt,{playArea:0})}}class Pa{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const n of this._parts)e.push(n);return $a(e).buffer}}function $a(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t){const s=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);n.set(s,r),r+=i.byteLength}return n}function Bi(t){return new Ba(t).unpack()}function Ni(t){const e=new Na,n=e.pack(t);return n instanceof Promise?n.then(()=>e.getBuffer()):e.getBuffer()}class Ba{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let n;if((n=e^160)<=15)return this.unpack_raw(n);if((n=e^176)<=15)return this.unpack_string(n);if((n=e^144)<=15)return this.unpack_array(n);if((n=e^128)<=15)return this.unpack_map(n);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return n=this.unpack_uint16(),this.unpack_string(n);case 217:return n=this.unpack_uint32(),this.unpack_string(n);case 218:return n=this.unpack_uint16(),this.unpack_raw(n);case 219:return n=this.unpack_uint32(),this.unpack_raw(n);case 220:return n=this.unpack_uint16(),this.unpack_array(n);case 221:return n=this.unpack_uint32(),this.unpack_array(n);case 222:return n=this.unpack_uint16(),this.unpack_map(n);case 223:return n=this.unpack_uint32(),this.unpack_map(n)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),n=(e[0]&255)*256+(e[1]&255);return this.index+=2,n}unpack_uint32(){const e=this.read(4),n=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,n}unpack_uint64(){const e=this.read(8),n=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,n}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const n=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,n}unpack_string(e){const n=this.read(e);let r=0,i="",s,c;for(;r<e;)s=n[r],s<160?(c=s,r++):(s^192)<32?(c=(s&31)<<6|n[r+1]&63,r+=2):(s^224)<16?(c=(s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63,r+=3):(c=(s&7)<<18|(n[r+1]&63)<<12|(n[r+2]&63)<<6|n[r+3]&63,r+=4),i+=String.fromCodePoint(c);return this.index+=e,i}unpack_array(e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=this.unpack();return n}unpack_map(e){const n={};for(let r=0;r<e;r++){const i=this.unpack();n[i]=this.unpack()}return n}unpack_float(){const e=this.unpack_uint32(),n=e>>31,r=(e>>23&255)-127,i=e&8388607|8388608;return(n===0?1:-1)*i*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),n=this.unpack_uint32(),r=e>>31,i=(e>>20&2047)-1023,c=(e&1048575|1048576)*2**(i-20)+n*2**(i-52);return(r===0?1:-1)*c}read(e){const n=this.index;if(n+e<=this.length)return this.dataView.subarray(n,n+e);throw new Error("BinaryPackFailure: read index out of range")}}class Na{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const n=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(n==Object||n.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${n.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const n=e.length;if(n<=15)this.pack_uint8(160+n);else if(n<=65535)this._bufferBuilder.append(218),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(n);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const n=this._textEncoder.encode(e),r=n.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(n)}pack_array(e){const n=e.length;if(n<=15)this.pack_uint8(144+n);else if(n<=65535)this._bufferBuilder.append(220),this.pack_uint16(n);else if(n<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(n);else throw new Error("Invalid length");const r=i=>{if(i<n){const s=this.pack(e[i]);return s instanceof Promise?s.then(()=>r(i+1)):r(i+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let n=0;e<0&&(n=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),i=e/2**r-1,s=Math.floor(i*2**52),c=2**32,l=n<<31|r+1023<<20|s/c&1048575,u=s%c;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(u)}pack_object(e){const n=Object.keys(e),r=n.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const i=s=>{if(s<n.length){const c=n[s];if(e.hasOwnProperty(c)){this.pack(c);const l=this.pack(e[c]);if(l instanceof Promise)return l.then(()=>i(s+1))}return i(s+1)}};return i(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const n=e&4294967295;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255)}pack_uint64(e){const n=e/4294967296,r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const n=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((n&4278190080)>>>24),this._bufferBuilder.append((n&16711680)>>>16),this._bufferBuilder.append((n&65280)>>>8),this._bufferBuilder.append(n&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new Pa,this._textEncoder=new TextEncoder}}let Li=!0,Mi=!0;function _n(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function Et(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(c,l){if(c!==e)return i.apply(this,arguments);const u=p=>{const f=n(p);f&&(l.handleEvent?l.handleEvent(f):l(f))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,u),i.apply(this,[c,u])};const s=r.removeEventListener;r.removeEventListener=function(c,l){if(c!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(l))return s.apply(this,arguments);const u=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[c,u])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(c){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),c&&this.addEventListener(e,this["_on"+e]=c)},enumerable:!0,configurable:!0})}function La(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Li=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ma(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Mi=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Fi(){if(typeof window=="object"){if(Li)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Rr(t,e){Mi&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Fa(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=_n(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=_n(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=_n(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function ii(t){return Object.prototype.toString.call(t)==="[object Object]"}function Ui(t){return ii(t)?Object.keys(t).reduce(function(e,n){const r=ii(t[n]),i=r?Ui(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function or(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?or(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{or(t,t.get(i),n)})}))}function si(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(c=>{c.type==="track"&&c.trackIdentifier===e.id&&s.push(c)}),s.forEach(c=>{t.forEach(l=>{l.type===r&&l.trackId===c.id&&or(t,l,i)})}),i}const oi=Fi;function ji(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const u={};return Object.keys(l).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;const f=typeof l[p]=="object"?l[p]:{ideal:l[p]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);const g=function(m,y){return m?m+y.charAt(0).toUpperCase()+y.slice(1):y==="deviceId"?"sourceId":y};if(f.ideal!==void 0){u.optional=u.optional||[];let m={};typeof f.ideal=="number"?(m[g("min",p)]=f.ideal,u.optional.push(m),m={},m[g("max",p)]=f.ideal,u.optional.push(m)):(m[g("",p)]=f.ideal,u.optional.push(m))}f.exact!==void 0&&typeof f.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[g("",p)]=f.exact):["min","max"].forEach(m=>{f[m]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[g(m,p)]=f[m])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},i=function(l,u){if(e.version>=61)return u(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const p=function(f,g,m){g in f&&!(m in f)&&(f[m]=f[g],delete f[g])};l=JSON.parse(JSON.stringify(l)),p(l.audio,"autoGainControl","googAutoGainControl"),p(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let p=l.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});const f=e.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!f)){delete l.video.facingMode;let g;if(p.exact==="environment"||p.ideal==="environment"?g=["back","rear"]:(p.exact==="user"||p.ideal==="user")&&(g=["front"]),g)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(C=>C.kind==="videoinput");let y=m.find(C=>g.some(v=>C.label.toLowerCase().includes(v)));return!y&&m.length&&g.includes("back")&&(y=m[m.length-1]),y&&(l.video.deviceId=p.exact?{exact:y.deviceId}:{ideal:y.deviceId}),l.video=r(l.video),oi("chrome: "+JSON.stringify(l)),u(l)})}l.video=r(l.video)}return oi("chrome: "+JSON.stringify(l)),u(l)},s=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},c=function(l,u,p){i(l,f=>{n.webkitGetUserMedia(f,u,g=>{p&&p(s(g))})})};if(n.getUserMedia=c.bind(n),n.mediaDevices.getUserMedia){const l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return i(u,p=>l(p).then(f=>{if(p.audio&&!f.getAudioTracks().length||p.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(g=>{g.stop()}),new DOMException("","NotFoundError");return f},f=>Promise.reject(s(f))))}}}function zi(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function Vi(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===i.track.id):s={track:i.track};const c=new Event("track");c.track=i.track,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(l=>l.track&&l.track.id===i.id):s={track:i};const c=new Event("track");c.track=i,c.receiver=s,c.transceiver={receiver:s},c.streams=[r.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Et(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Gi(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(l,u){let p=i.apply(this,arguments);return p||(p=e(this,l),this._senders.push(p)),p};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(l){s.apply(this,arguments);const u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(c=>{this._senders.push(e(this,c))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(c=>{const l=this._senders.find(u=>u.track===c);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Ji(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(c=>c._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>si(c,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Et(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>si(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,c;return this.getSenders().forEach(l=>{l.track===r&&(i?c=!0:i=l)}),this.getReceivers().forEach(l=>(l.track===r&&(s?c=!0:s=l),l.track===r)),c||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function qi(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(p=>{if(this.getSenders().find(g=>g.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(p=>l.indexOf(p)===-1);this._shimmedLocalStreams[c.id]=[c].concat(u)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const u=this._shimmedLocalStreams[l].indexOf(c);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function Hi(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return qi(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const f=n.apply(this);return this._reverseStreams=this._reverseStreams||{},f.map(g=>this._reverseStreams[g.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(f){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.getTracks().forEach(g=>{if(this.getSenders().find(y=>y.track===g))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[f.id]){const g=new t.MediaStream(f.getTracks());this._streams[f.id]=g,this._reverseStreams[g.id]=f,f=g}r.apply(this,[f])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(f){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[f.id]||f]),delete this._reverseStreams[this._streams[f.id]?this._streams[f.id].id:f.id],delete this._streams[f.id]},t.RTCPeerConnection.prototype.addTrack=function(f,g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===f))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===f))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const C=this._streams[g.id];if(C)C.addTrack(f),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([f]);this._streams[g.id]=v,this._reverseStreams[v.id]=g,this.addStream(v)}return this.getSenders().find(v=>v.track===f)};function s(p,f){let g=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(m=>{const y=p._reverseStreams[m],C=p._streams[y.id];g=g.replace(new RegExp(C.id,"g"),y.id)}),new RTCSessionDescription({type:f.type,sdp:g})}function c(p,f){let g=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(m=>{const y=p._reverseStreams[m],C=p._streams[y.id];g=g.replace(new RegExp(y.id,"g"),C.id)}),new RTCSessionDescription({type:f.type,sdp:g})}["createOffer","createAnswer"].forEach(function(p){const f=t.RTCPeerConnection.prototype[p],g={[p](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[C=>{const v=s(this,C);m[0].apply(null,[v])},C=>{m[1]&&m[1].apply(null,C)},arguments[2]]):f.apply(this,arguments).then(C=>s(this,C))}};t.RTCPeerConnection.prototype[p]=g[p]});const l=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=c(this,arguments[0]),l.apply(this,arguments))};const u=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const p=u.get.apply(this);return p.type===""?p:s(this,p)}}),t.RTCPeerConnection.prototype.removeTrack=function(f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!f._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(f._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(y=>{this._streams[y].getTracks().find(v=>f.track===v)&&(m=this._streams[y])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(f.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ar(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function Zi(t,e){Et(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}const ai=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Zi,shimAddTrackRemoveTrack:Hi,shimAddTrackRemoveTrackWithNative:qi,shimGetSendersWithDtmf:Gi,shimGetUserMedia:ji,shimMediaStream:zi,shimOnTrack:Vi,shimPeerConnection:ar,shimSenderReceiverGetStats:Ji},Symbol.toStringTag,{value:"Module"}));function Wi(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,c){Rr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,c)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(c,l,u){l in c&&!(u in c)&&(c[u]=c[l],delete c[l])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c.audio,"autoGainControl","mozAutoGainControl"),i(c.audio,"noiseSuppression","mozNoiseSuppression")),s(c)},r&&r.prototype.getSettings){const c=r.prototype.getSettings;r.prototype.getSettings=function(){const l=c.apply(this,arguments);return i(l,"mozAutoGainControl","autoGainControl"),i(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const c=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l,"autoGainControl","mozAutoGainControl"),i(l,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[l])}}}}function Ua(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function Yi(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function cr(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=c[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,c,l]=arguments;return r.apply(this,[s||null]).then(u=>{if(e.version<53&&!c)try{u.forEach(p=>{p.type=n[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;u.forEach((f,g)=>{u.set(g,Object.assign({},f,{type:n[f.type]||f.type}))})}return u}).then(c,l)}}function Ki(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Qi(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Et(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Xi(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Rr("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function es(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function ts(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:c}=s,l=c.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,c.sendEncodings=r,this.setParametersPromises.push(c.setParameters(l).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return s})}function ns(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function rs(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function is(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const ci=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:ts,shimCreateAnswer:is,shimCreateOffer:rs,shimGetDisplayMedia:Ua,shimGetParameters:ns,shimGetUserMedia:Wi,shimOnTrack:Yi,shimPeerConnection:cr,shimRTCDataChannel:es,shimReceiverGetStats:Qi,shimRemoveStream:Xi,shimSenderGetStats:Ki},Symbol.toStringTag,{value:"Module"}));function ss(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r,...i){return i&&i.forEach(s=>{this._localStreams?this._localStreams.includes(s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function os(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,r.dispatchEvent(c)})}),e.apply(r,arguments)}}}function as(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,c=e.addIceCandidate;e.createOffer=function(p,f){const g=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[g]);return f?(m.then(p,f),Promise.resolve()):m},e.createAnswer=function(p,f){const g=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[g]);return f?(m.then(p,f),Promise.resolve()):m};let l=function(u,p,f){const g=i.apply(this,[u]);return f?(g.then(p,f),Promise.resolve()):g};e.setLocalDescription=l,l=function(u,p,f){const g=s.apply(this,[u]);return f?(g.then(p,f),Promise.resolve()):g},e.setRemoteDescription=l,l=function(u,p,f){const g=c.apply(this,[u]);return f?(g.then(p,f),Promise.resolve()):g},e.addIceCandidate=l}function cs(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(ls(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function ls(t){return t&&t.video!==void 0?Object.assign({},t,{video:Ui(t.video)}):t}function fs(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let c=0;c<r.iceServers.length;c++){let l=r.iceServers[c];l.urls===void 0&&l.url?(Rr("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,s.push(l)):s.push(r.iceServers[c])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function us(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ds(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(c=>c.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function ps(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const li=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:ps,shimCallbacksAPI:as,shimConstraints:ls,shimCreateOfferLegacy:ds,shimGetUserMedia:cs,shimLocalStreamsAPI:ss,shimRTCIceServerUrls:fs,shimRemoteStreamsAPI:os,shimTrackEventTransceiver:us},Symbol.toStringTag,{value:"Module"}));function ja(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hs={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<s.length;c++)i=s[c].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(c=>{n.parameters[c]!==void 0?s.push(c+"="+n.parameters[c]):s.push(c)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let l=3;l<s.length;l++){const u=s[l],p=e.matchPrefix(n,"a=rtpmap:"+u+" ")[0];if(p){const f=e.parseRtpMap(p),g=e.matchPrefix(n,"a=fmtp:"+u+" ");switch(f.parameters=g.length?e.parseFmtp(g[0]):{},f.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+u+" ").map(e.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const c=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{c.forEach(u=>{l.rtcpFeedback.find(f=>f.type===u.type&&f.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(c=>{i+=e.writeRtpMap(c),i+=e.writeFmtp(c),i+=e.writeRtcpFb(c)});let s=0;return r.codecs.forEach(c=>{c.maxptime>s&&(s=c.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(c=>{i+=e.writeExtmap(c)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,c=i.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),u=l.length>0&&l[0].ssrc;let p;const f=e.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(C=>parseInt(C,10)));f.length>0&&f[0].length>1&&f[0][0]===u&&(p=f[0][1]),i.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let y={ssrc:u,codecPayloadType:parseInt(m.parameters.apt,10)};u&&p&&(y.rtx={ssrc:p}),r.push(y),s&&(y=JSON.parse(JSON.stringify(y)),y.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},r.push(y))}}),r.length===0&&u&&r.push({ssrc:u});let g=e.matchPrefix(n,"b=");return g.length&&(g[0].indexOf("b=TIAS:")===0?g=parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?g=parseInt(g[0].substring(5),10)*1e3*.95-50*40*8:g=void 0,r.forEach(m=>{m.maxBitrate=g})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const c=e.matchPrefix(n,"a=rtcp-mux");return r.mux=c.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const c=e.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const l=e.matchPrefix(n,"a=sctpmap:");if(l.length>0){const u=l[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const c=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(hs);var ms=hs.exports;const $t=ja(ms),za=xs({__proto__:null,default:$t},[ms]);function yn(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=$t.parseCandidate(r.candidate);for(const c in s)c in i||Object.defineProperty(i,c,{value:s[c]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Et(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function lr(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Et(t,"icecandidate",e=>{if(e.candidate){const n=$t.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function bn(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(l){if(!l||!l.sdp)return!1;const u=$t.splitSections(l.sdp);return u.shift(),u.some(p=>{const f=$t.parseMLine(p);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(l){const u=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const p=parseInt(u[1],10);return p!==p?-1:p},i=function(l){let u=65536;return e.browser==="firefox"&&(e.version<57?l===-1?u=16384:u=2147483637:e.version<60?u=e.version===57?65535:65536:u=2147483637),u},s=function(l,u){let p=65536;e.browser==="firefox"&&e.version===57&&(p=65535);const f=$t.matchPrefix(l.sdp,"a=max-message-size:");return f.length>0?p=parseInt(f[0].substring(19),10):e.browser==="firefox"&&u!==-1&&(p=2147483637),p},c=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=r(arguments[0]),p=i(u),f=s(arguments[0],u);let g;p===0&&f===0?g=Number.POSITIVE_INFINITY:p===0||f===0?g=Math.max(p,f):g=Math.min(p,f);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return g}}),this._sctp=m}return c.apply(this,arguments)}}function Cn(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const l=arguments[0],u=l.length||l.size||l.byteLength;if(r.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Et(t,"datachannel",r=>(e(r.channel,r.target),r))}function fr(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const c=new Event("connectionstatechange",i);s.dispatchEvent(c)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function ur(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(c=>c.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function En(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function vn(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>n.apply(this,[c]))})}const Va=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:ur,shimAddIceCandidateNullOrEmpty:En,shimConnectionState:fr,shimMaxMessageSize:bn,shimParameterlessSetLocalDescription:vn,shimRTCIceCandidate:yn,shimRTCIceCandidateRelayProtocol:lr,shimSendThrowTypeError:Cn},Symbol.toStringTag,{value:"Module"}));function Ga({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=Fi,r=Fa(t),i={browserDetails:r,commonShim:Va,extractVersion:_n,disableLog:La,disableWarnings:Ma,sdp:za};switch(r.browser){case"chrome":if(!ai||!ar||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=ai,En(t,r),vn(t),ji(t,r),zi(t),ar(t,r),Vi(t),Hi(t,r),Gi(t),Ji(t),Zi(t,r),yn(t),lr(t),fr(t),bn(t,r),Cn(t),ur(t,r);break;case"firefox":if(!ci||!cr||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=ci,En(t,r),vn(t),Wi(t,r),cr(t,r),Yi(t),Xi(t),Ki(t),Qi(t),es(t),ts(t),ns(t),rs(t),is(t),yn(t),fr(t),bn(t,r),Cn(t);break;case"safari":if(!li||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=li,En(t,r),vn(t),fs(t),ds(t),as(t),ss(t),os(t),us(t),cs(t),ps(t),yn(t),lr(t),bn(t,r),Cn(t),ur(t,r);break;default:n("Unsupported browser!");break}return i}const fi=Ga({window:typeof window>"u"?void 0:window});function vt(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}class gs{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const n=[],r=e.byteLength,i=Math.ceil(r/this.chunkedMTU);let s=0,c=0;for(;c<r;){const l=Math.min(r,c+this.chunkedMTU),u=e.slice(c,l),p={__peerData:this._dataCount,n:s,data:u,total:i};n.push(p),c=l,s++}return this._dataCount++,n}}}function Ja(t){let e=0;for(const i of t)e+=i.byteLength;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.byteLength;return n}const Hn=fi.default||fi,Ht=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const t=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(t)?t==="chrome"?e>=this.minChromeVersion:t==="firefox"?e>=this.minFirefoxVersion:t==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Hn.browserDetails.browser}getVersion(){return Hn.browserDetails.version||0}isUnifiedPlanSupported(){const t=this.getBrowser(),e=Hn.browserDetails.version||0;if(t==="chrome"&&e<this.minChromeVersion)return!1;if(t==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let n,r=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),r=!0}catch{}finally{n&&n.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},qa=t=>!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(t),_s=()=>Math.random().toString(36).slice(2),ui={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class Ha extends gs{noop(){}blobToArrayBuffer(e,n){const r=new FileReader;return r.onload=function(i){i.target&&n(i.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r)&255;return n.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=ui,this.browser=Ht.getBrowser(),this.browserVersion=Ht.getVersion(),this.pack=Ni,this.unpack=Bi,this.supports=function(){const n={browser:Ht.isBrowserSupported(),webRTC:Ht.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!n.webRTC)return n;let r;try{r=new RTCPeerConnection(ui),n.audioVideo=!0;let i;try{i=r.createDataChannel("_PEERJSTEST",{ordered:!0}),n.data=!0,n.reliable=!!i.ordered;try{i.binaryType="blob",n.binaryBlob=!Ht.isIOS}catch{}}catch{}finally{i&&i.close()}}catch{}finally{r&&r.close()}return n}(),this.validateId=qa,this.randomToken=_s}}const we=new Ha,Za="PeerJS: ";var di;(function(t){t[t.Disabled=0]="Disabled",t[t.Errors=1]="Errors",t[t.Warnings=2]="Warnings",t[t.All=3]="All"})(di||(di={}));class Wa{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...n){const r=[Za,...n];for(const i in r)r[i]instanceof Error&&(r[i]="("+r[i].name+") "+r[i].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var w=new Wa,Dr={},Ya=Object.prototype.hasOwnProperty,Ie="~";function tn(){}Object.create&&(tn.prototype=Object.create(null),new tn().__proto__||(Ie=!1));function Ka(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function ys(t,e,n,r,i){if(typeof n!="function")throw new TypeError("The listener must be a function");var s=new Ka(n,r||t,i),c=Ie?Ie+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],s]:t._events[c].push(s):(t._events[c]=s,t._eventsCount++),t}function Sn(t,e){--t._eventsCount===0?t._events=new tn:delete t._events[e]}function ke(){this._events=new tn,this._eventsCount=0}ke.prototype.eventNames=function(){var e=[],n,r;if(this._eventsCount===0)return e;for(r in n=this._events)Ya.call(n,r)&&e.push(Ie?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(n)):e};ke.prototype.listeners=function(e){var n=Ie?Ie+e:e,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,c=new Array(s);i<s;i++)c[i]=r[i].fn;return c};ke.prototype.listenerCount=function(e){var n=Ie?Ie+e:e,r=this._events[n];return r?r.fn?1:r.length:0};ke.prototype.emit=function(e,n,r,i,s,c){var l=Ie?Ie+e:e;if(!this._events[l])return!1;var u=this._events[l],p=arguments.length,f,g;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),p){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,n),!0;case 3:return u.fn.call(u.context,n,r),!0;case 4:return u.fn.call(u.context,n,r,i),!0;case 5:return u.fn.call(u.context,n,r,i,s),!0;case 6:return u.fn.call(u.context,n,r,i,s,c),!0}for(g=1,f=new Array(p-1);g<p;g++)f[g-1]=arguments[g];u.fn.apply(u.context,f)}else{var m=u.length,y;for(g=0;g<m;g++)switch(u[g].once&&this.removeListener(e,u[g].fn,void 0,!0),p){case 1:u[g].fn.call(u[g].context);break;case 2:u[g].fn.call(u[g].context,n);break;case 3:u[g].fn.call(u[g].context,n,r);break;case 4:u[g].fn.call(u[g].context,n,r,i);break;default:if(!f)for(y=1,f=new Array(p-1);y<p;y++)f[y-1]=arguments[y];u[g].fn.apply(u[g].context,f)}}return!0};ke.prototype.on=function(e,n,r){return ys(this,e,n,r,!1)};ke.prototype.once=function(e,n,r){return ys(this,e,n,r,!0)};ke.prototype.removeListener=function(e,n,r,i){var s=Ie?Ie+e:e;if(!this._events[s])return this;if(!n)return Sn(this,s),this;var c=this._events[s];if(c.fn)c.fn===n&&(!i||c.once)&&(!r||c.context===r)&&Sn(this,s);else{for(var l=0,u=[],p=c.length;l<p;l++)(c[l].fn!==n||i&&!c[l].once||r&&c[l].context!==r)&&u.push(c[l]);u.length?this._events[s]=u.length===1?u[0]:u:Sn(this,s)}return this};ke.prototype.removeAllListeners=function(e){var n;return e?(n=Ie?Ie+e:e,this._events[n]&&Sn(this,n)):(this._events=new tn,this._eventsCount=0),this};ke.prototype.off=ke.prototype.removeListener;ke.prototype.addListener=ke.prototype.on;ke.prefixed=Ie;ke.EventEmitter=ke;Dr=ke;var St={};vt(St,"ConnectionType",()=>Ke);vt(St,"PeerErrorType",()=>oe);vt(St,"BaseConnectionErrorType",()=>nn);vt(St,"DataConnectionErrorType",()=>rn);vt(St,"SerializationType",()=>zt);vt(St,"SocketEventType",()=>Ye);vt(St,"ServerMessageType",()=>_e);var Ke;(function(t){t.Data="data",t.Media="media"})(Ke||(Ke={}));var oe;(function(t){t.BrowserIncompatible="browser-incompatible",t.Disconnected="disconnected",t.InvalidID="invalid-id",t.InvalidKey="invalid-key",t.Network="network",t.PeerUnavailable="peer-unavailable",t.SslUnavailable="ssl-unavailable",t.ServerError="server-error",t.SocketError="socket-error",t.SocketClosed="socket-closed",t.UnavailableID="unavailable-id",t.WebRTC="webrtc"})(oe||(oe={}));var nn;(function(t){t.NegotiationFailed="negotiation-failed",t.ConnectionClosed="connection-closed"})(nn||(nn={}));var rn;(function(t){t.NotOpenYet="not-open-yet",t.MessageToBig="message-too-big"})(rn||(rn={}));var zt;(function(t){t.Binary="binary",t.BinaryUTF8="binary-utf8",t.JSON="json",t.None="raw"})(zt||(zt={}));var Ye;(function(t){t.Message="message",t.Disconnected="disconnected",t.Error="error",t.Close="close"})(Ye||(Ye={}));var _e;(function(t){t.Heartbeat="HEARTBEAT",t.Candidate="CANDIDATE",t.Offer="OFFER",t.Answer="ANSWER",t.Open="OPEN",t.Error="ERROR",t.IdTaken="ID-TAKEN",t.InvalidKey="INVALID-KEY",t.Leave="LEAVE",t.Expire="EXPIRE"})(_e||(_e={}));var wr={};wr=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class Qa extends Dr.EventEmitter{constructor(e,n,r,i,s,c=5e3){super(),this.pingInterval=c,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+n+":"+r+i+"peerjs?key="+s}start(e,n){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${n}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+wr.version),this._disconnected=!1,this._socket.onmessage=i=>{let s;try{s=JSON.parse(i.data),w.log("Server message received:",s)}catch{w.log("Invalid server message",i.data);return}this.emit(Ye.Message,s)},this._socket.onclose=i=>{this._disconnected||(w.log("Socket closed.",i),this._cleanup(),this._disconnected=!0,this.emit(Ye.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),w.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){w.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:_e.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const n of e)this.send(n)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Ye.Error,"Invalid message");return}if(!this._wsOpen())return;const n=JSON.stringify(e);this._socket.send(n)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class bs{constructor(e){this.connection=e}startConnection(e){const n=this._startPeerConnection();if(this.connection.peerConnection=n,this.connection.type===Ke.Media&&e._stream&&this._addTracksToConnection(e._stream,n),e.originator){const r=this.connection,i={ordered:!!e.reliable},s=n.createDataChannel(r.label,i);r._initializeDataChannel(s),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){w.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const n=this.connection.peer,r=this.connection.connectionId,i=this.connection.type,s=this.connection.provider;w.log("Listening for ICE candidates."),e.onicecandidate=c=>{!c.candidate||!c.candidate.candidate||(w.log(`Received ICE candidates for ${n}:`,c.candidate),s.socket.send({type:_e.Candidate,payload:{candidate:c.candidate,type:i,connectionId:r},dst:n}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":w.log("iceConnectionState is failed, closing connections to "+n),this.connection.emitError(nn.NegotiationFailed,"Negotiation of connection to "+n+" failed."),this.connection.close();break;case"closed":w.log("iceConnectionState is closed, closing connections to "+n),this.connection.emitError(nn.ConnectionClosed,"Connection to "+n+" closed."),this.connection.close();break;case"disconnected":w.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},w.log("Listening for data channel"),e.ondatachannel=c=>{w.log("Received data channel");const l=c.channel;s.getConnection(n,r)._initializeDataChannel(l)},w.log("Listening for remote stream"),e.ontrack=c=>{w.log("Received remote stream");const l=c.streams[0],u=s.getConnection(n,r);if(u.type===Ke.Media){const p=u;this._addStreamToMediaConnection(l,p)}}}cleanup(){w.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const n=e.signalingState!=="closed";let r=!1;const i=this.connection.dataChannel;i&&(r=!!i.readyState&&i.readyState!=="closed"),(n||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);w.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),w.log("Set localDescription:",r,`for:${this.connection.peer}`);let i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ke.Data){const s=this.connection;i={...i,label:s.label,reliable:s.reliable,serialization:s.serialization}}n.socket.send({type:_e.Offer,payload:i,dst:this.connection.peer})}catch(i){i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(n.emitError(oe.WebRTC,i),w.log("Failed to setLocalDescription, ",i))}}catch(r){n.emitError(oe.WebRTC,r),w.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,n=this.connection.provider;try{const r=await e.createAnswer();w.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),w.log("Set localDescription:",r,`for:${this.connection.peer}`),n.socket.send({type:_e.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(i){n.emitError(oe.WebRTC,i),w.log("Failed to setLocalDescription, ",i)}}catch(r){n.emitError(oe.WebRTC,r),w.log("Failed to create answer, ",r)}}async handleSDP(e,n){n=new RTCSessionDescription(n);const r=this.connection.peerConnection,i=this.connection.provider;w.log("Setting remote description",n);const s=this;try{await r.setRemoteDescription(n),w.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await s._makeAnswer()}catch(c){i.emitError(oe.WebRTC,c),w.log("Failed to setRemoteDescription, ",c)}}async handleCandidate(e){w.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),w.log(`Added ICE candidate for:${this.connection.peer}`)}catch(n){this.connection.provider.emitError(oe.WebRTC,n),w.log("Failed to handleCandidate, ",n)}}_addTracksToConnection(e,n){if(w.log(`add tracks from stream ${e.id} to peer connection`),!n.addTrack)return w.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{n.addTrack(r,e)})}_addStreamToMediaConnection(e,n){w.log(`add stream ${e.id} to media connection ${n.connectionId}`),n.addStream(e)}}class Cs extends Dr.EventEmitter{emitError(e,n){w.error("Error:",n),this.emit("error",new Xa(`${e}`,n))}}class Xa extends Error{constructor(e,n){typeof n=="string"?super(n):(super(),Object.assign(this,n)),this.type=e}}class Es extends Cs{get open(){return this._open}constructor(e,n,r){super(),this.peer=e,this.provider=n,this.options=r,this._open=!1,this.metadata=r.metadata}}var pr;const Wt=class Wt extends Es{get type(){return Ke.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,n,r){super(e,n,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Wt.ID_PREFIX+we.randomToken(),this._negotiator=new bs(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{w.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{w.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){w.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const n=e.type,r=e.payload;switch(e.type){case _e.Answer:this._negotiator.handleSDP(n,r.sdp),this._open=!0;break;case _e.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:w.warn(`Unrecognized message type:${n} from peer:${this.peer}`);break}}answer(e,n={}){if(this._localStream){w.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const i of r)this.handleMessage(i);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};pr=new WeakMap,Jt(Wt,pr,Wt.ID_PREFIX="mc_");let An=Wt;class ec{constructor(e){this._options=e}_buildRequest(e){const n=this._options.secure?"https":"http",{host:r,port:i,path:s,key:c}=this._options,l=new URL(`${n}://${r}:${i}${s}${c}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",wr.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){w.error("Error retrieving ID",e);let n="";throw this._options.path==="/"&&this._options.host!==we.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let n="";throw this._options.host===we.CLOUD_HOST?n="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":n="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+n)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw w.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var hr,mr;const mt=class mt extends Es{get type(){return Ke.Data}constructor(e,n,r){super(e,n,r),this.connectionId=this.options.connectionId||mt.ID_PREFIX+_s(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new bs(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{w.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=n=>{w.log(`DC#${this.connectionId} dc onmessage:`,n.data)},this.dataChannel.onclose=()=>{w.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,n=!1){if(!this.open){this.emitError(rn.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,n)}async handleMessage(e){const n=e.payload;switch(e.type){case _e.Answer:await this._negotiator.handleSDP(e.type,n.sdp);break;case _e.Candidate:await this._negotiator.handleCandidate(n.candidate);break;default:w.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};hr=new WeakMap,mr=new WeakMap,Jt(mt,hr,mt.ID_PREFIX="dc_"),Jt(mt,mr,mt.MAX_BUFFERED_AMOUNT=8388608);let Pn=mt;class Or extends Pn{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",n=>this._handleDataMessage(n))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>Pn.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(n){return w.error(`DC#:${this.connectionId} Error when sending:`,n),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Zn extends Or{close(e){super.close(e),this._chunkedData={}}constructor(e,n,r){super(e,n,r),this.chunker=new gs,this.serialization=zt.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const n=Bi(e),r=n.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(n);return}this.emit("data",n)}_handleChunk(e){const n=e.__peerData,r=this._chunkedData[n]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[n]=r,r.total===r.count){delete this._chunkedData[n];const i=Ja(r.data);this._handleDataMessage({data:i})}}_send(e,n){const r=Ni(e);if(r instanceof Promise)return this._send_blob(r);if(!n&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const n=await e;if(n.byteLength>this.chunker.chunkedMTU){this._sendChunks(n);return}this._bufferedSend(n)}_sendChunks(e){const n=this.chunker.chunk(e);w.log(`DC#${this.connectionId} Try to send ${n.length} chunks...`);for(const r of n)this.send(r,!0)}}class tc extends Or{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,n){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=zt.None}}class nc extends Or{_handleDataMessage({data:e}){const n=this.parse(this.decoder.decode(e)),r=n.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",n)}_send(e,n){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=we.chunkedMTU){this.emitError(rn.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=zt.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var gr;const Yt=class Yt extends Cs{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[n,r]of this._connections)e[n]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,n){super(),this._serializers={raw:tc,json:nc,binary:Zn,"binary-utf8":Zn,default:Zn},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?n=e:e&&(r=e.toString()),n={debug:0,host:we.CLOUD_HOST,port:we.CLOUD_PORT,path:"/",key:Yt.DEFAULT_KEY,token:we.randomToken(),config:we.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...n},this._options=n,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==we.CLOUD_HOST?this._options.secure=we.isSecure():this._options.host==we.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&w.setLogFunction(this._options.logFunction),w.logLevel=this._options.debug||0,this._api=new ec(n),this._socket=this._createServerConnection(),!we.supports.audioVideo&&!we.supports.data){this._delayedAbort(oe.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!we.validateId(r)){this._delayedAbort(oe.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(i=>this._initialize(i)).catch(i=>this._abort(oe.ServerError,i))}_createServerConnection(){const e=new Qa(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Ye.Message,n=>{this._handleMessage(n)}),e.on(Ye.Error,n=>{this._abort(oe.SocketError,n)}),e.on(Ye.Disconnected,()=>{this.disconnected||(this.emitError(oe.Network,"Lost connection to server."),this.disconnect())}),e.on(Ye.Close,()=>{this.disconnected||this._abort(oe.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const n=e.type,r=e.payload,i=e.src;switch(n){case _e.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case _e.Error:this._abort(oe.ServerError,r.msg);break;case _e.IdTaken:this._abort(oe.UnavailableID,`ID "${this.id}" is taken`);break;case _e.InvalidKey:this._abort(oe.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case _e.Leave:w.log(`Received leave message from ${i}`),this._cleanupPeer(i),this._connections.delete(i);break;case _e.Expire:this.emitError(oe.PeerUnavailable,`Could not connect to peer ${i}`);break;case _e.Offer:{const s=r.connectionId;let c=this.getConnection(i,s);if(c&&(c.close(),w.warn(`Offer received for existing Connection ID:${s}`)),r.type===Ke.Media){const u=new An(i,this,{connectionId:s,_payload:r,metadata:r.metadata});c=u,this._addConnection(i,c),this.emit("call",u)}else if(r.type===Ke.Data){const u=new this._serializers[r.serialization](i,this,{connectionId:s,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});c=u,this._addConnection(i,c),this.emit("connection",u)}else{w.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(s);for(const u of l)c.handleMessage(u);break}default:{if(!r){w.warn(`You received a malformed message from ${i} of type ${n}`);return}const s=r.connectionId,c=this.getConnection(i,s);c&&c.peerConnection?c.handleMessage(e):s?this._storeMessage(s,e):w.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,n){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(n)}_getMessages(e){const n=this._lostMessages.get(e);return n?(this._lostMessages.delete(e),n):[]}connect(e,n={}){if(n={serialization:"default",...n},this.disconnected){w.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(oe.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[n.serialization](e,this,n);return this._addConnection(e,r),r}call(e,n,r={}){if(this.disconnected){w.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(oe.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){w.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const i=new An(e,this,{...r,_stream:n});return this._addConnection(e,i),i}_addConnection(e,n){w.log(`add connection ${n.type}:${n.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(n)}_removeConnection(e){const n=this._connections.get(e.peer);if(n){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,n){const r=this._connections.get(e);if(!r)return null;for(const i of r)if(i.connectionId===n)return i;return null}_delayedAbort(e,n){setTimeout(()=>{this._abort(e,n)},0)}_abort(e,n){w.error("Aborting!"),this.emitError(e,n),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(w.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const n=this._connections.get(e);if(n)for(const r of n)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;w.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)w.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)w.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=n=>{}){this._api.listAllPeers().then(n=>e(n)).catch(n=>this._abort(oe.ServerError,n))}};gr=new WeakMap,Jt(Yt,gr,Yt.DEFAULT_KEY="peerjs");let dr=Yt;function rc(){return{type:"turn_order",flip:Math.random()}}function ic(t){let e,n,r,i,s,c,l,u,p,f,g,m,y,C,v;function k(T,I){return T[6]?cc:ac}let x=k(t),S=x(t);function R(T){t[11](T)}let A={name:"Dream",dragType:"player",isDream:!0,col:1};t[2]!==void 0&&(A.area=t[2]),i=new On({props:A}),ue.push(()=>ge(i,"area",R));function j(T){t[12](T)}let Z={};t[1]!==void 0&&(Z.playArea=t[1]),p=new Aa({props:Z}),ue.push(()=>ge(p,"playArea",j));function L(T){t[13](T)}let B={};return t[0]!==void 0&&(B.playArea=t[0]),y=new Da({props:B}),ue.push(()=>ge(y,"playArea",L)),{c(){S.c(),e=K(),n=N("div"),r=N("div"),ae(i.$$.fragment),c=K(),l=N("div"),u=N("div"),ae(p.$$.fragment),g=K(),m=N("div"),ae(y.$$.fragment),U(r,"class","rounded border border-black"),U(u,"class","shrink-0 border-b border-black pb-1"),U(m,"class","shrink-0"),U(l,"class","flex flex-col gap-1"),U(n,"class","flex h-screen max-h-screen min-w-[65rem] flex-row gap-2 p-1 pl-24 pt-24")},m(T,I){S.m(T,I),V(T,e,I),V(T,n,I),O(n,r),te(i,r,null),O(n,c),O(n,l),O(l,u),te(p,u,null),O(l,g),O(l,m),te(y,m,null),v=!0},p(T,I){x!==(x=k(T))&&(S.d(1),S=x(T),S&&(S.c(),S.m(e.parentNode,e)));const D={};!s&&I&4&&(s=!0,D.area=T[2],me(()=>s=!1)),i.$set(D);const le={};!f&&I&2&&(f=!0,le.playArea=T[1],me(()=>f=!1)),p.$set(le);const P={};!C&&I&1&&(C=!0,P.playArea=T[0],me(()=>C=!1)),y.$set(P)},i(T){v||(q(i.$$.fragment,T),q(p.$$.fragment,T),q(y.$$.fragment,T),v=!0)},o(T){H(i.$$.fragment,T),H(p.$$.fragment,T),H(y.$$.fragment,T),v=!1},d(T){T&&(z(e),z(n)),S.d(T),ne(i),ne(p),ne(y)}}}function sc(t){let e,n,r,i,s,c,l,u,p,f;return{c(){e=N("div"),e.textContent="Send your ID to the other player:",n=K(),r=N("div"),i=Ae(t[4]),s=K(),c=N("input"),l=K(),u=N("button"),u.textContent="Connect!",U(r,"class","w-fit rounded border border-black")},m(g,m){V(g,e,m),V(g,n,m),V(g,r,m),O(r,i),V(g,s,m),V(g,c,m),Pr(c,t[5]),V(g,l,m),V(g,u,m),p||(f=[Ge(c,"input",t[9]),Ge(u,"click",t[10])],p=!0)},p(g,m){m&16&&ze(i,g[4]),m&32&&c.value!==g[5]&&Pr(c,g[5])},i:Pe,o:Pe,d(g){g&&(z(e),z(n),z(r),z(s),z(c),z(l),z(u)),p=!1,Je(f)}}}function oc(t){let e;return{c(){e=N("div"),e.textContent="Waiting to initiate..."},m(n,r){V(n,e,r)},p:Pe,i:Pe,o:Pe,d(n){n&&z(e)}}}function ac(t){let e;return{c(){e=N("button"),e.textContent="Waiting for other player",U(e,"class","absolute right-2 top-2"),e.disabled=!0},m(n,r){V(n,e,r)},d(n){n&&z(e)}}}function cc(t){let e;return{c(){e=N("button"),e.textContent="Send",U(e,"class","absolute right-2 top-2")},m(n,r){V(n,e,r)},d(n){n&&z(e)}}}function lc(t){let e,n,r,i;const s=[oc,sc,ic],c=[];function l(u,p){return u[4]===void 0?0:u[3]?2:1}return e=l(t),n=c[e]=s[e](t),{c(){n.c(),r=Bt()},m(u,p){c[e].m(u,p),V(u,r,p),i=!0},p(u,[p]){let f=e;e=l(u),e===f?c[e].p(u,p):(Nt(),H(c[f],1,1,()=>{c[f]=null}),Lt(),n=c[e],n?n.p(u,p):(n=c[e]=s[e](u),n.c()),q(n,1),n.m(r.parentNode,r))},i(u){i||(q(n),i=!0)},o(u){H(n),i=!1},d(u){u&&z(r),c[e].d(u)}}}function fc(t,e,n){let r={reality:[],channeled:[],combatArea:[],deck:[],hand:[],memDiscard:[],randomZone:[],voidPile:[]},i={reality:[],channeled:[],combatArea:[],deck:[],hand:[],memDiscard:[],randomZone:[],voidPile:[]},s=[];ws(async function(){let S=await lo();console.log(S),n(0,r.deck=S.slice(0,12),r)});let c=!1,l,u,p=rc(),f=!1,g=new dr;c=!0,l="",g.on("open",function(S){n(4,l=S)});function m(S){console.log("connected"),S.on("data",function(R){switch(console.log("Received",R),R.type){case"turn_order":{n(6,f=p.flip>R.flip);break}}}),S.on("open",function(){S.send(p)}),n(3,c=!0)}g.on("connection",m);function y(){u=this.value,n(5,u)}const C=()=>m(g.connect(u));function v(S){s=S,n(2,s)}function k(S){i=S,n(1,i)}function x(S){r=S,n(0,r)}return[r,i,s,c,l,u,f,g,m,y,C,v,k,x]}class uc extends Ct{constructor(e){super(),bt(this,e,fc,lc,yt,{})}}new uc({target:document.getElementById("app")});
